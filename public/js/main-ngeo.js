!function(){"use strict";var e="undefined"==typeof window?global:window;if("function"!=typeof e.require){var t={},i={},a={},s={}.hasOwnProperty,r="components/",n=function(e,t){var i=0;t&&(0===t.indexOf(r)&&(i=r.length),t.indexOf("/",i)>0&&(t=t.substring(i,t.indexOf("/",i))));var s=a[e+"/index.js"]||a[t+"/deps/"+e+"/index.js"];return s?r+s.substring(0,s.length-".js".length):e},o=/^\.\.?(\/|$)/,l=function(e,t){for(var i,a=[],s=(o.test(t)?e+"/"+t:t).split("/"),r=0,n=s.length;n>r;r++)i=s[r],".."===i?a.pop():"."!==i&&""!==i&&a.push(i);return a.join("/")},d=function(e){return e.split("/").slice(0,-1).join("/")},c=function(t){return function(i){var a=l(d(t),i);return e.require(a,t)}},h=function(e,t){var a={id:e,exports:{}};return i[e]=a,t(a.exports,c(e),a),a.exports},u=function(e,a){var r=l(e,".");if(null==a&&(a="/"),r=n(e,a),s.call(i,r))return i[r].exports;if(s.call(t,r))return h(r,t[r]);var o=l(r,"./index");if(s.call(i,o))return i[o].exports;if(s.call(t,o))return h(o,t[o]);throw new Error('Cannot find module "'+e+'" from "'+a+'"')};u.alias=function(e,t){a[t]=e},u.register=u.define=function(e,i){if("object"==typeof e)for(var a in e)s.call(e,a)&&(t[a]=e[a]);else t[e]=i},u.list=function(){var e=[];for(var i in t)s.call(t,i)&&e.push(i);return e},u.brunch=!0,u._cache=i,e.require=u}}(),require.register("account/model/dataAccessRequestStatuses",function(e,t,i){var a=t("configuration"),s=t("dataAccess/model/downloadManagers"),r=a.localConfig.dataAccessRequestStatuses.validStatuses,n=Backbone.Model.extend({defaults:{dataAccessRequestStatuses:[],collapseDAR:!1,collapseProducts:!1},initialize:function(){this.url=a.baseServerUrl+"/dataAccessRequestStatuses",this.listenTo(this,"error",this.onError)},onError:function(e,t){0==t.status&&location.reload()},getOrderedStatuses:function(){for(var e={},t=[],i=this.get("dataAccessRequestStatuses"),a=0;a<i.length;a++){var r=i[a];if(!e[r.dlManagerId]){var n={downloadManagerName:s.getDownloadManagerName(r.dlManagerId),dlManagerId:r.dlManagerId,DARs:[]};e[r.dlManagerId]=n,t.push(n)}e[r.dlManagerId].DARs.push(r)}return t},getFilterOrderedStatuses:function(e){var t=null;_.each(this.getOrderedStatuses(),function(i){i.dlManagerId==e&&(t=i)});var i=[];return i.push(t),i},getDARStatusIndex:function(e){var t=null;return _.each(this.get("dataAccessRequestStatuses"),function(i,a){i.ID==e&&(t=a)}),t},getStatusReadableString:function(e){if(!isNaN(parseInt(e)))for(var t in r)if(r[t].value==parseInt(e))return r[t].status;return e},getDARStatusById:function(e){var t=null;return _.each(this.get("dataAccessRequestStatuses"),function(i){i.ID==e&&(t=i)}),t},requestChangeStatus:function(e,t){var i=this.getDARStatusById(e);if(null!=i){var a={DataAccessRequestStatus:{ID:e,type:i.type,status:t,dlManagerId:i.dlManagerId}},s=this,r=s.url+"/"+e;return $.ajax({url:r,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(a),success:function(i){var a="";if(i.dataAccessRequestStatus.message&&(a=i.dataAccessRequestStatus.message),i.dataAccessRequestStatus.status==t){var n=s.get("dataAccessRequestStatuses")[s.getDARStatusIndex(e)];n.status=t,s.trigger("update:status",n,a)}else s.trigger("error:statusUpdate",r)},error:function(e,t,i){0==e.status?location.reload():(console.log("ERROR while updating status :"+t+" "+i),s.trigger("error:statusUpdate",r))}})}},reassignDownloadManager:function(e,t){var i=_.groupBy(e,"status");for(var a in i)if(a!=r.completedStatus.value){var s=_.map(i[a],function(e){return e.ID}),n={DarIdList:s,DataAccessRequestStatus:{status:String(a),dlManagerId:t}},o=this;$.ajax({url:this.url,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(n),success:function(e){for(var t=0;t<e.length;t++){var i=e[t],a=o.get("dataAccessRequestStatuses")[o.getDARStatusIndex(i.ID)];a.status=parseInt(i.status),a.dlManagerId=i.dlManagerId,o.trigger("update:status",a,i.message)}},error:function(e,t,i){0==e.status?location.reload():(console.log("ERROR while updating status :"+t+" "+i),o.trigger("error:statusUpdate",n))}})}}});i.exports=new n}),require.register("account/view/createShopcartView",function(e,t,i){var a=(t("logger"),t("account/template/nameShopcartTemplate")),s=(t("ui/widget"),t("configuration")),r=Backbone.View.extend({events:{"click #submitShopcart":function(e){e.preventDefault();var t=this.$el.find("#shopcartNameField").val();if(t&&""!=t){var i=this;this.submit(t,{success:function(e){i.options.success&&i.options.success(e),i.$el.ngeowidget("hide")},error:function(){i.$el.find("#serverMessage").html("<p>"+i.errorMessage()+"</p>")}})}else this.$el.find("#serverMessage").append("<p>Error : name cannot be empty</p>")}},submit:function(e,t){this.model.create({name:e},t)},errorMessage:function(){return"Error : cannot create the shopcart on the server."},render:function(){return this.$el.append(a()),this.$el.appendTo(".ui-page-active"),this.$el.ngeowidget({title:this.options.title,hide:$.proxy(this.remove,this),theme:s.localConfig.theme}),this.$el.trigger("create"),this.$el.ngeowidget("show"),this}});i.exports=r}),require.register("account/view/dataAccessRequestMonitoringView",function(e,t,i){var a=t("configuration"),s=t("account/template/accountDARsContent"),r=t("account/template/dataAccessRequestMonitoringContent"),n=t("account/template/darMonitoringFilterContent"),o=t("dataAccess/model/downloadManagers"),l=t("account/template/reassignDownloadPopupContent"),d=a.localConfig.dataAccessRequestStatuses.validStatuses,c={},h=Backbone.View.extend({initialize:function(){this.model.on("update:status",this.updateStatus,this),this.model.on("error:statusUpdate",function(e){}),this.model.on("sync",this.render,this),this.model.on("error",this.error,this)},events:{"click .pauseResumeButton":function(e){var t=$(e.currentTarget).closest(".darStatus").data("DAR");t.status==d.inProgressStatus.value?this.model.requestChangeStatus(t.ID,d.pausedStatus.value):t.status==d.pausedStatus.value?this.model.requestChangeStatus(t.ID,d.inProgressStatus.value):console.warn("Not supported status : "+status)},"click .stopDownloadButton":function(e){var t=$(e.currentTarget).closest(".darStatus").data("DAR").ID;this.model.requestChangeStatus(t,d.cancelledStatus.value)},"click #reassignDM":function(e){var t=($(e.currentTarget),this),i=[];if(this.$el.find(".ui-icon-checkbox-on").each(function(e){var t=$(this).next(".darStatus").data("DAR");i.push(t)}),i.length){var a=$(l(o.attributes)).appendTo(".ui-page-active").ngeowidget({title:"Select new download manager",hide:function(){a.ngeowidget("destroy").remove()}}).ngeowidget("show");a.find(".submit").click(function(){t.model.reassignDownloadManager(i,a.find("select").val()),a.ngeowidget("hide")})}},"click #pauseAll":function(){var e=this;this.$el.find(".ui-icon-checkbox-on").each(function(t){var i=$(this).next(".darStatus").data("DAR");i.status==d.inProgressStatus.value&&e.model.requestChangeStatus(i.ID,d.pausedStatus.value)})},"click #resumeAll":function(){var e=this;this.$el.find(".ui-icon-checkbox-on").each(function(t){var i=$(this).next(".darStatus").data("DAR");i.status==d.pausedStatus.value&&e.model.requestChangeStatus(i.ID,d.inProgressStatus.value)})},"click #stopAll":function(){var e=this;this.$el.find(".ui-icon-checkbox-on").each(function(t){var i=$(this).next(".darStatus").data("DAR");i.status!=d.cancelledStatus.value&&e.model.requestChangeStatus(i.ID,d.cancelledStatus.value)})},"click .checkDar":function(e){var t=$(e.currentTarget);t.hasClass("ui-icon-checkbox-off")?t.removeClass("ui-icon-checkbox-off").addClass("ui-icon-checkbox-on"):t.removeClass("ui-icon-checkbox-on").addClass("ui-icon-checkbox-off"),this.updateFooterButtonsState()},"click li":function(e){var t=$("#"+e.currentTarget.id);t.hasClass("ui-btn-active")?(t.removeClass("ui-btn-active"),this.selectedDownloadManagertId=void 0,this.orderedStatuses.orderedStatusesToDisplay=this.model.getOrderedStatuses(),this.render()):(this.$el.find(".ui-btn-active").removeClass("ui-btn-active"),t.addClass("ui-btn-active"),this.selectedDownloadManagertId=e.currentTarget.id,this.orderedStatuses.orderedStatusesToDisplay=this.model.getFilterOrderedStatuses(this.selectedDownloadManagertId),this.updateView())}},updateFooterButtonsState:function(){0==this.$el.find(".ui-icon-checkbox-on").length?this.$el.find("#darFooterButtons").addClass("ui-disabled"):this.$el.find("#darFooterButtons").removeClass("ui-disabled");var e=this.$el.find(".ui-icon-checkbox-on").next(".darStatus"),t=_.find(e,function(e){return $(e).data("DAR").status==d.inProgressStatus.value||$(e).data("DAR").status==d.pausedStatus.value}),i=_.find(e,function(e){return $(e).data("DAR").status==d.inProgressStatus.value}),a=_.find(e,function(e){return $(e).data("DAR").status==d.pausedStatus.value}),s=_.find(e,function(e){return $(e).data("DAR").status!=d.completedStatus.value});this.$el.find("#stopAll").button(t?"enable":"disable").button("refresh"),this.$el.find("#resumeAll").button(a?"enable":"disable").button("refresh"),this.$el.find("#pauseAll").button(i?"enable":"disable").button("refresh"),this.$el.find("#reassignDM").button(s?"enable":"disable").button("refresh")},updateStatus:function(e,t){var i=$("#darsDiv div[id='"+e.ID+"']");i.find("tbody tr:eq(0) td:eq(2)").html(e.dlManagerId);var a="#serverDARMonitoringResponse_"+e.ID;this.showMessage("Status changed to "+this.model.getStatusReadableString(e.status)+" : "+t,a);var s=i.find(".ui-btn-inner:eq(0)"),r=i.find("button[id='pause_"+e.ID+"']"),o=i.find("button[id='stop_"+e.ID+"']");switch(e.status){case d.inProgressStatus.value:s.find(".statusIcon").removeClass("ui-icon-cancelled ui-icon-paused").addClass("ui-icon-processing"),r.html("Pause").button("enable").button("refresh"),o.button("enable"),i.find("tbody tr:eq(0) td:eq(1)").html(d.inProgressStatus.status);break;case d.pausedStatus.value:s.find(".statusIcon").removeClass("ui-icon-cancelled ui-icon-processing").addClass("ui-icon-paused"),r.html("Resume").button("enable").button("refresh"),o.button("enable"),i.find("tbody tr:eq(0) td:eq(1)").html(d.pausedStatus.status);break;case d.cancelledStatus.value:s.find(".statusIcon").removeClass("ui-icon-processing ui-icon-paused").addClass("ui-icon-cancelled"),r.button("disable"),o.button("disable"),i.find("tbody tr:eq(0) td:eq(1)").html(d.cancelledStatus.status);break;default:s.find(".statusIcon").removeClass("ui-icon-processing ui-icon-paused ui-icon-cancelled").addClass("ui-icon-unknown"),r.button("disable"),o.button("disable"),i.find("tbody tr:eq(0) td:eq(1)").html("unknown")}this.$el.find("#dmsDiv").html(n(this.model)).trigger("create"),this.updateFooterButtonsState()},showMessage:function(e,t){c[t]&&clearTimeout(c[t]),$(t).empty().append(e).slideDown(),c[t]=setTimeout(function(){$(t).slideUp()},a.data.dataAccessRequestStatuses.messagefadeOutTime)},updateView:function(){var e=r(this.orderedStatuses);this.$el.find("#darsDiv").html(e),this.$el.trigger("create"),this.setUpStatusIcons()},error:function(e,t){404==t.status?this.render():(this.$el.empty(),this.$el.append("<div class='ui-error-message'><p><b> Failure: Error when loading the data access requests.</p></b><p><b> Please check the interface with the server.</p></b></div>"))},refreshSize:function(){var e=this.$el.offset(),t=this.$el.find("#darsDiv"),i=$(window).height()-(e.top+this.$el.outerHeight())+t.height();t.css("max-height",i)},render:function(){this.orderedStatuses={orderedStatusesToDisplay:this.model.getOrderedStatuses(),model:this.model};var e=s(this.model);this.$el.html(e),this.$el.find("#dmsDiv").html(n(this.model));var t=r(this.orderedStatuses);return this.$el.find("#darsDiv").html(t),this.$el.trigger("create"),this.setUpStatusIcons(),this.refreshSize(),this},setUpStatusIcons:function(){_.each(this.orderedStatuses.orderedStatusesToDisplay,function(e){_.each(e.DARs,function(e,t){var i="div[id='"+e.ID+"']",a=$("#darsDiv").find(i).data("DAR",e),s=a.find(".ui-btn-inner:eq(0)"),r=a.find("button[id='pause_"+e.ID+"']"),n=a.find("button[id='stop_"+e.ID+"']");switch(e.status){case d.inProgressStatus.value:s.append('<span class="statusIcon ui-icon-processing ui-icon .ui-shadow">&nbsp;</span>');break;case d.pausedStatus.value:s.append('<span class="statusIcon ui-icon-paused ui-icon .ui-shadow">&nbsp;</span>'),r.html("Resume").button("refresh");break;case d.completedStatus.value:s.append('<span class="statusIcon ui-icon-completed ui-icon .ui-shadow">&nbsp;</span>'),r.button("disable"),n.button("disable");break;case d.cancelledStatus.value:s.append('<span class="statusIcon ui-icon-cancelled ui-icon .ui-shadow">&nbsp;</span>'),r.button("disable"),n.button("disable");break;default:s.append('<span class="ui-icon-unknown ui-icon .ui-shadow">&nbsp;</span>'),r.button("disable"),n.button("disable")}})})}});i.exports=h}),require.register("account/view/downloadManagersMonitoringView",function(e,t,i){var a=t("configuration"),s=(t("dataAccess/model/downloadManagers"),t("account/template/downloadManagersMonitoringContent")),r=t("dataAccess/template/downloadManagerInstallContent"),n=t("account/template/downloadManagersTableContent"),o=(t("ui/widget"),Backbone.View.extend({initialize:function(){this.model.on("sync",this.buildDownloadManagersTable,this),this.model.on("status:change",this.buildDownloadManagersTable,this),this.model.on("error",this.error,this)},events:{"click #stop_dm":function(e){this.$stopDialog.ngeowidget("show").find("#stopImmediately").prop("checked","checked").checkboxradio("refresh")},"click tbody tr":function(e){$("tr").removeClass("dm_selected"),$(e.currentTarget).toggleClass("dm_selected");var t=$(e.currentTarget).attr("data-dmId"),i=this.model.getDownloadManagerStatus(t);"ACTIVE"==i||"INACTIVE"==i?$("#stop_dm").button("enable"):$("#stop_dm").button("disable")}},error:function(e,t){404==t.status?this.render():(this.$el.empty(),this.$el.append("<div class='ui-error-message'><p><b> Failure: Error when loading the download managers.</p></b><p><b> Please check the interface with the server.</p></b></div>"))},refreshSize:function(){var e=this.$el.offset(),t=this.$el.find("#downloadManagersMonitoringContent"),i=$(window).height()-(e.top+this.$el.outerHeight())+t.height()-50;t.css("max-height",i)},listTemplate:n,buildDownloadManagersTable:function(){this.model.get("downloadmanagers").length>0?this.$el.find("#downloadManagersMonitoringContent").html(this.listTemplate(this.model.attributes)):this.$el.find("#downloadManagersMonitoringContent").html("<p class='ui-error-message'><b>No download managers have been registered.</b></p>"),this.$el.trigger("create")},render:function(){this.$el.empty();var e=r({downloadManagerInstallationLink:a.data.downloadManager.downloadManagerInstallationLink,downloadmanagers:this.model.get("downloadmanagers")});this.$el.append(e).append(s()),this.buildDownloadManagersTable(),$("#stop_dm").button("disable"),this.$stopDialog=this.$el.find("#stopDMDialog").appendTo(".ui-page-active").ngeowidget({title:"Stop Immediately?",closable:!1}),this.$stopDialog.ngeowidget("hide");var t=this;return this.$stopDialog.find("button.confirm").click(function(e){var i=$("tr.dm_selected").attr("data-dmId");t.$stopDialog.find("#stopImmediately").is(":checked")?command="STOP":command="STOP_IMMEDIATELY",t.$stopDialog.ngeowidget("hide"),t.model.requestChangeStatus(i,command),$("#stop_dm").button("disable")}),this.$stopDialog.find("button.cancel").click(function(e){t.$stopDialog.ngeowidget("hide")}),this.refreshSize(),this}}));i.exports=o}),require.register("account/view/duplicateShopcartView",function(e,t,i){var a=t("account/view/createShopcartView"),s=a.extend({submit:function(e,t){var i=this.model.getCurrent().featureCollection.features,a=function(e){e.addItems(i),t.success&&t.success()},s={name:e,userId:"",isDefault:!1};this.model.create(s,{wait:!0,success:a,error:t.error})}});i.exports=s}),require.register("account/view/importShopcartView",function(e,t,i){var a=(t("logger"),Backbone.View.extend({events:{},render:function(){return this.$el.append('<div id="shopcartImportDiv"><div id="shopcartDropZone">\b Drop a Shopcart File Here (KML, GeoJSON or GML) \b</div><p id="shopcartImportMessage"></p></div>'),this.$el.trigger("create"),this}}));i.exports=a}),require.register("account/view/inquiriesView",function(e,t,i){var a=t("logger"),s=t("account/template/inquiriesContent"),r=t("configuration"),n=Backbone.View.extend({events:{"click #submitInquiry":function(e){e.preventDefault(),this.validateInquiryForm()&&this.submit()},"change #inquiryType":function(e){e.preventDefault(),$("#submitInquiryButtonContainer").removeClass("ui-disabled")}},validateInquiryForm:function(){var e=this.$el.find("#inquiryMessage").val().trim(),t=this.$el.find("select").val(),i=!0;return null==e||""==e?(a.inform("Please enter your inquiry message"),i=!1):(null==t||"-1"==t)&&(a.inform("Please choose an inquiry type"),i=!1),i},submit:function(){var e={UserInquiry:{inquiryType:this.$el.find("select").val(),inquiryText:this.$el.find("#inquiryMessage").val().trim()}},t=this;$.ajax({url:"/ngeo/userInquiry",data:JSON.stringify(e),type:"POST",contentType:"application/json",success:function(){a.inform("Inquiry successfully send to the server."),t.$el.find("select").val("-1"),t.$el.find("select").selectmenu("refresh",!0),t.$el.find("#inquiryMessage").val(""),t.$el.find("#submitInquiryButtonContainer").addClass("ui-disabled")},error:function(e,t,i){a.error("Submit an inquiry failed  :  "+i+" ("+t+")")}})},render:function(){return this.$el.append(s({theme:r.localConfig.theme})),this.$el.find("#submitInquiryButtonContainer").addClass("ui-disabled"),this.$el.trigger("create"),this}});i.exports=n}),require.register("account/view/layerManagerView",function(e,t,i){var a,s=(t("logger"),t("configuration")),r=t("map/map"),n=t("map/utils"),o=t("userPrefs"),l=t("account/template/layerManagerContent"),d=t("account/template/layerSearchPopupContent"),c=function(e,t,i,a){var s=null;if(e instanceof Array){for(var r=0;r<e.length&&null==s;r++)s=c(e[r],t,i,a);s&&"delete"==a&&(e.splice(r-1,1),s=!1)}else for(var n in e){if(null!=s)break;if(n==t&&e[n]==i){if("delete"==a)return console.log("Deleting "+n+": "+e[n]),e=void 0,!0;if("get"==a)return console.log(n+": "+e[n]),e}(e[n]instanceof Object||e[n]instanceof Array)&&(s=c(e[n],t,i,a))}return s},h=function(e){var t,i=e.engineLayer;if(i)t=e.params;else if(e.baseUrl||"KML"==e.type)t=e;else if(e.name)t={type:"WMS",name:e.title,baseUrl:e.baseUrl,visible:!1,params:{layers:e.name}};else if(e.tileMatrixSets&&e.identifier){var a=[s.get("map.projection").replace("EPSG:","")];"EPSG:3857"==s.get("map.projection")&&a.push("900913");var r=_.find(e.tileMatrixSets,function(e){return _.find(a,function(t){return e.supportedCRS.indexOf(t)>=0})});if(!r)return null;var n=_.find(e.tileMatrixSetLinks,function(e){return e.tileMatrixSet==r.identifier});if(!n)return null;t={type:"WMTS",title:e.title,name:e.identifier,baseUrl:e.baseUrl,visible:!1,projection:s.get("map.projection"),params:{layer:e.identifier,matrixSet:r.identifier,format:e.formats[0],matrixIds:r.matrixIds.map(function(e){return e.identifier})}};var o=e.bounds?e.bounds:null;o&&(t.bbox=[o.left,o.bottom,o.right,o.top])}var l=t?t.title||t.name:e.title;return{item:{id:l,label:l,checked:i,layerDesc:t,layer:i?e:null}}},u=function(e,t){var i=[];return _.each(e,function(e){var a=h(e);a&&(a.item.layerDesc&&!a.item.layerDesc.baseUrl&&(a.item.layerDesc.baseUrl=t),e.nestedLayers&&e.nestedLayers.length>0&&(a.children=u(e.nestedLayers,t)),i.push(a))}),i},p=function(e,t){$("<div>").appendTo(e).highCheckTree({data:t,onCheck:function(e){var t=e.data("layerDesc");t&&(e.data("layer",r.addLayer(t)),"KML"==t.type&&e.find("> .options").remove())},onUnCheck:function(e){var t=e.data("layer");e.data("layerDesc");t&&r.removeLayer(t)},onAddLi:function(e,t){t.item.layerDesc&&e.data("layerDesc",t.item.layerDesc),t.item.layer&&e.data("layer",t.item.layer)},onDeleteLi:function(e){var t=e.data("layer");e.data("layerDesc");t&&r.removeLayer(t);var i=e.closest(".checktree").find(" > li").attr("rel"),a=JSON.parse(o.get("userLayers")||"[]"),s=_.findWhere(a,{name:i});e.attr("rel")==s.name?a.splice(a.indexOf(s),1):c(s.data,"title",e.attr("rel"),"delete"),o.save("userLayers",JSON.stringify(a))},options:{isBackground:{callback:function(e,t){var i=e.data("layer"),a=e.data("layerDesc");i?(t?(console.log("Becomes background"),r.removeLayer(i),a.isBackground=!0,e.data("layer",r.addLayer(a))):(console.log("Becomes overlay"),r.removeLayer(i),a.isBackground=void 0,e.data("layer",r.addLayer(a))),e.data("layerDesc",a)):console.warn("NO LAYER BUILDED")},labelOn:"Background",labelOff:"Overlay",type:"switch"}}})},g=function(e,t,i){var a=JSON.parse(o.get("userLayers")||"[]");a.push({name:t,baseUrl:i,data:e}),o.save("userLayers",JSON.stringify(a))},f=Backbone.View.extend({events:{"click #addLayer":"onAdd"},onAdd:function(e){a=$(d()).appendTo(".ui-page-active"),a.popup().bind("popupafterclose",function(){$(this).remove()}),a.popup("open").trigger("create"),this.centerElement(a.closest(".ui-popup-container"));var t,i=this,s=function(){t=a.find("input[name='layerUrl']").val();var e=a.find('input[name="capabilities-type"]:checked').val();if(""!=t){a.find(".status").hide();var s=a.find("input[name='layerName']").val(),r={name:s,baseUrl:t,type:e};i.addLayer(r,{onError:function(e){a.find(".status").show().html(e)},onSuccess:function(e){g(e,s,t),a.popup("close")}})}else a.find(".status").show().html("Please enter the mapserver or KML url")};a.find('a[data-icon="search"]').click(s).end().find('input[name="layerUrl"]').on("input propertychange",function(e){var t=$(this).val();t.match(/LAYER|.kml/)?a.find("form").hide():a.find("form").show()})},addLayer:function(e,t){if(e.baseUrl.endsWith(".kml")){var i={location:s.get("proxyUrl")+e.baseUrl,name:e.name,type:"KML",visible:!0},a=h(i);p(this.$el.find("#trees"),[a]),t&&t.onSuccess&&t.onSuccess(i)}else if(e.baseUrl.toUpperCase().indexOf("LAYER=")>0){var r=n.createWmsLayerFromUrl(e.baseUrl);r.title=e.name;var a=h(r);a?(p(this.$el.find("#trees"),[a]),t&&t.onSuccess&&t.onSuccess(r)):console.warn("Something wrong happend when adding "+e.name)}else t&&($.mobile.loading("show",{text:"Loading mapserver layers..",textVisible:!0}),t.onComplete=function(){$.mobile.loading("hide",{textVisible:!1})}),this.exploreCapabilities(e,t)},exploreCapabilities:function(e,t){var i=this;$.ajax({type:"GET",url:e.baseUrl,data:{SERVICE:e.type,REQUEST:"GetCapabilities"},success:function(a){var s="WMS"==e.type?new OpenLayers.Format.WMSCapabilities:new OpenLayers.Format.WMTSCapabilities,r=s.read(a);if(!r||!r.capability&&!r.contents)return void(t&&t.onError&&t.onError("Error while parsing capabilities"));var n="WMS"==e.type?r.capability.nestedLayers:r.contents.layers;"WMTS"==e.type&&_.map(n,function(e){e.tileMatrixSets=r.contents.tileMatrixSets});var o=u(n,e.baseUrl);p(i.$el.find("#trees"),[{item:{id:e.name,label:e.name,checked:!1},children:o}]),t&&t.onSuccess&&t.onSuccess(n)},error:function(i){t&&t.onError&&t.onError("Error while searching on "+e.baseUrl)},complete:function(){t&&t.onComplete&&t.onComplete()}})},centerElement:function(e){$(e).css({top:Math.abs(($(window).height()-$(e).outerHeight())/2+$(window).scrollTop()),left:Math.abs(($(window).width()-$(e).outerWidth())/2+$(window).scrollLeft())})},addUserLayers:function(){var e=this,t=JSON.parse(o.get("userLayers")||"[]");_.each(t,function(t){if(_.isArray(t.data)){var i=u(t.data,t.baseUrl);p(e.$el.find("#trees"),[{item:{id:t.name,label:t.name,checked:!1},children:i}])}else"WMS"==t.data.type||"WMTS"==t.data.type||"KML"==t.data.type?e.addLayer(t):console.warn("Can't handle layer")})},render:function(){this.$el.append(l());var e=u(_.filter(r.layers,function(e){return"WMS"==e.params.type||"KML"==e.params.type}));return p(this.$el.find("#trees"),e),this.addUserLayers(),this.$el.trigger("create"),this}});i.exports=f}),require.register("account/view/renameShopcartView",function(e,t,i){var a=t("account/view/createShopcartView"),s=a.extend({submit:function(e,t){this.model.getCurrent().save({name:e},t)},errorMessage:function(){return"Error : Shopcart cannot be renamed."}});i.exports=s}),require.register("account/view/shopcartManagerView",function(e,t,i){var a=t("configuration"),s=t("account/view/createShopcartView"),r=t("account/view/renameShopcartView"),n=t("account/view/duplicateShopcartView"),o=t("shopcart/widget/shopcartExportWidget"),l=t("ui/sharePopup"),d=t("account/template/shopcartManagerContent"),c=Backbone.View.extend({initialize:function(){this.model.on("sync",this.render,this),this.model.on("error",this.error,this)},events:{"click label":function(e){this.model.setCurrent(this.model.get(e.currentTarget.id))},"click #new_shp":function(e){var t=new s({model:this.model,title:"New shopcart"});t.render()},"click #duplicate_shp":function(e){var t=new n({model:this.model,title:"Duplicate shopcart"});t.render()},"click #rename_shp":function(e){var t=new r({model:this.model,title:"Rename shopcart"});t.render()},"click #share_shp":function(e){l.open({url:a.serverHostName+window.location.pathname+this.model.getShopcartSharedURL(),positionTo:"#share_shp"})},"click #delete_shp":function(e){var t=this;this.model.getCurrent().destroy().done(function(){t.model.length>0?t.model.setCurrent(t.model.at(0)):t.model.setCurrent(null),t.render()}).fail(function(e,i,a){t.showMessage(a)})},"click #export_shp":function(e){var t=new o;t.open()}},refreshSize:function(){var e=this.$el.offset(),t=this.$el.find("#shopcartListDiv"),i=$(window).height()-(e.top+this.$el.outerHeight())+t.height()-50;t.css("max-height",i)},render:function(){var e=d({shopcarts:this.model});if(this.$el.html(e),this.model.getCurrent()){var t="#"+this.model.getCurrent().id+"_input";this.$el.find(t).attr("checked",!0)}return this.$el.trigger("create"),this.refreshSize(),this},showMessage:function(e){this.timeOut&&clearTimeout(this.timeOut),$("#errorMessageDiv").html(e).slideDown(),this.timeOut=setTimeout(function(){$("#errorMessageDiv").slideUp()},a.data.dataAccessRequestStatuses.messagefadeOutTime)},error:function(){this.$el.html("<div class='ui-error-message'><p><b> Failure: Error when loading the shopcart list.</p></b><p><b> Please check the interface with the server.</p></b></div>")}});i.exports=c}),require.register("account/view/userPrefsView",function(e,t,i){var a=t("userPrefs"),s=t("account/template/userPrefsContent"),r=t("configuration"),n=Backbone.View.extend({initialize:function(){a.on("addedPreference removedPreference",this.refresh,this)},events:{"click #clearPrefs":function(e){a.reset()}},render:function(){return this.$el.append(s({theme:r.localConfig.theme,UserPrefs:a})),this.$el.trigger("create"),this},refresh:function(){this.$el.empty(),this.render()}});i.exports=n}),require.register("configuration",function(e,t,i){var a=function(e){var t=new RegExp("/\\*(.|[\r\n])*?\\*/","g"),i=new RegExp("(^[/]|[^:]/)/.*[\r|\n]","g");return e=e.replace(i,""),e=e.replace(t,"")},s=function(e,t,i){if(e){var a=null,s=t.split("=");if(2==s.length){if(e[s[0]]==s[1])return e}else a=e[t];if("undefined"!=typeof a)return a}return i},r=function(){var e=window.location.pathname.split("/"),t="";if(e.length>0)for(var i=0;i<e.length;i++)"sec"!==e[i]&&""!==e[i]&&"index.html"!==e[i]&&"help.html"!==e[i]&&(t=t+"/"+e[i]);return t+"/ngeo"},n={url:"../conf",baseServerUrl:r(),serverHostName:window.location.protocol+"//"+window.location.host,localConfig:null,data:{},load:function(){var e={};return $.when($.ajax({url:this.url+"/localConfiguration.json",dataType:"json",success:function(e){n.localConfig=e},error:function(e,t,i){console.log("Local configuration not found "+t+" "+i)}}),$.when($.ajax({url:this.url+"/configuration.json",dataType:"text",success:function(e){n.setConfigurationData(e)},error:function(e,t,i){console.log("Configuration not found "+t+" "+i)}}),$.ajax({url:this.serverHostName+this.baseServerUrl+"/webClientConfigurationData",dataType:"text",success:function(t){e=t},error:function(e,t,i){console.log("Configuration not found "+t+" "+i)}})).then(function(){n.buildServerConfiguration(e)}))},setConfigurationData:function(e){$.extend(!0,n.data,JSON.parse(a(e)))},buildServerConfiguration:function(e){e=JSON.parse(a(e)),$.extend(!0,n.data,e)},get:function(e,t){return this.data?this.getFromPath(this.data,e,t):t},getMappedProperty:function(e,t,i){var a=this,s=this.getFromPath(this.localConfig,"serverPropertyMapper."+t);if(s){var r=i;return s.forEach(function(s){var n=a.getFromPath(e,s,i);n!==i&&("browses"===t?r=_.isArray(n)?n:[n]:"object"!=typeof n&&(r=n))}),r}return i},setMappedProperty:function(e,t,i){var a=this.getFromPath(this.localConfig,"serverPropertyMapper."+t);if(a){var s=a.substr(a,a.lastIndexOf(".")),r=a.substr(a.lastIndexOf(".")+1),n=this.getFromPath(e,s,null);n?n[r]=i:console.warn(s+" doesn't exist")}else console.warn(t+" wasn't found in serverPropertyMapper")},getPropertyFromPaths:function(e,t,i){var a=this;if(t&&_.isArray(t)&&t.length>0){var s=i;return t.forEach(function(t){var r=a.getFromPath(e,t,i);r!==i&&"object"!=typeof r&&(s=r)}),s}return i},getFromPath:function(e,t,i){for(var a=t.split("."),r=e,n=0;r&&n<a.length-1;n++){var o=a[n].split("[]");if(2===o.length){for(var l=null,d=0;d<r[o[0]].length;d++){for(var l=r[o[0]][d],c=n+1;l&&c<a.length-1;c++)l=s(l,a[c]);if(l){n=c;break}}r=l}else r=s(r,a[n])}return s(r,a[a.length-1],i)},checkBehindSso:function(){return $.when($.ajax({url:this.serverHostName+this.baseServerUrl+"/userId",dataType:"text",success:function(e){n.data.behindSSO=!1;var t=JSON.parse(e);t.userInformation?(n.data.behindSSO=!0,n.data.userIdentification=t.userInformation.userId,console.info("behind SSO")):console.info("Not behind SSO")},error:function(e,t,i){n.data.behindSSO=!1,console.info("Not behind SSO")}})).then(function(e){return $.when()},function(e){return $.when()})}};i.exports=n}),require.register("dataAccess/model/dataAccessRequest",function(e,t,i){var a=t("configuration"),s={id:"",step:0,requestStage:"",downloadLocation:{DownloadManagerId:"",DownloadDirectory:""},createBulkOrder:!1,firstRequest:{},initialize:function(){this.step=0,this.id="",this.requestStage=a.localConfig.dataAccessRequestStatuses.validationRequestStage,this.downloadLocation={DownloadManagerId:"",DownloadDirectory:""},this.resetRequest()},submit:function(){if(this.isValid()){var e=this;return $.ajax({data:JSON.stringify(e.getRequest()),url:e.url,type:"PUT",dataType:"json",contentType:"application/json",success:function(t){var i=a.localConfig.dataAccessRequestStatuses,s=i.validStatuses;switch(t.dataAccessRequestStatus.status){case s.validatedStatus.value:0==e.step&&""==e.id&&e.requestStage==i.validationRequestStage?(e.step=1,e.id=t.dataAccessRequestStatus.ID,e.requestStage=i.confirmationRequestStage,e.validationProcessing(t.dataAccessRequestStatus),e.trigger("SuccessValidationRequest",t.dataAccessRequestStatus.message,s.validatedStatus.message)):e.trigger("FailureRequest");break;case s.bulkOrderStatus.value:0==e.step&&e.requestStage==i.validationRequestStage?(e.step=1,e.id=t.dataAccessRequestStatus.ID,e.createBulkOrder=!0,e.requestStage=i.confirmationRequestStage,e.trigger("SuccessValidationRequest",t.dataAccessRequestStatus.message,s.bulkOrderStatus.message)):e.trigger("FailureRequest");break;case s.pausedStatus.value:case s.inProgressStatus.value:1==e.step&&e.requestStage==i.confirmationRequestStage?e.trigger("SuccessConfirmationRequest",t.dataAccessRequestStatus.message,s.inProgressStatus.message):e.trigger("FailureRequest");break;default:e.serverResponse=a.localConfig.dataAccessRequestStatuses.unExpectedStatusError,e.trigger("FailureRequest")}},error:function(t,i,s){0==t.status?location.reload():(console.log("ERROR when posting DAR :"+i+" "+s),e.serverResponse=a.localConfig.dataAccessRequestStatuses.requestSubmissionError,e.trigger("FailureRequest"))}})}}};_.extend(s,Backbone.Events),i.exports=s}),require.register("dataAccess/model/downloadManagers",function(e,t,i){var a=t("configuration"),s=(t("logger"),t("dataAccess/model/dataAccessRequest")),r=Backbone.Model.extend({defaults:{downloadmanagers:[]},initialize:function(){this.url=a.baseServerUrl+"/downloadManagers",
this.listenTo(this,"error",this.onError)},onError:function(e,t){0==t.status&&location.reload()},getDownloadManagerName:function(e){var t=_.findWhere(this.get("downloadmanagers"),{downloadManagerId:e});return t?t.downloadManagerFriendlyName:e},getDownloadManagerStatus:function(e){var t=_.findWhere(this.get("downloadmanagers"),{downloadManagerId:e});return t?t.status:null},requestChangeStatus:function(e,t){var i=_.findWhere(this.get("downloadmanagers"),{downloadManagerId:e});if(i){var a=this,r=a.url+"/"+e+"/changeStatus?new_status="+t,n=i.status;return $.ajax({url:r,type:"GET",dataType:"json"}).done(function(e){i.status=e.status,a.trigger("status:change")}).fail(function(e,t,a){0==e.status?location.reload():(s.error("Cannot change downloand manager status request :"+t+" "+a),i.status=n)})}}});i.exports=new r}),require.register("dataAccess/model/simpleDataAccessRequest",function(e,t,i){var a=t("configuration"),s=t("searchResults/model/searchResults"),r=t("dataAccess/model/dataAccessRequest"),n=t("shopcart/model/shopcartCollection"),o={url:a.baseServerUrl+"/simpleDataAccessRequests",name:"download",rejectedProductsNB:0,productURLs:[],productSizes:[],totalSize:0,dataType:null,resetRequest:function(){this.rejectedProductsNB=0,this.productURLs=[],this.hostedProcessId=null,this.name="download"},getDataType:function(){return this.dataType},getRequest:function(){if(this.hostedProcessId){this.url=a.baseServerUrl+"/hostedProcessDataAccessRequests";for(var e=[],t=0;t<this.productURLs.length;t++)e.push({name:"productURL",value:this.productURLs[t]});e=e.concat(this.parameters);var i={hostedProcessDataAccessRequest:{requestStage:this.requestStage,hostedProcessId:this.hostedProcessId,downloadLocation:this.downloadLocation,parameter:e,name:this.name}}}else{this.url=a.baseServerUrl+"/simpleDataAccessRequests";var i={simpledataaccessrequest:{requestStage:this.requestStage,downloadLocation:this.downloadLocation,productURLs:[],name:this.name}};this.createBulkOrder&&(i.simpledataaccessrequest.createBulkOrder=!0);for(var t=0;t<this.productURLs.length;t++){var s=this,r=_.find(this.productSizes,function(e){return e.productURL===s.productURLs[t]}),n="0";r&&(n=r.productSize),i.simpledataaccessrequest.productURLs.push({productURL:this.productURLs[t],expectedSize:n})}}return i},getSpecificMessage:function(){return 1==this.productURLs.length?"<p>One product is included in the request.</p>":"<p>"+this.productURLs.length+" products are included in the request.</p>"},setProducts:function(e){this.productURLs=s.getProductUrls(e),this.productSizes=s.getProductSizes(e),this.rejectedProductsNB=e.length-this.productURLs.length,_.find(e,function(e){return"undefined"!=typeof e.properties.shopcart_id})?this.dataType=n._current.get("name"):this.dataType=e[0].properties.originDatasetId},isValid:function(){var e=a.localConfig.dataAccessRequestStatuses;return""==this.downloadLocation.DownloadManagerId?(this.serverResponse=e.invalidDownloadManagersError,!1):0==this.productURLs.length?(this.serverResponse=a.localConfig.simpleDataAccess.invalidProductURLsError,this.trigger("RequestNotValidEvent"),!1):0==this.step&&""==this.id&&this.requestStage==e.validationRequestStage?!0:1==this.step&&""!=this.id&&this.requestStage==e.confirmationRequestStage?!0:(this.trigger("RequestNotValidEvent"),!1)},validationProcessing:function(e){this.totalSize=0;for(var t=e.productStatuses,i=0;i<t.length;i++){var a=_.find(this.productSizes,function(e){return e.productURL===t[i].productURL});if(a&&a.productSize){var s=a.productSize;t[i].expectedSize=s,this.totalSize+=parseInt(s)}}}};_.extend(o,r),i.exports=o}),require.register("dataAccess/model/standingOrderDataAccessRequest",function(e,t,i){var a=t("configuration"),s=t("dataAccess/model/dataAccessRequest"),r=(t("search/model/datasetSearch"),2592e6),n={url:a.baseServerUrl+"/standingOrderDataAccessRequest",OpenSearchURL:"",startDate:new Date,endDate:new Date((new Date).getTime()+r),timeDriven:!1,repeatPeriod:0,slideAcquisitionTime:!1,DownloadOptions:{},SchedulingOptions:{},name:"subscription",resetRequest:function(){this.OpenSearchURL="",this.DownloadOptions={},this.SchedulingOptions={},this.hostedProcessId=null,this.name="subscription"},getDataType:function(){var e=new RegExp(/catalogue\/(\w*)\//);return e.exec(this.OpenSearchURL)[1]},getRequest:function(){var e={StandingOrderDataAccessRequest:{requestStage:this.requestStage,OpenSearchURL:this.OpenSearchURL,DownloadOptions:this.DownloadOptions,SchedulingOptions:this.getSchedulingOptions(),downloadLocation:this.downloadLocation,name:this.name}};return this.hostedProcessId&&(e.StandingOrderDataAccessRequest.hostedProcessId=this.hostedProcessId,e.StandingOrderDataAccessRequest.parameter=this.parameters),this.createBulkOrder&&(e.StandingOrderDataAccessRequest.createBulkOrder=!0),e},getSharedURL:function(e){var t=e.dataset.get("datasetId"),i="#data-services-area/sto/"+t+"?";i+=e.getOpenSearchParameters(t);var a=this.timeDriven?this.getSchedulingOptions().TimeDriven:this.getSchedulingOptions().DataDriven;return i+="&"+$.param(a)},populateModelfromURL:function(e,t){this.initialize();for(var i=e.split("&"),a=0;a<i.length;a++){var s=i[a].split("=");switch(s[0]){case"startDate":this.startDate=Date.fromISOString(s[1]);break;case"endDate":this.endDate=Date.fromISOString(s[1]);break;case"repeatPeriod":this.repeatPeriod=s[1],this.timeDriven=!0;break;case"slideAcquisitionTime":this.slideAcquisitionTime="true"==s[1],this.timeDriven=!0}}this.OpenSearchURL=t.getOpenSearchURL(),this.DownloadOptions=t.getSelectedDownloadOptions()},getSchedulingOptions:function(){return this.timeDriven?{TimeDriven:{startDate:this.startDate.toISODateString(),endDate:this.endDate.toISODateString(),repeatPeriod:this.repeatPeriod,slideAcquisitionTime:this.slideAcquisitionTime}}:{DataDriven:{startDate:this.startDate.toISODateString(),endDate:this.endDate.toISODateString()}}},getSpecificMessage:function(){},isValid:function(){var e=a.localConfig.dataAccessRequestStatuses,t=a.localConfig.standingOrder;if(""==this.downloadLocation.DownloadManagerId)return this.serverResponse=e.invalidDownloadManagersError,!1;if(""==this.OpenSearchURL||!this.OpenSearchURL)return this.serverResponse=t.invalidOpenSearchURLError,!1;if(!this.DownloadOptions)return this.serverResponse=t.invalidDownloadOptionsError,!1;var i=this.getSchedulingOptions();return 0==this.step&&""==this.id&&this.requestStage==e.validationRequestStage&&this.OpenSearchURL&&this.DownloadOptions&&this.SchedulingOptions&&(i.DataDriven&&i.DataDriven.endDate||i.TimeDriven&&i.TimeDriven.endDate&&void 0!=i.TimeDriven.repeatPeriod&&void 0!=i.TimeDriven.slideAcquisitionTime)?!0:1==this.step&&""!=this.id&&this.requestStage==e.confirmationRequestStage?!0:(this.trigger("RequestNotValidEvent"),!1)},validationProcessing:function(e){}};_.extend(n,s),i.exports=n}),require.register("dataAccess/view/dataAccessRequestView",function(e,t,i){var a=t("configuration"),s=t("hostedProcesses/model/hostedProcessList"),r=t("hostedProcesses/view/selectHostedProcessesView"),n=t("dataAccess/template/dataAccessRequestViewContent"),o=t("dataAccess/template/downloadManagerInstallContent"),l=Backbone.View.extend({events:{"click #validateRequest":function(e){var t=this.selectHostedProcessView&&this.selectHostedProcessView.$el.find(".selected").length>0;if(!t||this.selectHostedProcessView.validateParameters()){$("#serverMessage").empty();var i=this.request.downloadLocation.DownloadManagerId=this.$el.find("#downloadManagersList").val(),a=this.request.downloadLocation.DownloadDirectory=this.$el.find("#downloadDirectory").val();this.$el.find("#downloadManagersList").selectmenu("disable"),this.$el.find("#downloadDirectory").textinput("disable").end().find("#darName").textinput("disable"),this.request.submit();var s=localStorage.getItem("directories-"+i)||"";s=s.split(","),s.indexOf(a)<0&&s.push(a),localStorage.setItem("directories-"+i,s.join(","))}else $("#serverMessage").html('<p style="color: red;">Please, configure the product processing parameters first</p>')},"change #darName":function(e){this.request.name=$(e.target).val()}},setRequest:function(e){this.request&&this.stopListening(this.request),this.request=e,this.request&&(this.listenTo(this.request,"SuccessValidationRequest",this.onValidationSuccess),this.listenTo(this.request,"SuccessConfirmationRequest",this.onConfirmationSuccess),this.listenTo(this.request,"FailureRequest",this.onFailure),this.listenTo(this.request,"RequestNotValidEvent",this.onFailure))},onFailure:function(){$("#validateRequest").button("disable"),$("#serverMessage").html("Invalid server response")},onValidationSuccess:function(e,t){$("#validateRequest").html("Confirm"),$("#downloadManagersFooter .ui-btn-text").html("Confirm");var i="<p>"+t+"</p><p>"+e+"</p>";this.request.totalSize&&(i+="<p> Estimated Size : "+filesize(this.request.totalSize)+".<p>",this.request.totalSize>a.get("simpleDataAccessRequest.warningMaximumSize",1e9)&&(i+="<p>WARNING : The amount of data to download is huge.</p><p>Are you sure you want to confirm your request?</p>")),$("#serverMessage").html(i)},onConfirmationSuccess:function(e,t){$("#validateRequest").button("disable"),$("#serverMessage").html("<p>"+t+"</p><p>"+e+"</p>");var i=this;setTimeout(function(){i.$el.parent().ngeowidget("hide")},1e3)},directorySuggestion:function(e,t){var i=this.$el.find("#downloadManagersList").val(),a=localStorage.getItem("directories-"+i),s=[];if(a){a=a.split(",");for(var r=0;r<a.length;r++)a[r]!==e&&a[r].indexOf(e)>=0&&s.push(a[r])}t(s)},render:function(){if(this.request.name+="-"+this.request.getDataType()+"-"+(new Date).toISOString(),0==this.model.attributes.downloadmanagers){var e=o({downloadManagerInstallationLink:a.data.downloadManager.downloadManagerInstallationLink,downloadmanagers:this.model.get("downloadmanagers")});this.$el.html("<p class='ui-error-message'><b>No download manager has been registered.<br>In order to download products, you need to install a download manager.</b></p>"+e)}else{var t=n({model:this.model,request:this.request,theme:a.localConfig.theme});this.$el.html(t),this.$el.find("#downloadDirectory").autoComplete({minChars:0,cache:!1,source:$.proxy(this.directorySuggestion,this)})}var i=new s,l=this;return i.fetch().done(function(){i.get("hostedProcess").length>0?(l.selectHostedProcessView=new r({model:i,el:l.$el.find("#hostedProcesses"),request:l.request}),l.selectHostedProcessView.render(),l.$el.find("#hostedProcesses").trigger("create")):(l.$el.find("#productProcessingContainer").remove(),l.$el.trigger("create"))}).fail(function(){l.$el.find("#hostedProcesses").html("No product processing available.")}),this.$el.find("#dataAccessSpecificMessage").append(this.request.getSpecificMessage()),this.$el.trigger("create"),this}});i.exports=l}),require.register("dataAccess/widget/dataAccessWidget",function(e,t,i){var a=(t("configuration"),t("dataAccess/view/dataAccessRequestView")),s=t("dataAccess/model/downloadManagers"),r=(t("ui/widget"),function(){var e=$('<div id="dataAccessPopup">'),t=$('<div id="dataAccessPopupContent"></div>');t.appendTo(e),e.appendTo(".ui-page-active");e.ngeowidget({title:"Data Access Request"});var i=new a({model:s,el:t});this.open=function(t){s.fetch().complete(function(){i.setRequest(t),i.render(),e.ngeowidget("show")})},this.close=function(){e.ngeowidget("hide")}});i.exports=new r}),require.register("dataAccess/widget/directDownloadWidget",function(e,t,i){var a=t("configuration"),s=t("dataAccess/model/downloadManagers"),r=t("dataAccess/template/directDownloadWidgetContent"),n=t("dataAccess/widget/dataAccessWidget"),o=t("dataAccess/model/simpleDataAccessRequest"),l=function(e,t){var i=$('<div id="directDownloadPopup" data-role="popup" data-overlay-theme="a" class="popup-widget-background">');i=i.appendTo(".ui-page-active"),this.open=function(l){var d=this;i.bind({popupafterclose:function(e,t){i.remove()}}),s.get("downloadmanagers").length>=1?i.html(r({url:t,downloadHelperUrl:a.baseServerUrl+"/downloadHelper?productURI="+encodeURIComponent(t+".ngeo")})):(i.html(r({url:t,downloadHelperUrl:!1})),s.fetch().done(function(){i.html(r({url:t,downloadHelperUrl:a.baseServerUrl+"/downloadHelper?productURI="+encodeURIComponent(t+".ngeo")})),i.trigger("create"),a.data.behindSSO&&a.data.downloadManager.enable||i.find(".viaDownloadManager").closest("li").hide()})),i.trigger("create"),i.popup(),i.popup("open",{x:l.pageX,y:l.pageY,positionTo:"origin"}),a.data.behindSSO&&a.data.downloadManager.enable||i.find(".viaDownloadManager").closest("li").hide(),i.find(".viaDownloadManager").click(function(){o.initialize(),o.setProducts([e]),n.open(o),d.close()})},this.close=function(){i.popup("close")}};i.exports=l}),require.register("globalEvents",function(e,t,i){var a={};_.extend(a,Backbone.Events),i.exports=a}),require.register("help",function(e,t,i){function a(e){$.ajax({url:e,dataType:"text",success:function(t){var i=$("#contentContainer"),a=t.replace(/<img([^>]*)\ssrc=['"]([^'"]+)['"]/gi,"<img$1 src='pages/userManual/$2'");i.html(a).trigger("create");var s=e.indexOf("#");if(s>=0){var r=$(e.substr(s));r.length>0&&i.imagesLoaded(function(){i.scrollTop(r.offset().top+i.scrollTop()-i.offset().top)})}else i.scrollTop(0)}})}function s(){$("#contentContainer").height($(window).height()-$("header").outerHeight(!0))}$(document).ready(function(){var e=new Backbone.Router;e.route("chapter/:chapter(/:section)","chapter",function(e,t){var i="pages/userManual/"+e+".html";t&&(i+="#"+t),a(i)}),e.route("","index",function(){a("pages/userManual/overview.html")}),$("body").removeClass("ui-mobile-viewport"),$("header").find("a").removeClass("ui-link"),s(),$(window).resize(s),Backbone.history.start()})}),require.register("home",function(e,t,i){"use strict";var a=t("configuration");i.exports={initialize:function(e){a.url=e?e:"conf",a.load().done(function(){$("body .contactUs").attr("href","mailto:"+a.get("mailto")),$("body footer").append("<span>Client "+a.localConfig.version+" - Server "+a.data.version+"</span>")})}}}),require.register("hostedProcesses/model/hostedProcessList",function(e,t,i){var a=t("configuration"),s=Backbone.Model.extend({defaults:{hostedProcesses:[]},initialize:function(){this.url=a.baseServerUrl+"/hostedProcesses"}});i.exports=s}),require.register("hostedProcesses/view/hostedProcessConfigurationView",function(e,t,i){var a=(t("configuration"),t("hostedProcesses/template/hostedProcessConfigurationContent")),s=function(e){var t=new RegExp(/^(ht|f)tps?:\/\/[a-z0-9-\.]+\.[a-z]{2,4}\/?([^\s<>\#%"\,\{\}\\|\\\^\[\]`]+)?$/gi);return e.match(t)?!0:!1},r=Backbone.View.extend({id:"hostedProcessConfiguration",initialize:function(e){this.request=e.request},events:{"click #validateHostedProcessConfiguration":function(){this.$el.find("#validateMessage").empty();var e=[],t=this;this.$el.find("input, div").removeClass("invalid"),this.$el.find("select, input").each(function(i){t.validateField(this)?e.push({name:$(this).attr("id"),value:$(this).val()}):"datebox"==$(this).data("role")?$(this).parent().addClass("invalid"):$(this).addClass("invalid")}),0==this.$el.find(".invalid").length&&(this.request.parameters=e,$("#dataAccessPopup").ngeowidget("show"))}},render:function(){var e=a({hostedProcess:this.model});this.$el.append(e),0==this.$el.find(".configurationInputs").length&&this.$el.find("#validateHostedProcessConfiguration").before('<p style="text-align: center;">No parameter to configure by user</p>')},validateField:function(e){var t=$(e).val(),i=!0;if(t){if("number"==$(e).attr("type")){var a=parseFloat($(e).attr("min")),r=parseFloat($(e).attr("max"));(a>t||t>r)&&(this.$el.find("#validateMessage").append('<p style="color: red;">Value of '+$(e).attr("id")+" field must be between "+a+" and "+r+"</p>"),i=!1)}"url"!=$(e).attr("type")||s(t)||(this.$el.find("#validateMessage").append('<p style="color: red;">The url of '+$(e).attr("id")+" field is not valid</p>"),i=!1)}else 0==this.$el.find(".missingError").length&&this.$el.find("#validateMessage").prepend('<p style="color: red;" class="missingError">Please, fill all the missing parameters</p>'),i=!1;return i}});i.exports=r}),require.register("hostedProcesses/view/selectHostedProcessesView",function(e,t,i){var a=t("configuration"),s=t("hostedProcesses/view/hostedProcessConfigurationView");t("dataAccess/model/standingOrderDataAccessRequest");t("ui/widget");var r=t("hostedProcesses/template/hostedProcessesListContent"),n=Backbone.View.extend({id:"hostedProcessView",initialize:function(e){this.request=e.request},events:{"click #configureHostedProcess":function(){$("#serverMessage").empty();var e=this.$el.find(".selected").data("value"),t=$('<div id="hostedProcessConfiguration">');t.appendTo(".ui-page-active"),t.ngeowidget({title:"Product processing",hide:function(){t.remove()}});var i=new s({model:this.model.get("hostedProcess")[e],el:t,request:this.request});i.render(),t.trigger("create"),t.ngeowidget("show")},"click .hostedProcess":function(e){var t=$(e.target).closest(".hostedProcess"),i=t.data("value");this.request.hostedProcessId=this.model.get("hostedProcess")[i].hostedProcessId,this.request.parameters=[],t.siblings().removeClass("selected").end().toggleClass("selected");var a=this.$el.find("#configureHostedProcess");this.$el.find(".selected").length>0?a.removeAttr("disabled"):a.attr("disabled","disabled"),a.button("refresh")}},render:function(){var e=r({hostedProcesses:this.model.get("hostedProcess"),theme:a.localConfig.theme});this.$el.html(e)},validateParameters:function(){for(var e=this,t=_.find(this.model.get("hostedProcess"),function(t){return t.hostedProcessId==e.request.hostedProcessId}),i=0;i<t.parameter.length;i++){var a=t.parameter[i],s=_.where(this.request.parameters,{name:a.name}).length>0;if("EOProductURL"!=a.type&&!s)return!1}return!0}});i.exports=n}),require.register("jqm-config",function(e,t,i){$(document).bind("mobileinit",function(){$.mobile.ignoreContentEnabled=!0,$.mobile.ajaxEnabled=!1,$.mobile.linkBindingEnabled=!1,$.mobile.hashListeningEnabled=!1,$.mobile.pushStateEnabled=!1})}),require.register("logger",function(e,t,i){window.console||(console={log:function(){}});var a;i.exports={error:function(e){a&&a.popup("close"),console.log("Error : "+e),a=$("<div><p>Error : "+e+"</p></div>").appendTo(".ui-page-active").popup({afterclose:function(e,t){$(this).remove(),a=null}}).popup("open")},inform:function(e){a&&a.popup("close"),console.log(e),a=$("<div><p>"+e+"</p></div>").appendTo(".ui-page-active").popup({afterclose:function(e,t){$(this).remove(),a=null}}).popup("open")},warning:function(e,t){void 0!=t?console.log("Warning : "+e,t):console.log("Warning : "+e)},log:function(e,t){void 0!=t?console.log("Log : "+e,t):console.log("Log : "+e)}}}),require.register("main",function(e,t,i){"use strict";var a=t("configuration"),s=t("ui/menubar"),r=(t("ui/context-help"),t("logger"));i.exports={initialize:function(){var e=$.Deferred();$.mobile.popup.prototype.options.history=!1,$.mobile.hashListeningEnabled=!1;var i=window.location.search.indexOf("sharedUrl=");if(i>0){var n=window.location.search.substr(i+"sharedUrl=".length);n=decodeURIComponent(n),window.location=n}$.when(e,a.load(),a.checkBehindSso()).done(function(){$("body .contactUs").attr("href","mailto:"+a.get("mailto"));var e=t("map/map");$.mobile.loading("show"),$("body").removeClass("ui-mobile-viewport"),$("header").find("a").removeClass("ui-link"),$("#sso-login").hide(),$("#userConnected").hide(),a.data.behindSSO?($("#userConnected").show(),$("#userConnected").html("Logged in as "+a.data.userIdentification)):($("#sso-login").show(),$("#sso-login").attr("href",a.data.idpUrl)),e.initialize("map"),s.initialize("header nav")}).fail(function(e,t,i){r.error("Cannot load configuration : "+i)}),$(document).ready(e.resolve)}}}),require.register("searchResults/browsesManager",function(e,t,i){var a=t("logger"),s=t("configuration"),r=t("search/model/datasetAuthorizations"),n=(t("search/model/dataSetPopulation"),t("map/map")),o=t("map/utils"),l=(t("map/selectHandler"),t("searchResults/model/searchResults"),{}),d={},c=function(e){return s.getMappedProperty(e,"browseUrl",null)},h=function(e){return s.getMappedProperty(e,"browseCrossOrigin",null)},u=function(e,t){return new Date(e.time)-new Date(t.time)},p=function(e,t){return new Date(e.properties.EarthObservation.gml_endPosition)-new Date(t.properties.EarthObservation.gml_endPosition)},g=function(e,t){var i=n.getMapEngine();e.sort(p),_.each(e,function(e,a){var s=_.filter(t,function(t){return t.params.name==e.id});_.each(s,function(e,a){i.setLayerIndex(e.engineLayer,t.length)})})};i.exports={addBrowse:function(e,t,i){var u=s.getMappedProperty(e,"browses",null),p="PLANNED"==s.getMappedProperty(e,"status");if(!$.isEmptyObject(u)&&!p){if(!i){var g=e._featureCollection;i=g.browseIndex}for(var f=0;f<i.length;f++){var m=u[i[f]];if(m){m.BrowseInformation._selected=!0;var v=c(m),w=h(m),b=o.getLayerName(v);if(!b)return null;if(r.hasBrowseAuthorization(t,b)){var y=l[b];y||(y=l[b]=n.addLayer({name:b,type:"Browses",visible:!0})),y.addBrowse(e,v,w)}else d[v]||(a.inform("You do not have enough permission to browse the layer "+v+"."),d[v]=!0)}}}},removeBrowse:function(e,t){var i=s.getMappedProperty(e,"browses");if(i){if(!t){var a=e._featureCollection;t=a.browseIndex}for(var r=0;r<t.length;r++){var d=i[t[r]];if(d){var h=o.getLayerName(c(d)),u=l[h];if(u){var p=c(d);u.removeBrowse(e,p),u.isEmpty()&&(n.removeLayer(u),delete l[h])}delete d.BrowseInformation._selected}}}},getSelectedBrowseLayers:function(e){for(var t=[],i=0;i<e.features.length;i++){var a=e.features[i],r=s.getMappedProperty(a,"browses");if(void 0!==r[0]){var n=_.find(r,function(e){return 1==e.BrowseInformation._selected});if(n){var d=o.getLayerName(c(n));-1==t.indexOf(l[d])&&l[d]&&t.push(l[d])}}}return t},updateRenderOrder:function(e){var t=[];for(var i in l)t=t.concat(l[i].getBrowses());if(t.sort(u),t.length>0){var a=n.getMapEngine();_.each(t,function(e,t){a.setLayerIndex(e.engineLayer,t)}),e&&g(e,t)}}}}),require.register("searchResults/dsa",function(e,t,i){var a=(t("logger"),t("search/model/dataSetPopulation")),s=t("searchResults/map"),r=t("map/selectHandler"),n=t("searchResults/model/searchResults"),o=(t("searchResults/view/searchResultsView"),t("searchResults/view/searchResultsTableView")),l=t("map/widget/mapPopup"),d=(t("ui/ganttView"),!1),c=0,h=0,u=null,p=function(){var e=0;return u.find("command").each(function(){e+=$(this).outerWidth(!0)}),e},g=function(e){var t=p()-$bottomDatasets.width();return e>t&&(e=t),0>e&&(e=0),e},f=function(e){h+=e,h=g(h),$bottomDatasets.scrollLeft(h)};i.exports={initialize:function(e,t,i){u=$("#bottomToolbar"),$bottomDatasets=u.find("#bottomDatasets");var d=new o;i.bottom.addView(d),d.render();var c=window.location.href.indexOf("shopcart")>=0;$("#table").click(function(){$(this).toggleClass("toggle");var e=parseInt(i.bottom.$el.css("bottom")),t=e>=0;t?i.hide("bottom",400):i.show("bottom",400)}),n.on("add:featureCollection",function(e){var t,r="result"+e.id;e.dataset&&(t=a.getFriendlyName(e.dataset.get("datasetId"))),t||(t=e.id),u.find("command:last").after('<command id="'+r+'" title="'+t+'" label="'+t+'" class="result" />').end().toolbar("refresh");var n=$("#dateRangeSlider").data("ui-dateRangeSlider");n&&n.refresh(),i.bottom.addStatus({activator:"#"+r,$el:$(""),views:[d],viewActivators:[$("#table")],model:e}),s.addFeatureCollection(e,{layerName:e.id+" Result",style:"results-footprint",hasBrowse:!0}),c||$("#"+r).click(),f(u.find("command:last").position().left)}),n.on("remove:featureCollection",function(e){var t="result"+e.id;i.bottom.removeStatus("#"+t),$("#bottomToolbar command:last-child").click();var a=$("#dateRangeSlider").data("ui-dateRangeSlider");a&&a.refresh(),s.removeFeatureCollection(e),f(u.find("command:last").position().left)}),r.initialize(),r.start();var h=new l("#mapContainer");h.close(),n.on("launch",function(){$("#shopcart").hasClass("toggle")&&$("#shopcart").next().click()}),this.initSwipeEffect(),u.mousewheel(function(e,t){f(10*t)})},initSwipeEffect:function(){$bottomDatasets.on("mousedown",function(e){$bottomDatasets.outerWidth()<p()&&(d=!0,_lastX=e.clientX)}),$bottomDatasets.on("mousemove",function(e){d&&(e.preventDefault(),c=_lastX-e.clientX,f(c),_lastX=e.clientX)}),$(document).on("mouseup",function(e){d&&(e.preventDefault(),h=g($bottomDatasets.scrollLeft()+10*c),u.stop().animate({scrollLeft:h},Math.abs(30*c),"easeOutQuad"),d=!1),c=0})}}}),require.register("searchResults/map",function(e,t,i){var a=(t("logger"),t("searchResults/browsesManager")),s=t("map/map"),r=t("map/selectHandler"),n=t("ui/productService"),o=function(e){var t=g.length;g=_.union(g,e),g.length!=t&&m()},l=function(e,t){for(var i=0;i<e.length;i++){var s=e[i];a.removeBrowse(s)}t._footprintLayer.removeFeatures(e)},d=function(e,t){for(var i=0;i<e.length;i++){var s=e[i];(t.isHighlighted(s)||t.isSelected(s))&&a.addBrowse(s)}o(e),t._footprintLayer.addFeatures(e)},c=function(e,t){for(var i=0;i<e.length;i++){var s=e[i];delete s._browseShown,a.removeBrowse(s)}},h=function(e,t){for(var i=0;i<e.length;i++){var s=e[i];s._browseShown=!0,a.addBrowse(s,t.id)}},u=function(e,t){t._footprintLayer.modifyFeaturesStyle(e,"select"),s.trigger("selectFeatures",e)},p=function(e,t){e.forEach(function(e){e._featureCollection.isHighlighted(e)?t._footprintLayer.modifyFeaturesStyle([e],"highlight"):(t._footprintLayer.modifyFeaturesStyle([e],"default"),a.removeBrowse(e))}),s.trigger("unselectFeatures")},g=[],f=10,m=_.debounce(function(){a.updateRenderOrder(g),g=[]},f),v=function(e,t){var i=[];if(e&&e.length>0){for(var r=0;r<e.length;r++){var l=e[r];t._footprintLayer.modifyFeaturesStyle([l],"highlight"),a.addBrowse(l,t.getDatasetId(l)),l._featureCollection=t,i.push(l)}n.addBrowsedProducts(e)}o(e),s.trigger("highlightFeatures",e)},w=function(e,t){if(e&&e.length>0){for(var i=0;i<e.length;i++){var r=e[i];r._featureCollection.isSelected(r)?t._footprintLayer.modifyFeaturesStyle([r],"select"):(t._footprintLayer.modifyFeaturesStyle([r],"default"),a.removeBrowse(r))}n.removeBrowsedProducts(e)}s.trigger("unhighlightFeatures",e)};i.exports={initialize:function(){var e=!1,t=function(t){(t.ctrlKey||t.metaKey)&&(e=!0)},i=function(t){e=t.ctrlKey||t.metaKey};document.addEventListener("keydown",t),document.addEventListener("keyup",i),s.on("pickedFeatures",function(t,i){var a={},s=[],r=[];e&&t.length>0?t.forEach(function(e){_.find(n.getHighlightedProducts(),function(t){return e.id===t.id})?r.push(e):s.push(e)}):s=t,n.removeHighlightedProducts(r),n.addHighlightedProducts(s);for(var o=0;o<i.length;o++)a[i[o].id]=[];for(var o=0;o<s.length;o++){var l=s[o]._featureCollection;a[l.id].push(s[o])}for(var o=0;o<i.length;o++)e&&0!==t.length||i[o].checkAllHighlight(),i[o].setHighlight(a[i[o].id]);for(var o=0;o<r.length;o++){var l=r[o]._featureCollection;l.unsetHighlight([r[o]])}})},addFeatureCollection:function(e,t){var i=t.layer;i||(i=s.addLayer({name:t.layerName+" Footprints",type:"Feature",visible:!0,style:t.style,greatCircle:!0}),s.getMapEngine().setLayerIndex(i.engineLayer,99999)),e._footprintLayer=i,e.on("add:features",i.addFeatures,i),e.on("remove:features",i.removeFeatures,i),e.on("reset:features",i.clear,i),e.on("add:child",this.addFeatureCollection),e.on("remove:child",this.removeFeatureCollection),e.on("show:features",d,i),e.on("hide:features",l,i),e.on("selectFeatures",u),e.on("unselectFeatures",p),e.on("highlightFeatures",v),e.on("unhighlightFeatures",w),e.on("show:browses",h),e.on("hide:browses",c),r.addFeatureCollection(e)},removeFeatureCollection:function(e,t){e.off("add:features",e._footprintLayer.addFeatures,e._footprintLayer),e.off("remove:features",e._footprintLayer.removeFeatures,e._footprintLayer),e.off("reset:features",e._footprintLayer.resetFeatures,e._footprintLayer),e.off("add:child",this.addFeatureCollection),e.off("remove:child",this.removeFeatureCollection),e.off("show:features",e._footprintLayer.addFeatures,e._footprintLayer),e.off("hide:features",e._footprintLayer.removeFeatures,e._footprintLayer),e.off("selectFeatures",u),e.off("unselectFeatures",p),e.off("highlightFeatures",v),e.off("show:browses",h),e.off("hide:browses",c),t&&t.keepLayer||s.removeLayer(e._footprintLayer);for(var i=0;i<e.highlights.length;i++)a.removeBrowse(e.highlights[i]);r.removeFeatureCollection(e)}}}),require.register("searchResults/model/featureCollection",function(e,t,i){var a=t("configuration"),s=t("search/model/dataSetPopulation"),r=(t("search/model/datasetSearch"),t("search/model/downloadOptions")),n=t("ui/productService"),o=function(e){var t=a.getMappedProperty(e,"productUrl",null);return r.extractParamsFromUrl(t)},l=function(){this.children={};var e=[],t="";this.currentPage=1,this.lastPage=0,this.countPerPage=a.get("shopCartResults.countPerPage",100),this.totalResults=-1,this.features=[],this.selections=[],this.highlights=[],this.viewAccess=!0,this.downloadAccess=!0,this.dataset=null,this.id="",this.browseIndex=[0];var i=this,r=function(a,s){var r=t+"&startIndex="+a;$.ajax({url:r,dataType:"json"}).done(function(a){i.parse&&(a=i.parse(a)),t==s&&(e[i.currentPage]=a.features,a.properties&&a.properties.totalResults?i.totalResults=parseInt(a.properties.totalResults):i.totalResults=a.features.length,i.lastPage=Math.ceil(i.totalResults/i.countPerPage),i.addFeatures(a.features),a.features.length<1&&i.trigger("endLoading",0))}).fail(function(e,t,a){0==e.status?location.reload():(console.log("ERROR when retrieving the products :"+t+" "+a),i.trigger("error:features",r),i.trigger("endLoading"))})};this.addFeatures=function(e){for(var t=0;t<e.length;t++){var a=e[t];null!=this.parent&&(a.id=a.id+t),a._featureCollection=this,i.features.push(a)}e.length>0&&(0===i.lastPage&&(i.lastPage=1),i.trigger("add:features",e,i))},this.removeFeatures=function(t){this.unselect(t),this.unsetHighlight(t),this.features=_.difference(this.features,t),e.length=0,i.trigger("remove:features",t,i)},this.showFeatures=function(e){i.trigger("show:features",e,i),e.length>0&&(this.trigger("highlightFeatures",this.highlights,this),this.trigger("selectFeatures",this.selections,this))},this.hideFeatures=function(e){i.trigger("hide:features",e,i)},this.showBrowses=function(e){i.trigger("show:browses",e,i)},this.hideBrowses=function(e){i.trigger("hide:browses",e,i)},this.search=function(i){t=i,this.dataset&&(this.countPerPage=this.dataset.get("countPerPage")),t+="&count="+this.countPerPage,e.length=0,this.lastPage=1,this.totalResults=0,this.changePage(1)},this.reset=function(){this.unsetHighlight(this.highlights),this.unselect(this.selections);for(var i in this.children)this.removeChild(i);this.children={},t="",e.length=0,this.lastPage=1,this.totalResults=0,this.features.length=0,this.trigger("reset:features",this)},this.changePage=function(i){if(i>=1&&i<=this.lastPage){this.currentPage=i,this.features.length=0,this.unsetHighlight(this.highlights),this.unselect(this.selections);for(var a in this.children)this.removeChild(a);this.children={},this.trigger("reset:features",this),e[this.currentPage]?this.addFeatures(e[this.currentPage]):(this.trigger("startLoading",this),r(this.getStartIndex()+(this.currentPage-1)*this.countPerPage,t))}},this.appendPage=function(e){this.currentPage=e,this.trigger("startLoading",this),r(this.getStartIndex()+(this.currentPage-1)*this.countPerPage,t)},this.getStartIndex=function(){return this.dataset?this.dataset.get("startIndex"):1},this.isBrowsed=function(e){return n.getBrowsedProducts().indexOf(e)>=0},this.isSelected=function(e){return this.selections.indexOf(e)>=0},this.isHighlighted=function(e){return this.highlights.indexOf(e)>=0},this.checkAllHighlight=function(){var e=[];this.highlights.forEach(function(t){e.push(t)}),this.unsetHighlight(e)},this.setHighlight=function(e){n.addHighlightedProducts(e);this.highlights=_.union(this.highlights,e),this.trigger("highlightFeatures",e,this);for(var t in this.children);},this.unsetHighlight=function(e){n.removeHighlightedProducts(e),this.highlights=_.difference(this.highlights,e),this.trigger("unhighlightFeatures",e,this)},this.select=function(e){for(var t=0;t<e.length;t++){var i=e[t];-1==this.selections.indexOf(i)&&this.selections.push(i);
}n.addCheckedProducts(e),this.trigger("selectFeatures",e,this)},this.unselect=function(e){var t=_.difference(this.selections,e);this.selections=t,n.removeCheckedProducts(e),this.trigger("unselectFeatures",e,this)},this.createChild=function(e){var t=new l,i=String(e).replace(/\W/g,"_");return t.id=i,t.parent=this,t.countPerPage=a.get("expandSearch.countPerPage",100),this.children[i]=t,this.trigger("add:child",t,{layerName:"Child Result",style:"results-footprint",hasBrowse:!0}),t},this.removeChild=function(e){var t=String(e).replace(/\W/g,"_");this.trigger("remove:child",this.children[t],{layerName:"Child Result",style:"results-footprint",hasBrowse:!0}),delete this.children[t]},this.getSelectedProductUrls=function(){for(var e=[],t=0;t<this.selections.length;t++){var i=this.selections[t],s=a.getMappedProperty(i,"productUrl",null);s&&e.push(s)}return e},this.getHighlightedProductUrls=function(){for(var e=[],t=0;t<this.highlights.length;t++){var i=this.highlights[t],s=a.getMappedProperty(i,"productUrl",null);s&&e.push(s)}return e},this.updateProductUrl=function(e,t,i){var s=a.getMappedProperty(e,t,null);s&&(-1!=s.indexOf("ngEO_DO={")&&(s=s.substring(0,s.indexOf("ngEO_DO={")-1)),s+=-1==s.indexOf("?")?"?":"&",s+=i.getAsUrlParameters(),a.setMappedProperty(e,t,s))},this.updateDownloadOptions=function(e){var t=this;_.each(this.selections,function(i){t.updateProductUrl(i,"productUrl",e),t.updateProductUrl(i,"productUri",e)}),this.trigger("update:downloadOptions",this.selections)},this.getSelectedDownloadOptions=function(){if(0==this.selections.length)return{};for(var e=o(this.selections[0]),t=1;t<this.selections.length;t++){var i=o(this.selections[t]);for(var a in i)_.isArray(i[a])?e[a]=_.intersection(e[a],i[a]):_.isEqual(e[a],i[a])||(e[a]="@conflict");for(var a in e)_.isArray(e[a])?e[a]=_.intersection(e[a],i[a]):_.isEqual(e[a],i[a])||(e[a]="@conflict")}return e},this.getDatasetId=function(e){return this.dataset?this.dataset.get("datasetId"):a.getMappedProperty(e,"originDatasetId",null)},this.getDatasetIdsFromHighlights=function(){for(var e=[],t=0;t<this.highlights.length;t++){var i=this.getDatasetId(this.highlights[t]);i&&e.indexOf(i)<0&&e.push(i)}return e},this.fetchAvailableDownloadOptions=function(e){if(this.dataset)return e(this.dataset.get("downloadOptions"));var t=this.getDatasetIdsFromHighlights();1==t.length?s.fetchDataset(t[0],function(t){e(t.get("downloadOptions"))}):e([])},this.getDirectDownloadProductUrl=function(e){return a.getMappedProperty(e,"productUri","")},this.isBrowserSupportedUrl=function(e){var t=this.getDirectDownloadProductUrl(e);return-1!=t.indexOf("http")||-1!=t.indexOf("https")?!0:!1},_.extend(this,Backbone.Events)};i.exports=l}),require.register("searchResults/model/searchResults",function(e,t,i){var a=t("configuration"),s=t("searchResults/model/featureCollection"),r=t("search/model/dataSetPopulation"),n=t("search/model/datasetSearch"),o=t("search/model/datasetAuthorizations"),l={featureCollection:{},launch:function(e){for(var t in this.featureCollection){var i=this.featureCollection[t],a=e.getOpenSearchURL({id:i.getDatasetId()});i.search(a)}this.trigger("launch")},getProductUrls:function(e){for(var t=[],i=0;i<e.length;i++){var s=e[i],r=a.getMappedProperty(s,"productUrl",null);r&&t.push(r)}return t},getProductSizes:function(e){for(var t=[],i=0;i<e.length;i++){var s=e[i],r=a.getMappedProperty(s,"productUrl",null),n=a.getMappedProperty(s,"productSize",null);r&&n&&t.push({productURL:r,productSize:n})}return t},getDirectDownloadProductUrl:function(e){return a.getMappedProperty(e,"productUri","")},isBrowserSupportedUrl:function(e){var t=this.getDirectDownloadProductUrl(e);return-1!=t.indexOf("http")||-1!=t.indexOf("https")?!0:!1}};_.extend(l,Backbone.Events),r.on("select",function(e){var t=e.get("datasetId");if(!l.featureCollection.hasOwnProperty(t)){var i=new s;i.id=e.tagFriendlyId,i.dataset=e,i.viewAccess=o.hasViewAccess(t),i.downloadAccess=o.hasDownloadAccess(t),l.featureCollection[t]=i,l.trigger("add:featureCollection",i)}}),r.on("unselect",function(e){if("Simple"!=n.get("mode"))n.set("mode","Simple");else{var t=e.get("datasetId");l.featureCollection.hasOwnProperty(t)&&(l.featureCollection[t].reset(),l.trigger("remove:featureCollection",l.featureCollection[t]),delete l.featureCollection[t])}}),n.on("change:mode",function(e,t){for(var i in l.featureCollection)l.trigger("remove:featureCollection",l.featureCollection[i]),delete l.featureCollection[i];switch(t){case"Simple":for(var a in r.selection){var n=new s;n.id=a,n.dataset=r.selection[a],l.featureCollection[a]=n,l.trigger("add:featureCollection",n)}break;case"Correlation":case"Interferometry":var n=new s;n.id=t,l.featureCollection[n.id]=n,n.countPerPage=5,l.trigger("add:featureCollection",n)}}),i.exports=l}),require.register("searchResults/view/exportView",function(e,t,i){var a=(t("configuration"),t("map/geojsonconverter")),s=t("searchResults/template/exportViewContent"),r=Backbone.View.extend({mediaTypes:{kml:"application/vnd.google-earth.kml+xml",gml:"application/gml+xml",geojson:"application/json",metalink:"application/metalink+xml"},events:{"change #export-format":function(e){var t=this.$el.find("#download"),i=$(e.currentTarget);if(""==i.val())t.addClass("ui-disabled");else{var s=i.val().toLowerCase();t.removeClass("ui-disabled");var r=$.extend(!0,[],this.model.highlights);$.each(r,function(e,t){t._origGeometry&&(t.geometry=t._origGeometry,delete t._origGeometry),t._featureCollection&&delete t._featureCollection,t._isHidden&&delete t._isHidden,t.properties.styleHint&&delete t.properties.styleHint});var n=new Blob([a.convert(r,s)],{type:this.mediaTypes[s]});t.attr("download","export."+s),t.attr("href",URL.createObjectURL(n))}}},render:function(){var e=null;if(window.Blob)try{e=new Blob}catch(t){e=null}return e?(this.$el.append(s()),this.$el.trigger("create"),this.$el.find("#download").addClass("ui-disabled")):this.$el.append('<p class="ui-error-message"><b>Export is not supported in your browser</b></p>'),this}});i.exports=r}),require.register("searchResults/view/searchResultsTableView",function(e,t,i){var a=t("configuration"),s=t("globalEvents"),r=t("logger"),n=t("ui/tableView"),o=t("dataAccess/widget/dataAccessWidget"),l=t("dataAccess/widget/directDownloadWidget"),d=t("searchResults/widget/downloadOptionsWidget"),c=t("searchResults/widget/exportWidget"),h=t("searchResults/model/searchResults"),u=t("dataAccess/model/simpleDataAccessRequest"),p=n.extend({initialize:function(e){n.prototype.initialize.apply(this,arguments),this.events=_.extend({},n.prototype.events,this.events),this.columnDefs=a.data.tableView.columnsDef;var t=a.get("tableView.directDownloadColumn",-1);t>=0&&t<this.columnDefs.length&&(this.columnDefs[t].getClasses=function(e){return h.isBrowserSupportedUrl(e)?"ui-direct-download":""});var i=_.findWhere(this.columnDefs,{sTitle:"Download options"});i&&(i.getClasses=function(e){return"downloadOptions"})},events:{"click .directDownload":function(e){if(e.stopPropagation(),this.model.downloadAccess){var t=$(e.currentTarget).closest("tr").data("internal").feature,i=new l(t,h.getDirectDownloadProductUrl(t));i.open(e)}else r.inform("Cannot download the product : missing permissions.")}},updateHighlights:function(){if(n.prototype.updateHighlights.apply(this,arguments),this.model.highlights.length>0?this.exportButton.button("enable"):this.exportButton.button("disable"),0==this.model.getHighlightedProductUrls().length)this.retrieveProduct.button("disable"),this.downloadOptionsButton.button("disable"),this.addToShopcart.button("disable");else{var e=_.find(this.model.highlights,function(e){return"PLANNED"==a.getMappedProperty(e,"status",null)});this.retrieveProduct.button(e?"disable":"enable");var t=this.model.dataset&&this.model.dataset.get("downloadOptions")&&0!=this.model.dataset.get("downloadOptions").length;this.downloadOptionsButton.button(t?"enable":"disable"),this.addToShopcart.button("enable")}},renderButtons:function(e){this.retrieveProduct=$('<button data-role="button" data-inline="true" data-mini="true" title="Retrieve highlighted products with download manager">Retrieve</button>').appendTo(e),this.retrieveProduct.button(),a.data.behindSSO&&a.data.downloadManager.enable?this.retrieveProduct.button("disable"):this.retrieveProduct.button("disable").parent().hide();var t=this;this.retrieveProduct.click(function(){t.model.downloadAccess?(u.initialize(),u.setProducts(t.model.highlights),o.open(u)):r.inform("Cannot download the product : missing permissions.")}),this.addToShopcart=$('<button data-role="button" data-inline="true" data-mini="true" title="Add highlighted products to shopcart">Add to shopcart</button>').appendTo(e),this.addToShopcart.button(),this.addToShopcart.button("disable"),this.addToShopcart.click(function(){s.trigger("addToShopcart",t.model.highlights)}),a.data.behindSSO||this.addToShopcart.button("disable").parent().hide(),this.downloadOptionsButton=$('<button data-role="button" data-inline="true" data-mini="true">Download Options</button>'),this.downloadOptionsButton.button(),this.downloadOptionsButton.button("disable"),this.downloadOptionsButton.click(function(){var e=new d({datasetId:t.model.dataset.get("datasetId"),featureCollection:t.model,callback:function(e){return $.when(t.model.updateDownloadOptions(e))}});e.open()}),this.exportButton=$('<button data-role="button" data-inline="true" data-mini="true" title="Export highlighted products (KLM, GeoJson)">Export</button>').appendTo(e),this.exportButton.button(),this.exportButton.button("disable"),this.exportButton.click(function(){var e=new c(t.model);e.open()})}});i.exports=p}),require.register("searchResults/view/searchResultsView",function(e,t,i){var a=t("logger"),s=t("search/model/datasetSearch"),r=t("searchResults/template/searchResultsViewContent"),n=Backbone.View.extend({id:"resultsBar",initialize:function(){this.listenTo(this.model,"startLoading",this.onStartLoading),this.listenTo(this.model,"reset:features",this.onResetFeatures),this.listenTo(this.model,"add:features",this.onAddFeatures),this.listenTo(this.model,"error:features",function(e){a.error("An error occured when retrieving the products with the search url :<br>"+e),this.$el.find("#resultsMessage").removeClass("pulsating").html("No product found")})},events:{"click #paging_first":function(){this.model.changePage(1)},"click #paging_last":function(){this.model.changePage(this.model.lastPage)},"click #paging_next":function(){this.model.changePage(this.model.currentPage+1)},"click #paging_prev":function(){this.model.changePage(this.model.currentPage-1)}},onStartLoading:function(){this.$el.find("#paging a").addClass("ui-disabled");var e=this.$el.find("#resultsMessage");e.html("Searching..."),e.addClass("pulsating"),e.show()},onAddFeatures:function(e){var t=this.$el.find("#resultsMessage");if(t.removeClass("pulsating"),this.model.totalResults>0){var i=1+(this.model.currentPage-1)*this.model.countPerPage;t.html("Showing "+i+" to "+(i+e.length-1)+" of "+this.model.totalResults+" products."),this.$el.find("#paging a").removeClass("ui-disabled"),1==this.model.currentPage&&(this.$el.find("#paging_prev").addClass("ui-disabled"),this.$el.find("#paging_first").addClass("ui-disabled")),this.model.currentPage==this.model.lastPage&&(this.$el.find("#paging_next").addClass("ui-disabled"),this.$el.find("#paging_last").addClass("ui-disabled"))}else 0==this.model.totalResults?(this.$el.find("#paging a").addClass("ui-disabled"),t.html("No product found.")):t.html("No search done.")},onResetFeatures:function(){this.$el.find("#paging a").addClass("ui-disabled");var e=this.$el.find("#resultsMessage");e.hide()},render:function(){if(this.$el.html(r()),this.$el.trigger("create"),"Simple"==s.get("mode"))this.$el.find("#datasetMessage").html("Dataset : "+this.model.id).attr("title",this.model.id);else{var e=s.get("master")+" with "+s.slaves.join(",");this.$el.find("#datasetMessage").html("Dataset : "+e).attr("title",e),s.on("change:master",function(){var e=s.get("master")+" with "+s.slaves.join(",");this.$el.find("#datasetMessage").html("Dataset : "+e).attr("title",e)},this)}this.$el.find("#paging a").addClass("ui-disabled")}});i.exports=n}),require.register("searchResults/widget/downloadOptionsWidget",function(e,t,i){var a=t("search/view/downloadOptionsView"),s=(t("search/model/datasetSearch"),t("search/model/dataSetPopulation")),r=t("search/model/downloadOptions"),n=function(e){this.featureCollection=e.featureCollection,this.datasetId=e.datasetId?e.datasetId:e.featureCollection.dataset.get("datasetId"),this.callback=e.callback,this.parentElement=$('<div id="downloadOptionsPopup">		<div id="downloadOptionsPopupContent"></div>	</div>').appendTo(".ui-page-active");var t=this;this.parentElement.ngeowidget({title:"Download Options",hide:function(){t.parentElement.remove()}})};n.prototype.open=function(){var e=this;s.fetchDataset(this.datasetId,function(t){var i=t.get("downloadOptions");e.widgetDownloadOptions=new r(i);for(var a=e.featureCollection.getSelectedDownloadOptions(),s=0;s<i.length;s++){var n=i[s].argumentName;if("true"==i[s].cropProductSearchArea)e.widgetDownloadOptions.attributes[n]=a.hasOwnProperty(n)?a.hasOwnProperty(n):null;else if(a[n]&&"@conflict"!=a[n])e.widgetDownloadOptions.setValue(n,a[n]);else{for(var o=_.findWhere(e.widgetDownloadOptions.collection,{argumentName:n}),l=0;l<o.value.length;l++)delete o.value[l].selected;e.widgetDownloadOptions.attributes[n]="select-with-none"==o.type?"@none":"@conflict"}}e.spawnPopup()})},n.prototype.close=function(){this.parentElement.ngeowidget("hide")},n.prototype.spawnPopup=function(){var e=this,t=new a({model:e.widgetDownloadOptions,el:this.parentElement.find("#downloadOptionsPopupContent"),updateCallback:function(){return $.when(e.callback(e.widgetDownloadOptions))}});t.render(),this.parentElement.ngeowidget("show")},i.exports=n}),require.register("searchResults/widget/exportWidget",function(e,t,i){var a=(t("configuration"),t("searchResults/view/exportView")),s=(t("ui/widget"),function(e){var t=$('<div id="exportPopup">'),i=$('<div id="exportPopupContent"></div>');i.css("min-width","200px"),i.appendTo(t),t.appendTo(".ui-page-active"),t.ngeowidget({title:"Export",hide:function(){t.remove()}});var s=new a({model:e,el:i});this.open=function(){s.render(),t.ngeowidget("show")},this.close=function(){t.ngeowidget("hide")}});i.exports=s}),require.register("searchResults/widget/multipleBrowseWidget",function(e,t,i){var a=t("configuration"),s=t("searchResults/browsesManager"),r=t("map/utils"),n=t("searchResults/template/multipleBrowseContent");i.exports={open:function(e){var t=e.feature,i=e.featureCollection,o=a.getMappedProperty(t,"browses"),l=[];_.isArray(o)&&o.forEach(function(e){e.BrowseInformation.fileName.ServiceReference["@"].href.upperCase().indexOf("SERVICE")>-1&&l.push(o)});var d=$(n({feature:t,browses:l,MapUtils:r}));d.appendTo(".ui-page-active"),d.popup({afterclose:function(e,t){$(this).remove(),d=null}}),d.trigger("create"),d.find(".selectBrowse").click(function(t){d.popup("close");for(var r=(parseInt(d.find("input:checked").val()),_.toArray(d.find("input:checked").map(function(e,t){return parseInt($(t).val())}))),n=_.toArray(d.find("input:not(:checked)").map(function(e,t){return parseInt($(t).val())})),o=0;o<i.features.length;o++){var l=i.features[o];a.getMappedProperty(l,"browses");l._featureCollection.isHighlighted(l)&&(s.addBrowse(l,i.id,r),s.removeBrowse(l,n))}i.browseIndex=r,e.onSelect&&e.onSelect()}),d.popup("open")}}}),require.register("search/dsa",function(e,t,i){var a=t("logger"),s=t("userPrefs"),r=t("ui/menubar"),n=t("search/model/datasetSearch"),o=t("search/model/dataSetPopulation"),l=t("search/model/datasetAuthorizations"),d=t("searchResults/model/searchResults"),c=t("dataAccess/model/standingOrderDataAccessRequest"),h=t("search/view/datasetSelectionView"),u=t("search/view/searchCriteriaView"),p=t("search/model/standingOrder"),g=t("search/view/standingOrderView"),f=t("configuration");i.exports={initialize:function(e,t,i){var m=new h({model:o}),v=[],w=function(){for(var e=0;e<v.length;e++)v[e]();$("#dataset").removeClass("ui-disabled"),i.on("leftResized",m.updateContentHeight,m),i.left.add(m,"#dataset"),m.render()},b=function(){"rejected"==S.state()?(a.error("Cannot retreive the DataSet Authorizations from the server"),y.done(w)):($("#dataset").addClass("ui-disabled"),a.error("Cannot retreive the DataSetPopulationMatrix and/or DataSet Authorizations from the server"))},y=o.fetch(),S=l.fetch();$.when(y,S).then(w,b);var D=new u({model:n}),x=new p,C=new g({model:x});i.on("leftResized",D.updateContentHeight,D),i.on("leftResized",C.updateContentHeight,C),i.left.add(D,"#search"),i.left.add(C,"#subscribe"),D.render(),C.render(),f.data.behindSSO&&f.data.subscribe.enable||$("#subscribe").hide(),t.route("data-services-area/search?:query","search",function(e){var t=JSON.parse(e.substr(e.indexOf("{"))),i=_.keys(_.omit(t,"commonCriteria")),s=i.length;r.showPage("data-services-area");var l=function(e,i){var c=e.get("datasetId");if("SUCCESS"==i){var h=t.commonCriteria;t[c]&&(h+="&"+t[c]),n.populateModelfromURL(h,c),D.refresh()}else a.error("Cannot load the dataset "+c+".<br> The search cannot be shared."),r.showPage("data-services-area");0==--s&&(o.off("datasetFetch",l),n.set({start:n.get("start"),stop:n.get("stop")}),d.launch(n),$("#search").click())};v.push(function(){o.on("datasetFetch",l),_.each(i,function(e){o.select(e)})})}),t.route("data-services-area/sto/:datasetId?:query","sto",function(e,t){r.showPage("data-services-area"),o.once("datasetFetch",function(e,i){"SUCCESS"==i?(x.populateModelfromURL(t),c.populateModelfromURL(t,x),C.refresh(),$("#subscribe").click()):(a.error("Cannot load the dataset "+e+".<br> The standing order cannot be shared."),r.showPage("data-services-area"))}),v.push(function(){o.select(e)})}),t.route("data-services-area","dsa",function(){v.push(function(){var e=s.get("Dataset");if(e&&"None"!=e&&_.isString(e))for(var t=e.split(","),i=0;i<t.length;i++)o.select(t[i])}),r.showPage("data-services-area")});var P=function(e){var t=n.datasetIds.length;0==t?(s.save("Dataset","None"),$("#subscribe").addClass("ui-disabled"),$("#search").addClass("ui-disabled")):1==t?(s.save("Dataset",n.getDatasetPath()),l.hasDownloadAccess(n.getDatasetPath())?$("#subscribe").removeClass("ui-disabled"):$("#subscribe").addClass("ui-disabled"),$("#search").removeClass("ui-disabled")):(s.save("Dataset",n.getDatasetPath()),$("#subscribe").addClass("ui-disabled"))};o.on("select",P),o.on("unselect",P)}}}),require.register("search/model/dataSetPopulation",function(e,t,i){var a=t("configuration"),s=t("search/model/dataset"),r=(t("search/model/datasetAuthorizations"),function(e){this.title=e,this.selectedValue="",this.possibleValues=[]});r.prototype.addValue=function(e){""==e||_.contains(this.possibleValues,e)||this.possibleValues.push(e)};var n=Backbone.Model.extend({defaults:{criterias:null,matrix:null},initialize:function(){this.url=a.baseServerUrl+"/datasetPopulationMatrix",this.selection={},this.cache={},this._usableForInterferomtry={}},fetchDataset:function(e,t){if(this.cache.hasOwnProperty(e))t&&t(this.cache[e]);else{var i=this,a=new s({datasetId:e});a.fetch({success:function(a){i.cache[e]=a,t(a)},error:function(){i.trigger("datasetFetch",e,"ERROR")}})}},select:function(e){if(!this.selection.hasOwnProperty(e)){var t=this;this.fetchDataset(e,function(i){t.selection[e]=i,t.trigger("select",i),t.trigger("datasetFetch",i,"SUCCESS")})}},selectExclusive:function(e){var t=this.selection;this.selection={};for(var i in t)this.trigger("unselect",t[i]);this.select(e)},unselect:function(e){if(this.selection.hasOwnProperty(e)){var t=this.selection[e];delete this.selection[e],this.trigger("unselect",t)}},usableForInterferometry:function(e){return this._usableForInterferomtry[e]},parse:function(e){var t=this,i=e.datasetpopulationmatrix.datasetPopulationValues,a=e.datasetpopulationmatrix.criteriaTitles,s=[],n=a.indexOf("usableForInterferometry");if(n>=0)for(var o=0;o<i.length;o++){var l=i[o];this._usableForInterferomtry[l[l.length-2]]="true"==l[n]}var d=a.indexOf("name");if(d>=0){a.splice(d,1);for(var o=0;o<i.length;o++){var l=i[o];l.push(l[d]),l.splice(d,1)}}this.datasetInfoMap={},this.keywordIndex=e.datasetpopulationmatrix.criteriaTitles.indexOf("keyword");for(var c=0;c<i.length;c++){var h=i[c][a.length];this.datasetInfoMap[h]||(this.datasetInfoMap[h]={rows:[],keywords:{}}),this.datasetInfoMap[h].rows.push(i[c]);var u=i[c][this.keywordIndex];if(""!=u){var p=Object.keys(u)[0],g=_.findWhere(s,{title:p});g||(g=new r(p),s.push(g)),u[p].forEach(function(e){g.addValue(e)}),this.datasetInfoMap[h].keywords[p]||(this.datasetInfoMap[h].keywords[p]=[]),u[p].forEach(function(e){t.datasetInfoMap[h].keywords[p].push(e)})}}return{criterias:s,criteriaLength:a.length,matrix:i}},filterCriteriaValues:function(e,t){for(var i=[],a=0;a<e.length;a++){var s=this.datasetInfoMap[e[a].datasetId];for(var r in s.keywords)for(var n=0;n<s.keywords[r].length;n++){var o=s.keywords[r][n];r!=t.title||""!=t.selectedValue&&t.selectedValue!=o||_.contains(i,o)||i.push(o)}}return i},getFriendlyName:function(e){var t=this.get("criteriaLength"),i=this.get("criteriaLength")+2,a=_.find(this.get("matrix"),function(i){return i[t]==e});return a[i]?a[i]:a[t]},filterDatasets:function(e){var t=[],i=(this.get("criteriaLength"),this.get("criteriaLength")+1),a=this.get("criteriaLength")+2;for(var s in this.datasetInfoMap){var r=this.datasetInfoMap[s],n=!0,o=_.filter(e,function(e){return e.selectedValue});if(o.length)for(var l=r.rows[0],d=0;d<o.length;d++){var c=o[d];n&=_.contains(r.keywords[c.title],c.selectedValue)}if(n){var l=r.rows[0];t.push({datasetId:s,tagFriendlyId:s.replace(/\W/g,"_"),name:a<l.length?l[a]:s,itemsCount:l[i]})}}return t}});i.exports=new n}),require.register("search/model/dataset",function(e,t,i){var a=t("configuration"),s=["start","stop","geom","bbox","id","lat","lon","radius","rel","loc"],r=Backbone.Model.extend({defaults:{description:"",keywords:null,downloadOptions:[],attributes:null,datasetId:"",startDate:null,endDate:null,validityEndDate:null,startIndex:1,countPerPage:null},initialize:function(){this.url=a.baseServerUrl+"/datasetSearchInfo/"+this.get("datasetId"),this.listenTo(this,"error",this.onError),this.tagFriendlyId=this.get("datasetId").replace(/\W/g,"_")},onError:function(e,t){0==t.status&&location.reload()},hasKeyword:function(e){return this.get("keywords").indexOf(e)>=0},parse:function(e,t){var i={};return e.datasetSearchInfo&&(i.description=e.datasetSearchInfo.description,_.isArray(e.datasetSearchInfo.downloadOptions)&&(i.downloadOptions=_.reject(e.datasetSearchInfo.downloadOptions,function(e){return _.contains(s,e.argumentName)})),_.isArray(e.datasetSearchInfo.attributes)&&(i.attributes=_.reject(e.datasetSearchInfo.attributes,function(e){return _.contains(s,e.id)})),_.isArray(e.datasetSearchInfo.keywords)&&(i.keywords=_.pluck(e.datasetSearchInfo.keywords,"keyword")),e.datasetSearchInfo.endDate?i.endDate=Date.fromISOString(e.datasetSearchInfo.endDate):i.endDate=new Date,e.datasetSearchInfo.startDate?i.startDate=Date.fromISOString(e.datasetSearchInfo.startDate):(i.startDate=new Date(i.endDate.getTime()),i.startDate.setUTCFullYear(i.endDate.getUTCFullYear()-10)),e.datasetSearchInfo.validityEndDate?i.validityEndDate=Date.fromISOString(e.datasetSearchInfo.validityEndDate):(i.validityEndDate=new Date(i.endDate.getTime()),i.validityEndDate.setUTCFullYear(i.endDate.getUTCFullYear()+5)),e.datasetSearchInfo.hasOwnProperty("startIndex")&&(i.startIndex=e.datasetSearchInfo.startIndex),e.datasetSearchInfo.hasOwnProperty("countPerPage")&&(i.countPerPage=e.datasetSearchInfo.countPerPage)),i}});i.exports=r}),require.register("search/model/datasetAuthorizations",function(e,t,i){var a=t("configuration"),s=Backbone.Model.extend({defaults:{authorizations:null},initialize:function(){this.url=a.baseServerUrl+"/datasetAuthorization"},parse:function(e){return{authorizations:e.datasetAuthorisationInfo}},hasSearchAccess:function(e){var t=_.findWhere(this.get("authorizations"),{dataSetId:e});return t?"YES"==t.searchAccessGranted:!0},hasDownloadAccess:function(e){var t=_.findWhere(this.get("authorizations"),{dataSetId:e});return t?"YES"==t.downloadAccessGranted:!0},hasBrowseAuthorization:function(e,t){var i=_.findWhere(this.get("authorizations"),{dataSetId:e});if(!i)return!0;if(!_.isUndefined(i.viewAccessGranted))return"YES"==i.viewAccessGranted;var a=i.browseLayerAuthorizations;if(!a||!_.isArray(a))return!0;for(var s=0;s<a.length;s++)if(a[s].browseLayerId==t)return"YES"==a[s].viewAccessGranted;return!0},hasViewAccess:function(e){var t=_.findWhere(this.get("authorizations"),{dataSetId:e});if(!t)return!0;if(!_.isUndefined(t.viewAccessGranted))return"YES"==t.viewAccessGranted;var i=t.browseLayerAuthorizations;if(!i||!_.isArray(i))return!0;for(var a=!0,s=0;s<i.length;s++)a&="YES"==i[s].viewAccessGranted;return a}});i.exports=new s}),require.register("search/model/datasetSearch",function(e,t,i){var a=t("configuration"),s=t("search/model/dataSetPopulation"),r=t("search/model/searchCriteria"),n=2592e6,o=r.extend({defaults:_.extend({},r.prototype.defaults.call(this),{useTimeSlider:!0,mode:"Simple",timeCover:[0,30],spatialCover:25,baseline:[0,5],burstSync:[0,100],master:""}),name:"Search",initialize:function(){r.prototype.initialize.apply(this,arguments),this.datasetIds=[],this.slaves=[],this.numDatasets=0},getOpenSearchURL:function(e){var t=a.serverHostName+a.baseServerUrl+"/catalogue/",i=e.id;if("Simple"!=this.get("mode"))t+=this.get("master")+"/search?",t+=this.getOpenSearchParameters(i),t+=this.getInterferometryParameters(i);else{var i=e&&e.hasOwnProperty("id")?e.id:this.datasetIds.join(",");t+=i+"/search?",t+=this.getOpenSearchParameters(i)}var s=e&&e.hasOwnProperty("format")?e.format:"json";return t+="&format="+s},getSharedSearchURL:function(){for(var e=("#data-services-area/search/"+this.datasetIds.join(",")+"?",{}),t=0;t<this.datasetIds.length;t++){var i=this.datasetIds[t],a=this.addAdvancedCriteria("",i);a=this.addDownloadOptions(a,i),a=a.substr(1),"Simple"!=this.get("mode")&&(a+="&dDiff="+this.get("dDiff")+"&sOverP="+this.get("sOverP")+"&nBase="+this.get("nBase")+"&bSync="+this.get("bSync"),a+="&mode="+this.get("mode")),e[i]=a}return e.commonCriteria=this.addGeoTemporalParams(),"#data-services-area/search?osParameters="+escape(JSON.stringify(e))},getInterferometryParameters:function(e){var t="&timeCover=["+this.get("timeCover")+"]&spatialCover="+this.get("spatialCover")+"]&baseline=["+this.get("baseline")+"]&burstSync=["+this.get("burstSync")+"]",i=a.serverHostName+a.baseServerUrl+"/catalogue/";return i+=this.slaves+"/search?",i+=this.getOpenSearchParameters(e),t+="&correlatedTo="+encodeURIComponent(i)+"&corFunction=interferometry"},getDatasetPath:function(){return"Simple"==this.get("mode")?this.datasetIds.join(","):this.get("master")},computeDateRange:function(){var e=null;_.each(s.selection,function(t){e?(t.get("startDate")<e.start&&(e.start=t.get("startDate")),t.get("endDate")>e.stop&&(e.stop=t.get("endDate"))):e={start:t.get("startDate"),stop:t.get("endDate")}}),this.set("dateRange",e)},setMaster:function(e){var t=this.datasetIds.indexOf(e);t>=0&&(this.slaves=this.datasetIds.slice(0),this.slaves.splice(t,1),this.set("master",e))},setMode:function(e){if("Simple"!=e){this.slaves=this.datasetIds.slice(0);var t=this.slaves.shift();0==this.slaves.length&&this.slaves.push(t),this.set("master",t)}else this.set("master",""),this.slaves="";this.set("mode",e)},isInterferometrySupported:function(){if(0==this.datasetIds.length)return!1;if(this.datasetIds.length>2)return!1;for(var e in s.selection){s.selection[e];if(!s.usableForInterferometry(e))return!1}return!0},onDatasetSelectionChanged:function(e){this.datasetIds=[];for(var t in s.selection)this.datasetIds.push(t);if(r.prototype.onDatasetSelectionChanged.call(this,e),this.computeDateRange(),this.get("dateRange")){var i=this.get("start"),a=this.get("stop"),o=this.get("dateRange").start,l=this.get("dateRange").stop;if(a>l||o>i){a=new Date,o>a&&(a=new Date(o.getTime()+n)),a>l&&(a=new Date(l.getTime()));var d=l-o;i=d>n?new Date(a.getTime()-n):new Date(o.getTime()),i.setUTCHours(0),i.setUTCMinutes(0),i.setUTCSeconds(0),i.setUTCMilliseconds(0),a.setUTCHours(23),a.setUTCMinutes(59),a.setUTCSeconds(59),a.setUTCMilliseconds(999),this.set({start:i,stop:a})}}}});i.exports=new o}),require.register("search/model/downloadOption",function(e,t,i){var a=function(e,t){this.parent=e,this.argumentName=t.argumentName,this.caption=t.caption||"",this.description=t.description||"",this.minOccurs=t.hasOwnProperty("minOccurs")?parseInt(t.minOccurs):1,this.maxOccurs=t.hasOwnProperty("maxOccurs")?parseInt(t.maxOccurs):1,this.value=_.cloneDeep(t.value),this.preConditions=t.preConditions||null,this.cropProductSearchArea=t.hasOwnProperty("cropProductSearchArea")?t.cropProductSearchArea:!1,this.type=1==this.minOccurs&&1==this.maxOccurs?"select":0==this.minOccurs&&1==this.maxOccurs?"select-with-none":"checkbox","select-with-none"==this.type&&this.value.unshift({humanReadable:"None",name:"@none",sizeFactor:1})};a.prototype.getValidValue=function(){var e=_.filter(this.value,function(e){return 1==Boolean(e.selected)});if("checkbox"==this.type){if(e.length){var t=this;return _.filter(e,function(e){return t.parent.hasValidPreconditions(e)}).map(function(e){return e.name})}return[]}if(1==e.length&&this.parent.hasValidPreconditions(e[0]))return e[0].name;for(var i=0;i<this.value.length;i++){var a=this.value[i];if(this.parent.hasValidPreconditions(a))return a.name}return null},i.exports=a}),require.register("search/model/downloadOptions",function(e,t,i){var a=t("search/model/downloadOption"),s=function(e,t){this.collection=[],this.attributes={};for(var i=0;i<e.length;i++){var s=new a(this,e[i]);if(this.collection.push(s),t&&t.init)if(s.cropProductSearchArea)this.setValue(s.argumentName,Boolean(s.cropProductSearchArea));else{var r=s.getValidValue();this.setValue(s.argumentName,r)}}};s.extractParamsFromUrl=function(e){var t=e.indexOf("ngEO_DO={");t>=0&&(e=e.substring(t+9,e.length-1));for(var i={},a=e.match(/([\b\s\w]+):/gm),s=[],r=0;r<a.length-1;r++){var n=e.substring(e.indexOf(a[r]),e.indexOf(a[r+1])-1);s.push(n)}s.push(e.substring(e.indexOf(a[a.length-1])));for(var o=0;o<s.length;o++){var l=s[o].split(":");if(2!=l.length)throw"Invalid OpenSearch URL : download option parameter "+s[o]+"not correctly defined.";l[1].indexOf("[")>=0&&(l[1]=JSON.parse(l[1].replace(/([^,\[\]]*)/g,function(e,t){return e?'"'+t+'"':""}))),i[l[0]]="cropProduct"==l[0]?!0:l[1]}return i},s.prototype.populateFromUrl=function(e){this.attributes=s.extractParamsFromUrl(e);var t=_.findWhere(this.collection,{cropProductSearchArea:"true"});t&&(this.attributes[t.argumentName]=_.find(_.keys(this.attributes),function(e){return e.indexOf("crop")>=0})?"true":!1)},s.prototype.updateFrom=function(e){this.collection=_.cloneDeep(e.collection),this.attributes=_.cloneDeep(e.attributes)},s.prototype.setValue=function(e,t){var i=_.findWhere(this.collection,{argumentName:e});if(i&&i.value)for(var a=0;a<i.value.length;a++){var s=i.value[a];t&&-1!=t.indexOf(s.name)?s.selected=!0:delete s.selected}t?this.attributes[e]=t:delete this.attributes[e],this.updatePreconditions()},s.prototype.getAttributes=function(){return _.omit(this.attributes,function(e){return null==e||"@conflict"==e||"@none"==e})},s.prototype.getSelectedValues=function(e){var t=_.findWhere(this.collection,{argumentName:e});return _.filter(t.value,function(e){return 1==e.selected}).map(function(e){return e.name})},s.prototype.updatePreconditions=function(){var e=this;_.each(this.collection,function(t){if(e.hasValidPreconditions(t)){if(!t.cropProductSearchArea){var i=e.getSelectedValues(t.argumentName);if(i.length||"@conflict"==e.attributes[t.argumentName])if("checkbox"==t.type){var a=_.filter(t.value,function(t){return t.selected&&e.hasValidPreconditions(t)}),s=a.map(function(e){return e.name});0==s.length?delete e.attributes[t.argumentName]:e.attributes[t.argumentName]=s}else{
var r=_.findWhere(t.value,{name:i[0]});"@conflict"!=i&&r&&!e.hasValidPreconditions(r)?e.attributes[t.argumentName]=t.getValidValue():e.attributes[t.argumentName]=i.length>0?i[0]:"select-with-none"==t.type?"@none":"@conflict"}else"checkbox"==t.type||(e.attributes[t.argumentName]=t.getValidValue())}}else delete e.attributes[t.argumentName]})},s.prototype.hasValidPreconditions=function(e){if(!e.preConditions)return!0;var t=this,i=!1;return _.each(e.preConditions,function(e){var a=_.findWhere(t.collection,{argumentName:e.parentDownloadOption});if(t.hasValidPreconditions(a)){var s=_.findWhere(a.value,{name:e.parentDownloadValue});i|=s.selected}}),i},s.prototype.getParameters=function(){var e=_.find(this.collection,function(e){return Boolean(e.cropProductSearchArea)}),i=t("search/model/datasetSearch"),a=function(t,a){return e&&t==e.argumentName&&a===!0&&(a=i.searchArea.toWKT()),a};return JSON.stringify(this.getAttributes(),a).replace(/\"/g,"")},s.prototype.getAsUrlParameters=function(){var e="",t=this.getParameters();return"{}"!=t&&(e="ngEO_DO="+t),e},i.exports=s}),require.register("search/model/searchArea",function(e,t,i){function a(e){return isNaN(e)?!1:e>=-180&&180>=e}function s(e){return isNaN(e)?!1:e>=-90&&90>=e}var r=(t("map/map"),t("map/utils"),t("map/geojsonconverter")),n=t("map/rectangle"),o=t("map/degreeConvertor"),l=function(e,t){if("undefined"!=typeof t&&t>=0){var i=Math.pow(10,t);return(Math.floor(e*i)/i).toString()}return e.toString()},d=function(){var e={id:"0",bbox:[-180,-90,180,90],type:"Feature",geometry:{type:"Polygon",coordinates:[[[-180,-90],[180,-90],[180,90],[-180,90],[-180,-90]]]},properties:{}},t=d.BBOX,i=function(){if(t==d.BBOX){var i=new n({west:e.bbox[0],south:e.bbox[1],east:e.bbox[2],north:e.bbox[3]});e.geometry.coordinates=i.feature.geometry.coordinates,e.geometry.type=i.feature.geometry.type}else{for(var a=e.geometry.coordinates[0],s=a[0][0],r=a[0][1],o=a[0][0],l=a[0][1],c=1;c<a.length;c++)s=Math.min(s,a[c][0]),r=Math.min(r,a[c][1]),o=Math.max(o,a[c][0]),l=Math.max(l,a[c][1]);e.bbox=[s,r,o,l]}},c=function(e){if(!r.toGeoJSON(e))return{valid:!1,message:"format not supported or invalid."};var t;if("FeatureCollection"==e.data.type){if(1!=e.data.features.length)return{valid:!1,message:"file must have only one feature, "+e.data.features.length+" found"};t=e.data.features[0]}else t=e.data;return"Feature"!=t.type?{valid:!1,message:"invalid feature"}:"Polygon"!=t.geometry.type?{valid:!1,message:"feature must be a polygon"}:{valid:!0,feature:t}};this.getMode=function(){return t},this.setMode=function(e){t=e},this.getBBox=function(){return{west:e.bbox[0],south:e.bbox[1],east:e.bbox[2],north:e.bbox[3]}},this.getFeature=function(){return e},this.getPolygonText=function(){for(var t=e.geometry.coordinates[0],i="",a=0;a<t.length;a++)i+=o.toDMS(t[a][1],!0,{positionFlag:"number"})+" "+o.toDMS(t[a][0],!1,{positionFlag:"number"})+"\n";return i},this.toWKT=function(t){var i=e.geometry.coordinates,a="POLYGON(";if("MultiLineString"==e.geometry.type){var s=new n({west:e.bbox[0],south:e.bbox[1],east:e.bbox[2],north:e.bbox[3],type:"Polygon"});i=s.feature.geometry.coordinates}for(var r=0;r<i.length;r++){0!=r&&(a+=","),a+="(";for(var o=0;o<i[r].length;o++)0!=o&&(a+=","),a+=l(i[r][o][0],t)+" "+l(i[r][o][1],t);a+=")"}return a+=")"},this.getOpenSearchParameter=function(i){var a;return t==d.POLYGON?a="geom="+this.toWKT(i):t==d.BBOX&&(a="bbox="+l(e.bbox[0],i)+","+l(e.bbox[1],i)+","+l(e.bbox[2],i)+","+l(e.bbox[3],i)),a},this.empty=function(){e.bbox=[0,0,0,0],e.geometry.coordinates=[[[0,0]]],t=d.EMPTY,i()},this.setBBox=function(a){e.bbox=[a.west,a.south,a.east,a.north],t=d.BBOX,i()},this.setFromLayer=function(a){var s=c(a);return s.valid&&(e.geometry.coordinates=s.feature.geometry.coordinates,t=d.POLYGON,i()),s},this.setPolygonFromText=function(r){var n=o.textToDecimalDegrees(r);if(0==n.length)return this.empty(),!1;for(var l=0;l<n.length;l++)if(!a(n[l][0])||!s(n[l][1]))return!1;return(n[0][0]!=n[n.length-1][0]||n[0][1]!=n[n.length-1][1])&&n.push(n[0]),e.geometry.coordinates=[n],t=d.POLYGON,i(),!0},this.setFromWKT=function(a){var s=/POLYGON\(\(([^\)]+)\)\)/gm,r=s.exec(decodeURIComponent(a));if(r)o=r[1];else{var n=/MULTIPOLYGON\(\(\(([^\)]+)/gm;r=n.exec(decodeURIComponent(a))}if(r){for(var o=r[1],l=o.split(","),c=[],h=0;h<l.length;h++){var u=l[h].split(/\s+/),p=parseFloat(u[1]),g=parseFloat(u[0]);c.push([g,p])}e.geometry.coordinates=[c],t=d.POLYGON,i()}}};d.BBOX=0,d.POLYGON=1,d.EMPTY=-1,i.exports=d}),require.register("search/model/searchCriteria",function(e,t,i){function a(e,t){for(var i=e+"";i.length<t;)i="0"+i;return i}var s=t("configuration"),r=t("search/model/searchArea"),n=t("search/model/downloadOptions"),o=t("search/model/dataSetPopulation");Date.fromISOString=function(e){var t=/(\d+)-(\d+)-(\d+)(?:T(\d+):(\d+)(?::(\d+)(?:.(\d+))?)?Z)?/,i=t.exec(e);if(i){if(i[1].length<i[3].length){var a=i[1];i[1]=i[3],i[3]=a}i[7]&&i.length>3&&(i[7]=i[7].substr(0,3));var s=new Date(Date.UTC(i[1],i[2]-1,i[3],i[4]||0,i[5]||0,i[6]||0,i[7]||0));return s}throw"Invalid ISO date"},Date.prototype.toISODateString=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1,2)+"-"+a(this.getUTCDate(),2)};var l=2592e6,d=Backbone.Model.extend({defaults:function(){return{stop:new Date,start:new Date((new Date).getTime()-l),useExtent:!0,advancedAttributes:{},downloadOptions:{}}},initialize:function(){this.searchArea=new r,this.listenTo(o,"select",this.onDatasetSelectionChanged),this.listenTo(o,"unselect",this.onDatasetSelectionChanged)},getOpenSearchParameters:function(e){var t=this.addGeoTemporalParams();return t=this.addAdvancedCriteria(t,e),t=this.addDownloadOptions(t,e)},getSharedSearchURL:function(){var e="#data-services-area/search/"+this.getDatasetPath()+"?";return e+=this.getOpenSearchParameters()},populateModelfromURL:function(e,t){("?"==e.charAt(0)||"&"==e.charAt(0))&&(e=e.substr(1));var i=e.split("&");this.set("useExtent",!1);for(var a=0;a<i.length;a++){var s=i[a].split("=");if(2!=s.length)throw"Invalid OpenSearch URL : parameter "+i[a]+"not correctly defined.";var r=s[0],n=s[1];switch(r){case"bbox":var o=n.split(",");if(4!=o.length)throw"Invalid OpenSearch URL : bbox parameter is not correct.";this.searchArea.setBBox({west:parseFloat(o[0]),south:parseFloat(o[1]),east:parseFloat(o[2]),north:parseFloat(o[3])});break;case"geom":this.searchArea.setFromWKT(n);break;case"start":try{this.set("start",Date.fromISOString(n))}catch(l){throw"Invalid OpenSearch URL : start parameter is not correct."}break;case"stop":try{this.set("stop",Date.fromISOString(n))}catch(l){throw"Invalid OpenSearch URL : stop parameter is not correct."}break;case"ngEO_DO":var d=n.substr(1,n.length-2),c=this.get("downloadOptions")[t];c.populateFromUrl(d),this.trigger("change:downloadOptions");break;default:if(this.has(r))this.set(r,n);else{var h=this.get("advancedAttributes")[t],u=_.findWhere(h,{id:r});u&&(u.value=n,this.trigger("change:advancedAttributes"))}}}this.trigger("change:searchArea")},addGeoTemporalParams:function(){var e="start="+this.get("start").toISOString()+"&stop="+this.get("stop").toISOString(),t=this.searchArea.getOpenSearchParameter(s.get("search.geometryPrecision",2));return t&&(e+="&"+t),e},addAdvancedCriteria:function(e,t){var i=this.get("advancedAttributes")[t];if(i){var a=[];_.each(i,function(e){e.value&&a.push(e.id+"="+e.value)}),a.length&&(e+="&",e+=a.join("&"))}return e},addDownloadOptions:function(e,t){var i=this.get("downloadOptions")[t];if(i){var a=i.getAsUrlParameters();a&&(e+="&",e+=a)}return e},getSelectedDownloadOptions:function(e){var t={},i=e.get("datasetId"),a=this.get("downloadOptions")[i];return a&&(t=a.attributes),t},onDatasetSelectionChanged:function(e){var t=e.get("datasetId");this.get("advancedAttributes")[t]?(delete this.get("advancedAttributes")[t],delete this.get("downloadOptions")[t]):(this.get("advancedAttributes")[t]=_.map(e.get("attributes"),_.clone),this.get("downloadOptions")[t]=new n(e.get("downloadOptions"),{init:!0}))}});i.exports=d}),require.register("search/model/standingOrder",function(e,t,i){var a=t("configuration"),s=t("search/model/dataSetPopulation"),r=t("search/model/searchCriteria"),n=r.extend({name:"Subscribe",initialize:function(){r.prototype.initialize.apply(this,arguments),this.dataset=void 0},getDatasetPath:function(){return this.dataset?this.dataset.get("datasetId"):""},populateModelfromURL:function(e){this.dataset&&r.prototype.populateModelfromURL.call(this,e,this.dataset.get("datasetId"))},getOpenSearchURL:function(e){var t=a.serverHostName+a.baseServerUrl+"/catalogue/";t+=this.getDatasetPath()+"/search?",this.dataset&&(t+=this.getOpenSearchParameters(this.dataset.get("datasetId")));var i=e&&e.hasOwnProperty("format")?e.format:"json";return t+="&format="+i},getSelectedDownloadOptions:function(){return this.dataset?r.prototype.getSelectedDownloadOptions.call(this,this.dataset):{}},onDatasetSelectionChanged:function(e){r.prototype.onDatasetSelectionChanged.call(this,e);var t=_.values(s.selection);1==t.length?this.dataset=t[0]:this.dataset=void 0}});i.exports=n}),require.register("search/view/advancedSearchView",function(e,t,i){var a=t("configuration"),s=t("search/template/advancedCriteriaContent"),r=t("logger"),n=Backbone.View.extend({id:"advancedSearchView",initialize:function(e){this.listenTo(this.model,"change:advancedAttributes",this.render),this.dataset=e.dataset,this.advancedAttributes=this.model.get("advancedAttributes")[this.dataset.get("datasetId")]},events:{"slidestop input":function(e){this.setInputCriterionValues(e)},"blur input":function(e){this.setInputCriterionValues(e)},"change select":function(e){var t=e.currentTarget.id,i=$(e.currentTarget).val(),a=_.findWhere(this.advancedAttributes,{id:t});""!=i?(a.value=i,$(e.currentTarget).closest(".ui-select").addClass("oneValue")):(delete a.value,$(e.currentTarget).closest(".ui-select").removeClass("oneValue"))},'change input[type="checkbox"]':function(e){var t=$(e.target).is(":checked"),i=$(e.currentTarget).attr("name"),a=$(e.target).val(),s=_.findWhere(this.advancedAttributes,{id:i}),r=s.value;if(t)-1!=a.indexOf(",")&&(a='"'+a+'"'),r?r+=","+a:r=a,s.value=r;else{var n=null,o=r.indexOf('"')>=0;if(o){var l=new RegExp(/(\w{1,}[,-\s+\w{1,}]*)/g);n=r.match(l)}else n=r.split(",");n=_.without(n,a),o&&(n=n.map(function(e){return'"'+e+'"'})),0==n.length?delete s.value:s.value=n.join(",")}}},updateRange:function(e){var t=this.$el.find("#"+e+"_from"),i=this.$el.find("#"+e+"_to"),a=t.val(),s=i.val(),r=_.findWhere(this.advancedAttributes,{id:e});if(a==t.attr("min")&&s==i.attr("max"))delete r.value;else{var n="["+a+","+s+"]";r.value=n}},setInputCriterionValues:function(e){var t=e.currentTarget.id;if(t.match(/_from|_to/))t=t.replace(/_from|_to/,""),this.updateRange(t);else if(e.currentTarget.pattern){var i=$(e.currentTarget).val();if(""!==i)if(i.match(e.currentTarget.pattern)){var a=_.findWhere(this.advancedAttributes,{id:t}),i=$(e.currentTarget).val();a.value=i}else r.error("Advanced criteria "+t+" is not valid.")}else{var a=_.findWhere(this.advancedAttributes,{id:t}),i=$(e.currentTarget).val();a.value=i}},render:function(){var e=a.get("search.advancedCriteriaLabels",{}),t=s({advancedAttributes:this.model.get("advancedAttributes")[this.dataset.get("datasetId")],criterionLabels:e,dataset:this.dataset,theme:a.localConfig.theme});return this.$el.html(t),this.$el.trigger("create"),this}});i.exports=n}),require.register("search/view/boxView",function(e,t,i){function a(e){return isNaN(e)?!1:e>=-180&&180>=e}function s(e){return isNaN(e)?!1:e>=-90&&90>=e}function r(e){return isNaN(e)?NaN:parseFloat(e)}var n=t("map/map"),o=t("map/rectangleHandler"),l=t("map/degreeConvertor"),d=Backbone.View.extend({initialize:function(e){this.parentView=e.parentView,this.model.on("change:useExtent",function(){var e=this.$el.find(".mapExtentCheckBoxLabel"),t=e.hasClass("ui-checkbox-on");t!=this.model.get("useExtent")&&e.trigger("click")},this)},events:{"click #drawbbox":function(e){this.model.set("useExtent",!1);var t=this,i=$(e.target);i.attr("disabled","disabled").button("refresh"),o.start({layer:this.parentView.searchAreaLayer,feature:this.model.searchArea.getFeature(),stop:function(){var e=t.model.searchArea.getBBox();e.south=Math.max(e.south,-90),e.north=Math.min(e.north,90),t.model.searchArea.setBBox(e),t.updateInputs(e),i.removeAttr("disabled").button("refresh")}})},"blur input":function(e){var t=this.parseInputs();a(t.west)&&a(t.east)&&s(t.south)&&s(t.north)?this.model.searchArea.setBBox(t):t=this.model.searchArea.getBBox(),this.updateInputs(t),this.parentView.updateSearchAreaLayer()},"click .mapExtentCheckBoxLabel":function(e){var t=($(e.currentTarget),!$(e.currentTarget).hasClass("ui-checkbox-on"));this.model.set({useExtent:t},{silent:!0}),t?this.activateUseExtent():this.deactivateUseExtent()},"click .mapExtentWholeWorldBtn":function(e){this.model.set({useExtent:!1});var t={east:180,west:-180,north:90,south:-90};this.model.searchArea.setBBox(t),this.updateInputs(t),this.parentView.updateSearchAreaLayer()}},updateInputs:function(e){this.$el.find("#west").val(l.toDMS(e.west,!0,{positionFlag:"number"})),this.$el.find("#south").val(l.toDMS(e.south,!1,{positionFlag:"number"})),this.$el.find("#east").val(l.toDMS(e.east,!0,{positionFlag:"number"})),this.$el.find("#north").val(l.toDMS(e.north,!1,{positionFlag:"number"}))},getDecimal:function(e){return e.indexOf("")>=0||e.indexOf("'")>=0||e.indexOf('"')>=0?l.toDecimalDegrees(e):r(e)},parseInputs:function(){var e=this.$el.find("#west").val(),t=this.$el.find("#south").val(),i=this.$el.find("#east").val(),a=this.$el.find("#north").val();return{west:this.getDecimal(e),south:this.getDecimal(t),east:this.getDecimal(i),north:this.getDecimal(a)}},updateFromModel:function(){var e=this.model.searchArea.getBBox();this.updateInputs(e);var t=n.getViewportExtent();t[0]!=e.west||t[1]!=e.south||t[2]!=e.east||t[3]!=e.north?this.model.set("useExtent",!1):this.model.set("useExtent",!0)},onUseExtentChanged:function(){var e=this.$el.find(".mapExtentCheckBoxLabel"),t=e.hasClass("ui-checkbox-on");t!=this.model.get("useExtent")&&e.trigger("click")},activateUseExtent:function(){n.on("extent:change",this.synchronizeWithMapExtent,this),this.synchronizeWithMapExtent(),this.parentView.searchAreaLayer&&(n.removeLayer(this.parentView.searchAreaLayer),this.parentView.searchAreaLayer=null),this.$el.find("input").addClass("ui-disabled")},deactivateUseExtent:function(){n.off("extent:change",this.synchronizeWithMapExtent,this),this.parentView.searchAreaLayer&&(this.parentView.searchAreaLayer.clear(),this.parentView.searchAreaLayer=n.addLayer(this.parentView.searchAreaLayer.params)),this.parentView.updateSearchAreaLayer(),this.$el.find("input").removeClass("ui-disabled")},open:function(){if(this.model.get("useExtent"))this.activateUseExtent();else{var e=this.parseInputs();this.model.searchArea.setBBox(e),this.parentView.updateSearchAreaLayer()}this.$el.show()},close:function(){this.model.get("useExtent")&&this.deactivateUseExtent(),this.$el.hide()},synchronizeWithMapExtent:function(){var e=n.getViewportExtent(),t={west:e[0],south:e[1],east:e[2],north:e[3]};this.model.searchArea.setBBox(t),this.updateInputs(t)}});i.exports=d}),require.register("search/view/corrInterView",function(e,t,i){var a=t("search/template/corrInterContent"),s=Backbone.View.extend({events:{"change #masterD":function(e){this.model.setMaster($(e.currentTarget).val())},"slidestop input":"updateModel","blur input":"updateModel"},updateModel:function(e){var t=e.currentTarget.id;t.match(/_from|_to/)?(t=t.replace(/_from|_to/,""),this.updateRange(t)):this.model.set(t,$(e.currentTarget).val())},updateRange:function(e){var t=this.$el.find("#"+e+"_from"),i=this.$el.find("#"+e+"_to"),a=[t.val(),i.val()];this.model.set(e,a)},render:function(){var e=a({model:this.model});return this.$el.html(e),this}});i.exports=s}),require.register("search/view/datasetSelectionView",function(e,t,i){"use strict";var a=t("logger"),s=(t("search/model/datasetSearch"),t("search/model/datasetAuthorizations")),r=(t("searchResults/model/searchResults"),t("search/template/datasetsSelectionContent_template")),n=t("search/template/datasetsListContent_template"),o=Backbone.View.extend({id:"datasetSelection",events:{"click li":function(e){if(!$(e.target).hasClass("ui-icon")){var t=$(e.currentTarget).data("datasetid");this.model.fetchDataset(t,function(e){e.get("description")&&$("#dsPopupDescription").html("<p>"+e.get("description")+"</p>").popup("open",{positionTo:"#"+e.tagFriendlyId+" .ui-li-count"})})}},"click .ui-icon":function(e){var t=$(e.currentTarget.parentElement).data("datasetid");$(e.currentTarget).hasClass("ui-icon-checkbox-off")?($(e.currentTarget).removeClass("ui-icon-checkbox-off").addClass("ui-icon-checkbox-on"),this.model.select(t)):($(e.currentTarget).removeClass("ui-icon-checkbox-on").addClass("ui-icon-checkbox-off"),this.model.unselect(t))},"click #dsResetKeywords":function(){var e=this,t=0;this.model.get("criterias").forEach(function(i){i.selectedValue="",e.$el.find("#criteria_"+t).val("").change(),e.$el.find("#criteria_"+t).closest(".ui-select").removeClass("oneValue"),t++}),this.updateDatasetsList(),this.updateSelectCriteria()},'keyup [data-type="search"]':"filterDatasets",'change [data-type="search"]':"filterDatasets"},filterDatasets:function(e){var t=$(e.target).val(),i=this.$el.find("#datasetList li").removeClass("ui-screen-hidden");""!=t&&i.find(".name").filter(function(e,i){return-1==$(i).text().toLowerCase().indexOf(t.toLowerCase())}).parent().addClass("ui-screen-hidden")},initialize:function(){this.filteredDatasets=[],this.listenTo(this.model,"select",this.onSelect),this.listenTo(this.model,"unselect",this.onUnselect),this.listenTo(this.model,"datasetFetch",function(e,t){"ERROR"==t&&a.error("Dataset "+e+" is not available on the server.")})},onSelect:function(e){var t=this.$el.find("#"+e.tagFriendlyId+" .ui-icon");t.removeClass("ui-icon-checkbox-off"),t.addClass("ui-icon-checkbox-on")},onUnselect:function(e){var t=this.$el.find("#"+e.tagFriendlyId+" .ui-icon");t.removeClass("ui-icon-checkbox-on"),t.addClass("ui-icon-checkbox-off")},datasetsListTemplate:n,onShow:function(){this.updateContentHeight()},updateContentHeight:function(){var e=this.$el.height()-this.$el.find("#ds-footer").outerHeight()-this.$el.find("#ds-keywords").outerHeight()-10;this.$el.find("#ds-content").css("height",e)},render:function(){if(!this.model.isValid())return this.$el.append("<p>Error: There was a problem when creating the datasets.<p>"),this;var e=r(this.model);this.$el.append(e),this.updateDatasetsList(),this.updateSelectCriteria(),this.$el.trigger("create");var t=this;return _.each(t.model.get("criterias"),function(e,i){t.$el.find("#criteria_"+i).change(function(a){var s=$(this).val()?$(this).val():"";e.selectedValue=s,""!==s?$(a.currentTarget).closest(".ui-select").addClass("oneValue"):$(a.currentTarget).closest(".ui-select").removeClass("oneValue"),t.updateDatasetsList(),t.updateSelectCriteria(i)})}),this},updateSelectCriteria:function(e){for(var t=this.model.get("criterias"),i=0;i<t.length;i++){var a=JSON.parse(JSON.stringify(t));"undefined"!=typeof e&&(a[i].selectedValue="");var s=this.model.filterDatasets(a),r=t[i],n=this.$el.find("#criteria_"+i);n.empty(),n.append('<option value="">Any '+t[i].title+"</option>");for(var o=this.model.filterCriteriaValues(s,a[i]),l=0;l<o.length;l++){var d=$('<option value="'+o[l]+'">'+o[l]+"</option>").appendTo(n);r.selectedValue==o[l]&&d.attr("selected","selected")}}},updateDatasetsList:function(){var e=this.model.filterDatasets(this.model.get("criterias"));e=_.sortBy(e,function(e){return e.name.toLowerCase()});var t=this.$el.find("#datasetListContainer"),i=this.datasetsListTemplate({datasets:e});t.html(i),t.trigger("create");for(var a=0;a<e.length;a++)s.hasDownloadAccess(e[a].tagFriendlyId)||$("#"+e[a].tagFriendlyId).append('<img src="../images/nodownload.png" />'),s.hasViewAccess(e[a].tagFriendlyId)||$("#"+e[a].tagFriendlyId).append('<img src="../images/noview.png" />'),s.hasSearchAccess(e[a].tagFriendlyId)||$("#"+e[a].tagFriendlyId).addClass("ui-disabled");_.each(this.model.selection,function(e){var i=t.find("#"+e.tagFriendlyId);0==i.length?(this.model.unselect(e.tagFriendlyId),this.trigger("sizeChanged")):(i.find(".ui-icon").addClass("ui-icon-checkbox-on"),i.find(".ui-icon").removeClass("ui-icon-checkbox-off"))},this),this.filteredDatasets=e}});i.exports=o}),require.register("search/view/datasetView",function(e,t,i){var a=t("configuration"),s=t("search/view/advancedSearchView"),r=t("search/view/downloadOptionsView"),n=(t("search/view/openSearchURLView"),t("search/template/datasetSearchContent_template")),o=t("search/model/dataSetPopulation"),l=t("search/model/datasetSearch"),d=Backbone.View.extend({initialize:function(e){this.dataset=e.dataset},refresh:function(){this.advancedCriteriaView.render(),this.downloadOptionsView.render(),this.$el.trigger("create")},appendAtomUrl:function(){var e=this,t='<div title="Atom feed" class="osAtomUrl"><div class="tb-icon"></div></div>';$(t).appendTo(this.$el.find(".ui-collapsible-heading > a > span")).click(function(t){t.stopPropagation();var i=l.getOpenSearchURL({id:e.dataset.get("datasetId"),format:"atom"});window.open(i)})},render:function(){var e=n({dataset:this.dataset,name:o.getFriendlyName(this.dataset.get("datasetId")),theme:a.localConfig.theme});this.$el.append(e),this.advancedCriteriaView=new s({el:this.$el.find("#searchCriteria"),model:this.model,dataset:this.dataset}),this.advancedCriteriaView.render(),this.downloadOptionsView=new r({el:this.$el.find("#downloadOptions"),model:this.model.get("downloadOptions")[this.dataset.get("datasetId")]}),this.downloadOptionsView.render(),this.$el.trigger("create"),this.appendAtomUrl(),this.$el.find("#sc-advanced-container h3 .ui-btn-inner").attr("data-help",a.localConfig.contextHelp.advancedOptions).end().find("#sc-do-container h3 .ui-btn-inner").attr("data-help",a.localConfig.contextHelp.downloadOptions).end()},remove:function(){this.advancedCriteriaView.remove(),this.downloadOptionsView.remove(),Backbone.View.prototype.remove.apply(this)}});i.exports=d}),require.register("search/view/downloadOptionsView",function(e,t,i){var a=t("search/template/downloadOptionsContent"),s=t("search/model/datasetSearch"),r=t("configuration"),n=Backbone.View.extend({id:"downloadOptionsView",initialize:function(e){this.listenTo(s,"change:downloadOptions",this.onChangeDownloadOptions),this.updateCallback=e.hasOwnProperty("updateCallback")?e.updateCallback:null},events:{"change select":function(e){var t=e.currentTarget.id,i=$(e.currentTarget).val();this.model.setValue(t,i);this.render()},"change input":function(e){var t=$(e.target).is(":checked"),i=$(e.currentTarget).attr("name"),a=$(e.target).val(),s=this.model.getSelectedValues(i);$(e.target).data("wkt")?this.model.setValue(i,t?!0:null):(t?s?s.push(a):s=[a]:(s=_.without(s,a),0==s.length&&(s=null)),this.model.setValue(i,s)),this.render()},"click #downloadOptionsUpdate":function(e){if(this.updateCallback){var t=this;this.updateCallback().done(function(){t.$el.find("#downloadOptionsMessage").empty(),t.$el.find("#downloadOptionsMessage").append("<p>Download options updated.<p>")})}}},onChangeDownloadOptions:function(){this.render()},render:function(){var e=a({model:this.model,updateCallback:null!=this.updateCallback,theme:r.localConfig.theme}),t=this.$el.find("> *");this.$el.attr("visiblity","none"),this.$el.trigger("create");var i=this;return setTimeout(function(){t.remove(),i.$el.append(e).removeAttr("visiblity"),i.$el.find('option[value="@conflict"]').is(":selected")&&i.$el.find("#downloadOptionsUpdate").attr("disabled","disabled"),i.$el.trigger("create")},1),this}});i.exports=n}),require.register("search/view/gazetteerView",function(e,t,i){var a=t("map/map"),s=t("map/gazetteer"),r=Backbone.View.extend({initialize:function(e){this.parentView=e.parentView},events:{"click #gazetteer-results li":function(e){var t=$(e.currentTarget);t.hasClass("ui-btn-active")||(this.selectGazetteerResult(t),a.zoomTo(this.model.searchArea.getFeature().bbox))},"change #search-gazetteer":function(e){$("#gazetteer-results").empty();var t=$(e.currentTarget).val();if(""!=t){$("#search-gazetteer").textinput("disable");var i=this;s.query({query:t,result:function(e){if($("#search-gazetteer").textinput("enable"),0==e.length)return i.model.searchArea.empty(),void i.parentView.updateSearchAreaLayer();for(var t=$('<ul data-inset="true"></ul>'),s=0;s<e.length;s++){var r=e[s].display_name+" ("+e[s]["class"]+" "+e[s].type+")";$("<li>"+r+"</li>").data("data",e[s]).appendTo(t)}t.appendTo("#gazetteer-results").listview(),i.selectGazetteerResult($("#gazetteer-results").find("li:first")),a.zoomTo(i.model.searchArea.getFeature().bbox)}})}else this.model.searchArea.empty(),this.parentView.updateSearchAreaLayer()}},selectGazetteerResult:function(e){if(0!=e.length){e.parent().find(".ui-btn-active").removeClass("ui-btn-active"),e.addClass("ui-btn-active");var t=e.data("data");if(t.geotext)this.model.searchArea.setFromWKT(t.geotext),this.parentView.updateSearchAreaLayer();else{var i=parseFloat(t.boundingbox[0]),a=parseFloat(t.boundingbox[1]),s=parseFloat(t.boundingbox[2]),r=parseFloat(t.boundingbox[3]);this.model.searchArea.setBBox({west:s,south:i,east:r,north:a}),this.parentView.updateSearchAreaLayer()}}},open:function(){var e=$("#gazetteer-results").find("li.ui-btn-active");e.length>0?this.selectGazetteerResult(e):this.model.searchArea.empty(),this.parentView.updateSearchAreaLayer(),this.$el.show()},close:function(){this.$el.hide()}});i.exports=r}),require.register("search/view/importView",function(e,t,i){var a=t("map/layerImport"),s=Backbone.View.extend({initialize:function(e){this.importedLayer=null,this.parentView=e.parentView,a.isSupported()?a.addDropArea(this.$el.find("#dropZone").get(0),$.proxy(this.onFileLoaded,this)):$("#import").html('<p class="ui-error-message"><b>Import is not supported by your browser.</b></p>')},events:{},open:function(){this.importedLayer?this.model.searchArea.setFromLayer(this.importedLayer):this.model.searchArea.empty(),this.parentView.updateSearchAreaLayer(),this.$el.show()},close:function(){this.$el.hide()},onFileLoaded:function(e,t){this.importedLayer=e;var i=this.model.searchArea.setFromLayer(e);i.valid?($("#importMessage").html("File sucessfully imported : "+t.name),this.parentView.updateSearchAreaLayer()):$("#importMessage").html("Failed to import "+t.name+" : "+i.message+".")}});i.exports=s}),require.register("search/view/openSearchURLView",function(e,t,i){var a=t("configuration"),s=t("logger"),r=t("search/model/dataSetPopulation"),n=Backbone.View.extend({events:{"blur #osUrlText":function(e){var t=$(e.currentTarget).val(),i=this.model.getOpenSearchURL();t!=i&&this.applyOpenSearchUrl(t)}},displayOpenSearchURL:function(){var e=this.model.getOpenSearchURL();this.$el.find("#osUrlText").val(e)},applyOpenSearchUrl:function(e){try{var t=new RegExp("^"+a.serverHostName+a.baseServerUrl+"/catalogue/([^/]+)/search\\?(.+)"),i=t.exec(e);if(i){var n=i[1],o=this.model.getDatasetPath();n==o?this.model.populateModelfromURL(i[2]):(r.once("datasetFetch",function(e,t){"SUCCESS"==t?this.model.populateModelfromURL(i[2]):(s.error("Invalid OpenSearch URL : cannot load the dataset "+n+"."),this.model.set("datasetId",o))},this),r.selectExclusive(n))}else s.error("Invalid OpenSearch URL.")}catch(l){s.error("Invalid OpenSearch URL : "+l)}},render:function(){var e=this;return this.$el.parent().bind("collapse",function(){e.stopListening(e.model,"change",e.displayOpenSearchURL)}).bind("expand",function(){e.displayOpenSearchURL(),e.listenTo(e.model,"change",e.displayOpenSearchURL)}),this}});i.exports=n}),require.register("search/view/polygonView",function(e,t,i){var a=(t("map/map"),t("map/polygonHandler")),s=t("map/degreeConvertor"),r=Backbone.View.extend({initialize:function(e){this.searchArea=e.searchArea,this.parentView=e.parentView},events:{"click #drawpolygon":function(e){this.$el.find("#polygonTextError").hide();var t=this;$button=$(e.target),$button.attr("disabled","disabled").button("refresh"),a.start({layer:this.parentView.searchAreaLayer,feature:this.model.searchArea.getFeature(),stop:function(){$button.removeAttr("disabled").button("refresh"),t.$el.find("#polygontext").val(t.model.searchArea.getPolygonText()).keyup(),t.model.searchArea.setMode(1)}})},"focus #polygontext":function(e){this.$el.find("#polygonTextError").hide()},"change #polygontext":function(e){var t=$(e.currentTarget).val();if(/[a-zA-Z]+/.exec(t)||!this.model.searchArea.setPolygonFromText(t))this.updateFromModel(),this.$el.find("#polygonTextError").html("Please enter valid coordinates : DM'S\"").show();else{var i=t.trim().split("\n");res="";for(var a=0;a<i.length;a++){var s=i[a].split(" ");res+=this.getDMS(s[0]+" "),res+=this.getDMS(s[1])+"\n"}this.$el.find("#polygontext").val(res)}this.parentView.updateSearchAreaLayer()}},getDMS:function(e){return e.indexOf("")>=0||e.indexOf("'")>=0||e.indexOf('"')>=0?e:s.toDMS(e)},updateFromModel:function(){this.$el.find("#polygontext").val(this.model.searchArea.getPolygonText()).keyup()},open:function(){var e=this.$el.find("#polygontext").val();this.$el.find("#polygonTextError").hide(),this.model.searchArea.setPolygonFromText(e),this.parentView.updateSearchAreaLayer(),this.$el.show()},close:function(){this.$el.hide()}});i.exports=r}),require.register("search/view/schedulingOptionsView",function(e,t,i){var a=(t("configuration"),t("search/template/schedulingOptions_template")),s=Backbone.View.extend({initialize:function(e){this.request=e.request,this.parentWidget=e.parentWidget},events:{"change #startDateSTO":function(e){var t=$(e.currentTarget).val();this.request.startDate=Date.fromISOString(t+"T00:00:00.000Z")},"change #endDateSTO":function(e){var t=$(e.currentTarget).val();this.request.endDate=Date.fromISOString(t+"T23:59:59.999Z")},'change input[name="STOType"]':function(e){var t=this.$el.find("#timeDrivenParams");"time-driven-input"==e.currentTarget.id?(this.request.timeDriven=!0,t.show()):(this.request.timeDriven=!1,t.hide())},"change #repeatPeriodInput":function(e){this.request.repeatPeriod=$(e.currentTarget).val()},"change input#applyShiftCheckBox":function(e){this.request.slideAcquisitionTime=$(e.target).is(":checked")}},render:function(){var e=a(this.request);return this.$el.html(e),this.$el.find("#standingOrderSpecificMessage").append(this.request.getSpecificMessage()),this.request.timeDriven||this.$el.find("#timeDrivenParams").hide(),this.$el.trigger("create"),this}});i.exports=s}),require.register("search/view/searchCriteriaView",function(e,t,i){var a=t("configuration"),s=(t("logger"),t("search/view/searchView")),r=t("searchResults/model/searchResults"),n=t("search/view/corrInterView"),o=t("search/view/datasetView"),l=t("ui/sharePopup"),d=t("search/model/dataSetPopulation"),c=t("search/template/searchCriteriaContent_template"),h=s.extend({id:"datasetSearchCriteria",initialize:function(){s.prototype.initialize.apply(this),this.listenTo(d,"select",this.onDatasetSelected),this.listenTo(d,"unselect",this.onDatasetUnselected),this.datasetDependingViews={}},refresh:function(){for(var e in this.datasetDependingViews)this.datasetDependingViews[e].refresh()},onDatasetSelected:function(e){var t=new o({model:this.model,dataset:e});this.$el.find(".datasetSearch").append(t.el),t.render(),this.$el.trigger("create"),this.datasetDependingViews[e.get("datasetId")]=t},onDatasetUnselected:function(e){var t=e.get("datasetId");this.datasetDependingViews[t].remove(),delete this.datasetDependingViews[t]},events:{"click .scSubmit":function(e){var t=this.model.get("start")<=this.model.get("stop");t?r.launch(this.model):$("#dateWarningPopup").popup("open")},"click #share":function(){l.open({openSearchUrl:this.model.getOpenSearchURL({format:"atom"}),url:a.serverHostName+window.location.pathname+this.model.getSharedSearchURL(),positionTo:this.$el.find("#share")[0]})},"change #sc-mode":function(){var e=this.$el.find("#sc-mode").val();this.$el.find("#sc-corrinf-container").remove(),
this.corrInterView&&(this.corrInterView.remove(),this.corrInterView=null),this.model.setMode(e),"Simple"!=e&&(this.$el.find("#sc-area-container").after('<div id="sc-corrinf-container" data-role="collapsible" data-inset="false" data-mini="true">						<h3>'+e+'</h3>						<div id="sc-corrinf">	</div>					</div>'),this.corrInterView=new n({el:this.$el.find("#sc-corrinf"),model:this.model}),this.corrInterView.render()),this.$el.find("#sc-content").trigger("create"),this.$el.find("#sc-corrinf-container h3 .ui-btn-inner").attr("data-help",a.localConfig.contextHelp.interferometry)}},updateSelectMode:function(){if(this.$el.find("#sc-corrinf-container").remove(),this.$el.find("#sc-mode-containter").remove(),this.model.isInterferometrySupported()){var e=$('<div id="sc-mode-containter" data-role="fieldcontain">				<label for="sc-mode">Mode: </label>				<select id="sc-mode" data-mini="true">					<option value="Simple">Simple</option>					<option value="Interferometry">Interferometry</option>				</select>			</div>');this.$el.find("#sc-content").prepend(e).trigger("create")}},onShow:function(){this.updateSelectMode(),this.model.get("useTimeSlider")&&0!=_.keys(self.selection).length&&$("#dateRangeSlider").dateRangeSlider("show"),s.prototype.onShow.apply(this)},render:function(){var e=c({submitText:"Search",useDate:!0});return this.$el.append(e),s.prototype.render.apply(this),this.dateCriteriaView.listenTo(this.model,"change:dateRange",this.dateCriteriaView.updateDateRange),this}});i.exports=h}),require.register("search/view/searchView",function(e,t,i){var a=t("configuration"),s=t("search/view/spatialExtentView"),r=t("search/view/timeExtentView"),n=(t("search/model/dataSetPopulation"),Backbone.View.extend({initialize:function(){this.dateCriteriaView=null,this.areaCriteriaView=null},updateContentHeight:function(){this.$el.find("#sc-content").css("height",this.$el.height()-this.$el.find("#sc-footer").outerHeight())},onShow:function(){this.updateContentHeight(),this.areaCriteriaView.searchAreaLayer&&this.areaCriteriaView.searchAreaLayer.setVisible(!0)},onHide:function(){this.areaCriteriaView.searchAreaLayer&&this.areaCriteriaView.searchAreaLayer.setVisible(!1)},render:function(){return this.dateCriteriaView=new r({el:this.$el.find("#date"),hasTimeSlider:"Search"==this.model.name?!0:!1,model:this.model}),this.dateCriteriaView.render(),this.areaCriteriaView=new s({el:this.$el.find("#area"),searchCriteriaView:this,model:this.model}),this.areaCriteriaView.render(),this.$el.trigger("create"),this.$el.find("#sc-date-container h3 .ui-btn-inner").attr("data-help",a.localConfig.contextHelp.date).end().find("#sc-area-container h3 .ui-btn-inner").attr("data-help",a.localConfig.contextHelp.area).end(),this}}));i.exports=n}),require.register("search/view/spatialExtentView",function(e,t,i){var a=t("map/map"),s=t("search/view/boxView"),r=t("search/view/polygonView"),n=t("search/view/gazetteerView"),o=t("search/view/importView"),l=t("search/template/areaCriteriaContent"),d=Backbone.View.extend({initialize:function(e){this.searchAreaLayer=null,this.mode="bbox",this.model.on("change:searchArea",this.onModelChanged,this)},events:{"change #toolsChoice":function(e){var t=$(e.currentTarget).find("input:radio:checked").val();this.tools[this.mode].close(),this.tools[t].open(),this.mode=t}},updateSearchAreaLayer:function(){if(this.searchAreaLayer)this.searchAreaLayer.updateFeature(this.model.searchArea.getFeature());else{var e={name:this.model.name+" Area",type:"Feature",visible:!0,style:"search-area",greatCircle:!1};this.searchAreaLayer=a.addLayer(e),this.searchAreaLayer.addFeature(this.model.searchArea.getFeature())}},onModelChanged:function(){this.model.searchArea&&(0==this.model.searchArea.getMode()?(this.tools.bbox.updateFromModel(),this.$el.find("#radio-bbox-label").trigger("click")):1==this.model.searchArea.getMode()&&(this.tools.polygon.updateFromModel(),this.$el.find("#radio-polygon-label").trigger("click")))},render:function(){this.$el.append(l(this.model)),this.tools={bbox:new s({model:this.model,parentView:this,el:this.$el.find("#bbox").get(0)}),polygon:new r({model:this.model,parentView:this,el:this.$el.find("#polygon").get(0)}),gazetteer:new n({model:this.model,parentView:this,el:this.$el.find("#gazetteer").get(0)}),"import":new o({model:this.model,parentView:this,el:this.$el.find("#import").get(0)})};for(var e in this.tools)this.tools.hasOwnProperty(e)&&e!=this.mode&&this.tools[e].close();return this.tools[this.mode].open(),this}});i.exports=d}),require.register("search/view/standingOrderView",function(e,t,i){var a=t("configuration"),s=t("dataAccess/widget/dataAccessWidget"),r=t("search/view/schedulingOptionsView"),n=t("search/view/searchView"),o=t("dataAccess/model/standingOrderDataAccessRequest"),l=t("search/view/datasetView"),d=t("ui/sharePopup"),c=t("search/model/dataSetPopulation"),h=t("search/template/searchCriteriaContent_template"),u=t("search/model/datasetSearch"),p=n.extend({id:"standingOrderView",initialize:function(){n.prototype.initialize.apply(this),this.listenTo(c,"select",this.onDatasetChanged),this.listenTo(c,"unselect",this.onDatasetChanged)},onDatasetChanged:function(e){if(this.model.dataset)this.datasetView=new l({model:this.model,dataset:this.model.dataset}),this.datasetView.render(),this.$el.find(".datasetSearch").append(this.datasetView.el),this.$el.trigger("create");else if(this.datasetView){e.get("datasetId");this.datasetView.remove(),this.datasetView=null}},events:{"click .scSubmit":function(e){o.initialize(),o.OpenSearchURL=this.model.getOpenSearchURL(),o.DownloadOptions=this.model.getSelectedDownloadOptions(),s.open(o)},"click .scImport":function(){this.model.set({start:u.get("start"),stop:u.get("stop"),useExtent:u.get("useExtent"),advancedAttributes:_.clone(u.get("advancedAttributes"))});var e=u.get("downloadOptions")[this.model.dataset.get("datasetId")];this.model.get("downloadOptions")[this.model.dataset.get("datasetId")].updateFrom(e),this.model.searchArea.setFromWKT(u.searchArea.toWKT()),this.model.searchArea.setMode(u.searchArea.getMode()),this.model.trigger("change:searchArea"),this.refresh()},"click #share":function(){d.open({openSearchUrl:this.model.getOpenSearchURL({format:"atom"}),url:a.serverHostName+window.location.pathname+o.getSharedURL(this.model),positionTo:this.$el.find("#share")[0]})}},onShow:function(){$("#dateRangeSlider").dateRangeSlider("hide"),n.prototype.onShow.apply(this)},refresh:function(){this.schedulingOptionsView.render(),this.datasetView&&this.datasetView.refresh()},render:function(){o.initialize();var e=h({submitText:"Subscribe"});return this.$el.append(e),n.prototype.render.apply(this),this.$el.find("#sc-content").prepend('<div id="sc-schedlingOptions-container" data-role="collapsible" data-inset="false" data-mini="true" data-collapsed="false">												<h3>Scheduling Options</h3>												<div id="schedulingOptions"></div>											</div>'),this.schedulingOptionsView=new r({el:this.$el.find("#schedulingOptions"),request:o,model:this.model}),this.schedulingOptionsView.render(),this.$el.trigger("create"),this.$el.find("#sc-schedlingOptions-container h3 .ui-btn-inner").attr("data-help",a.localConfig.contextHelp.schedulingOptions),this}});i.exports=p}),require.register("search/view/timeExtentView",function(e,t,i){var a=t("configuration"),s=t("searchResults/model/searchResults"),r=t("search/template/dateCriteriaContent"),n=864e5,o=6048e5,l=2592e6,d=31536e6,c=function(e,t){var i=e.getFullYear(),a=e.getMonth(),s=e.getDate(),r=new Date;return r.setFullYear(i),r.setMonth(a),r.setDate(s),t?(r.setUTCHours(0),r.setUTCMinutes(0),r.setUTCSeconds(0),r.setUTCMilliseconds(0)):(r.setUTCHours(23),r.setUTCMinutes(59),r.setUTCSeconds(59),r.setUTCMilliseconds(999)),r},h=Backbone.View.extend({initialize:function(e){this.hasTimeSlider=e.hasTimeSlider,this.listenTo(this.model,"change:start",this.update),this.listenTo(this.model,"change:stop",this.update),_.extend(this,Backbone.Events)},events:{"change .fromDateInput":function(e){this.model.get("start").toISODateString()!=$(e.currentTarget).datebox("getTheDate").toISODateString()&&this.model.set({start:Date.fromISOString($(e.currentTarget).val()+"T00:00:00.000Z")})},"change .toDateInput":function(e){this.model.get("stop").toISODateString()!=$(e.currentTarget).datebox("getTheDate").toISODateString()&&this.model.set({stop:Date.fromISOString($(e.currentTarget).val()+"T23:59:59.999Z")})},"click .useTimeSliderLabel":function(e){var t=$(e.currentTarget),i=t.hasClass("ui-checkbox-off");this.model.set({useTimeSlider:i}),i?(this.$fromDateInput.datebox("disable"),this.$toDateInput.datebox("disable"),this.addTimeSlider()):(this.removeTimeSlider(),this.$fromDateInput.datebox("enable"),this.$toDateInput.datebox("enable"))}},updateDateRange:function(e,t){var i=this.model.get("useTimeSlider");if(t){i&&this.addTimeSlider();var s=a.get("keyDates").slice(0);s.push([(new Date).toISODateString(),"Today"]);for(var r=t.start,n=t.stop,o=s.length;o--;){var l=new Date(s[o][0]),d=n>=l&&l>=r;d||s.splice(o,1)}s.push([r.toISODateString(),"Start dataset"]),s.push([n.toISODateString(),"Stop dataset"]),s.sort(function(e,t){return new Date(e[0])-new Date(t[0])});var c={startYear:r.getFullYear(),endYear:n.getFullYear(),calDateList:s};this.model.get("dateRange")&&(this.$fromDateInput.datebox("option",Object.assign(c,{calYearPickMin:this.model.get("start").getFullYear()-this.model.get("dateRange").start.getFullYear(),calYearPickMax:this.model.get("dateRange").stop.getFullYear()-this.model.get("start").getFullYear()})).datebox("refresh"),this.$toDateInput.datebox("option",Object.assign(c,{calYearPickMin:this.model.get("stop").getFullYear()-this.model.get("dateRange").start.getFullYear(),calYearPickMax:this.model.get("dateRange").stop.getFullYear()-this.model.get("stop").getFullYear()})).datebox("refresh"))}else i&&this.removeTimeSlider()},addTimeSlider:function(){this.$dateRangeSlider=$("#dateRangeSlider"),this.$dateRangeSlider.dateRangeSlider("option",{boundsMaxLength:a.localConfig.timeSlider.boundsMaxLength,boundsMinLength:a.localConfig.timeSlider.boundsMinLength,bounds:{min:this.model.get("start"),max:this.model.get("stop")},scaleBounds:{min:this.model.get("dateRange").start,max:this.model.get("dateRange").stop},change:$.proxy(this.onTimeSliderChanged,this)}),this.$dateRangeSlider.dateRangeSlider("show")},onTimeSliderChanged:function(e){this.model.set({start:e.min,stop:e.max}),this.$fromDateInput.val(e.min.toISODateString()),this.$toDateInput.val(e.max.toISODateString()),s.launch(this.model)},removeTimeSlider:function(){var e=this;this.$dateRangeSlider.dateRangeSlider("hide",function(){e.$dateRangeSlider=$(),e.trigger("removeTimeSlider"),$(window).trigger("resize")})},update:function(){if(this.$dateRangeSlider.length>0&&this.$dateRangeSlider.dateRangeSlider("option","bounds",{min:this.model.get("start"),max:this.model.get("stop")}),this.$fromDateInput.datebox("setTheDate",this.model.get("start")),this.$toDateInput.datebox("setTheDate",this.model.get("stop")),this.model.get("dateRange")){var e=!1,t=this.model.get("start"),i=this.model.get("stop"),a=c(this.model.get("dateRange").start,!0),s=c(this.model.get("dateRange").stop,!1);t>s?(t=new Date(s.getTime()-o),i=s,e=!0):a>t?(t=a,i=new Date(a.getTime()+o),e=!0):a>i?(t=a,i=new Date(a.getTime()+o),e=!0):i>s?(t=new Date(s.getTime()-o),t.getTime()-a.getTime()<0&&(t=a),i=s,e=!0):i==s&&i-t>d?(t=new Date(i.getTime()-l),e=!0):i-t>d+n?(i=new Date(t.getTime()+l),i>s&&(i=s),e=!0):t>i&&(t=new Date(i.getTime()-l),a>t&&(t=a),e=!0),e&&this.model.set({start:t,stop:i}),this.$fromDateInput.datebox("option",{calYearPickMin:this.model.get("start").getFullYear()-this.model.get("dateRange").start.getFullYear(),calYearPickMax:this.model.get("dateRange").stop.getFullYear()-this.model.get("start").getFullYear()}).datebox("refresh"),this.$toDateInput.datebox("option",{calYearPickMin:this.model.get("stop").getFullYear()-this.model.get("dateRange").start.getFullYear(),calYearPickMax:this.model.get("dateRange").stop.getFullYear()-this.model.get("stop").getFullYear()}).datebox("refresh")}},render:function(){var e=r({model:this.model,keyDates:JSON.stringify(a.get("keyDates"))});return this.$el.append(e),this.$fromDateInput=this.$el.find(".fromDateInput"),this.$toDateInput=this.$el.find(".toDateInput"),this.$dateRangeSlider=$(),this.$el.trigger("create"),this.$fromDateInput.datebox(),this.$toDateInput.datebox(),this.hasTimeSlider&&(this.$el.append('<label class="useTimeSliderLabel">Use Time Slider<input type="checkbox" '+(this.model.get("useTimeSlider")?"checked":"")+' class="useTimeSliderCheckBox" data-mini="true"></label>'),this.model.get("useTimeSlider")&&(this.$fromDateInput.datebox("disable"),this.$toDateInput.datebox("disable"))),this}});i.exports=h}),require.register("shopcart/dsa",function(e,t,i){var a=t("globalEvents"),s=t("ui/menubar"),r=t("shopcart/model/shopcartCollection"),n=t("shopcart/model/shopcart"),o=t("shopcart/view/shopcartTableView"),l=t("shopcart/view/shopcartView"),d=t("account/view/createShopcartView");t("search/model/dataSetPopulation");i.exports={initialize:function(e,t,i){var c=new l({model:r.getCurrent(),collection:r});$("#statusBar").append(c.$el),c.render();var h=new o;i.bottom.addView(h),h.$el.css("display","block"),i.bottom.setActiveView(h),h.listenTo(r,"change:current",function(e){h.setShopcart(e);var t={activator:"#shopcart",$el:c.$el,views:[h],viewActivators:[c.$el.find("#tableCB")],model:e.featureCollection};$(t.activator).find(".datasetName").html(e.get("name")).attr("title",e.get("name")),i.bottom.addStatus(t)}),h.render(),r.fetch(),t.route("data-services-area/shopcart/:shopcartId","shopcart",function(e){s.showPage("data-services-area");var t=new n({id:e,name:"Share Shopcart "+e,isShared:!0});r.setCurrent(t)}),a.on("addToShopcart",function(e){if(r.getCurrent())r.getCurrent().addItems(e);else{var t=new d({model:r,title:"Create shopcart",success:function(t){r.setCurrent(t),r.getCurrent().addItems(e)}});t.render()}})}}}),require.register("shopcart/model/shopcart",function(e,t,i){var a=t("logger"),s=t("configuration"),r=t("searchResults/model/featureCollection"),n=function(e){return"PLANNED"!=s.getMappedProperty(e,"status")},o={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"},l=function(e){var t={id:e.id,geometry:e._origGeometry,properties:_.clone(e.properties,!0),type:e.type};return t.properties.style&&delete t.properties.style,t},d=Backbone.Model.extend({defaults:{name:"Shopcart",isDefault:!1},initialize:function(){this.urlRoot=s.baseServerUrl+"/shopcarts",this.featureCollection=new r,this.featureCollection.id=this.id;var e=this;this.listenTo(this.featureCollection,"add:features",function(t){e.trigger("add:features",t)}),this.listenTo(this.featureCollection,"remove:features",function(t){e.trigger("remove:features",t)})},parse:function(e){return e.shopcart?e.shopcart:e},sync:function(e,t,i){var a=o[e],s={type:a,dataType:"json"};if(i.url||(s.url=_.result(t,"url")||urlError()),null==i.data&&t&&("create"===e||"update"===e)){s.contentType="application/json";var r={shopcart:this.attributes};s.data=JSON.stringify(r)}"GET"!==s.type&&(s.processData=!1);var n=i.xhr=Backbone.ajax(_.extend(s,i));return t.trigger("request",t,n,i),n},loadContent:function(){this.featureCollection.search(this.url()+"/items/?format=json")},addItems:function(e){for(var t=[],i=[],r=0;r<e.length;r++){var o=e[r],d=s.getMappedProperty(o,"productUrl",null);if(o.properties&&d&&n(o)){var c=l(o);c.properties.shopcart_id=this.id,c.properties.productUrl=d,t.push(c),i.push(d)}}var h=this;return $.ajax({url:this.url()+"/items",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({shopcartfeatures:t}),success:function(t){if(!t.shopcartfeatures||!_.isArray(t.shopcartfeatures))return void a.error("Invalid response from server when adding shopcart items.");for(var s=[],r=t.shopcartfeatures,n=0;n<r.length;n++){var o=i.indexOf(r[n].properties.productUrl);if(o>=0&&o<e.length){var d=l(e[o],!0);d.id=r[n].id,d.properties.shopcart_id=r[n].properties.shopcart_id,d.properties.shopcartItemId=d.id,s.push(d)}}var c;e.length!=s.length?(c=s.length>0?"Only "+s.length+" product"+(s.length>1?"s":"")+" on "+e.length+" added to shopcart "+h.get("name")+".":e.length+" product"+(s.length>1?"s":"")+" not added to shopcart "+h.get("name")+".",c+="<br>A product cannot be added if already exists in the shopcart or if it is a planned product."):c=s.length+" product"+(s.length>1?"s":"")+" added to shopcart "+h.get("name")+".",a.inform(c),h.featureCollection.totalResults+=s.length,h.featureCollection.addFeatures(s)},error:function(e,t,i){a.error("Unexpected server response when adding shopcart items ("+t+" : "+i+").")}})},_getFeatureFromShopcartItemId:function(e){for(var t=this.featureCollection.features,i=0;i<t.length;i++)if(t[i].properties.shopcartItemId==e)return t[i]},deleteHighlights:function(){if(0!=this.featureCollection.highlights.length){for(var e=[],t=0;t<this.featureCollection.highlights.length;t++){var i=this.featureCollection.highlights[t];i.properties&&i.properties.shopcartItemId&&e.push({shopcartId:this.id,id:i.properties.shopcartItemId})}if(e.length!=this.featureCollection.highlights.length)return void a.error("The selected shopcart items do not contain valid ID and cannot be removed.");var s=this;return $.ajax({url:this.url()+"/items/delete",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({shopcartfeatures:e}),success:function(t){if(!t.shopcartfeatures||!_.isArray(t.shopcartfeatures))return void a.error("Invalid response from server when removing shopcart items.");for(var i=[],r=0;r<t.shopcartfeatures.length;r++)i.push(s._getFeatureFromShopcartItemId(t.shopcartfeatures[r].id));i.length!=e.length&&a.inform(e.length-i.length+" items have not been successfully removed on the server, IDs are not valid."),i.length>0&&(s.featureCollection.totalResults-=i.length,s.featureCollection.removeFeatures(i))},error:function(e,t,i){a.error("Unexpected server response when removing shopcart items ("+t+" : "+i+").")}})}},updateHighlights:function(e){for(var t=[],i=0;i<this.featureCollection.highlights.length;i++){var a=this.featureCollection.highlights[i];a.properties.shopcartItemId&&t.push({shopcartId:this.id,id:a.properties.shopcartItemId,downloadOptions:e})}var s=this;return $.ajax({url:s.url()+"/items",type:"PUT",dataType:"json",contentType:"application/json",data:JSON.stringify({shopcartfeatures:t}),success:function(e){var t=e.items;s.trigger("itemsUpdated",t)},error:function(e,t,i){s.trigger("updateItemsError")}})}});i.exports=d}),require.register("shopcart/model/shopcartCollection",function(e,t,i){var a=t("configuration"),s=t("shopcart/model/shopcart"),r=t("userPrefs"),n=Backbone.Collection.extend({model:s,initialize:function(){this.url=a.baseServerUrl+"/shopcarts",this._current=null,this.on("sync",function(){if(!this._current||!this._current.get("isShared")){var e=this.findWhere({id:r.get("Current shopcart")});if(!e){var e=this.findWhere({isDefault:!0});e||(e=this.at(0))}this.setCurrent(e)}},this)},parse:function(e){return e.shopcarts?e.shopcarts:[]},getCurrent:function(){return this._current},setCurrent:function(e){if(e!=this._current&&null!==e){var t=this._current;this._current=e,this.trigger("change:current",this._current,t)}},getShopcartSharedURL:function(){return"#data-services-area/shopcart/"+this.getCurrent().id}});i.exports=new n}),require.register("shopcart/view/shopcartExportView",function(e,t,i){var a=(t("configuration"),t("map/geojsonconverter")),s=(t("shopcart/model/shopcartCollection"),t("shopcart/template/shopcartExportContent")),r=Backbone.View.extend({mediaTypes:{kml:"application/vnd.google-earth.kml+xml",gml:"application/gml+xml",geojson:"application/json",metalink:"application/metalink+xml"},events:{"change #shopcart-export-format":function(e){var t=this.$el.find("#download-exported-shopcart"),i=$(e.currentTarget);if(""==i.val())t.addClass("ui-disabled");else{var s=i.val().toLowerCase();t.removeClass("ui-disabled");var r=$.extend(!0,[],this.model.highlights);$.each(r,function(e,t){t._origGeometry&&(t.geometry=t._origGeometry,delete t._origGeometry),t._featureCollection&&delete t._featureCollection,t._isHidden&&delete t._isHidden,t.properties.styleHint&&delete t.properties.styleHint});var n=new Blob([a.convert(r,s)],{type:this.mediaTypes[s]});t.attr("download","export."+s),t.attr("href",URL.createObjectURL(n))}}},render:function(){var e=null;if(window.Blob)try{e=new Blob}catch(t){e=null}return e?(this.$el.append(s()),this.$el.trigger("create"),this.$el.find("#download-exported-shopcart").addClass("ui-disabled")):this.$el.append('<p class="ui-error-message"><b>Export is not supported in your browser</b></p>'),this}});i.exports=r}),require.register("shopcart/view/shopcartTableView",function(e,t,i){var a=t("configuration"),s=t("logger"),r=t("ui/tableView"),n=t("dataAccess/widget/dataAccessWidget"),o=t("dataAccess/widget/directDownloadWidget"),l=t("searchResults/widget/downloadOptionsWidget"),d=t("shopcart/widget/shopcartExportWidget"),c=t("search/model/datasetAuthorizations"),h=(t("search/model/dataSetPopulation"),t("dataAccess/model/simpleDataAccessRequest")),u=r.extend({initialize:function(){var e=this;r.prototype.initialize.apply(this,arguments),this.events=_.extend({},r.prototype.events,this.events),this.columnDefs=a.data.tableView.columnsDef;var t=a.get("tableView.directDownloadColumn",-1);t>=0&&t<this.columnDefs.length&&e.model&&(this.columnDefs[t].getClasses=function(t){return e.model.isBrowserSupportedUrl(t)?"ui-direct-download":""})},events:{"click .directDownload":function(e){if(e.stopPropagation(),this.model.downloadAccess){var t=$(e.currentTarget).closest("tr").data("internal").feature,i=new o(t,this.model.getDirectDownloadProductUrl(t));i.open(e)}else s.inform("Cannot download the product : missing permissions.")}},updateHighlights:function(){r.prototype.updateHighlights.apply(this,arguments),this.model.highlights.length>0?this.exportButton.button("enable"):this.exportButton.button("disable");var e=this.model.getDatasetIdsFromHighlights();e.length>0?(this.deleteButton.button("enable"),this.retrieveProduct.button("enable")):(this.retrieveProduct.button("disable"),this.deleteButton.button("disable"))},setShopcart:function(e){this.shopcart=e,this.setModel(e.featureCollection)},renderButtons:function(e){var t=this;this.retrieveProduct=$('<button data-role="button" data-inline="true" data-mini="true" title="Retrieve highlighted products with download manager">Retrieve</button>').appendTo(e),this.retrieveProduct.button(),a.data.downloadManager.enable?this.retrieveProduct.button("disable"):this.retrieveProduct.button("disable").parent().hide();var t=this;this.retrieveProduct.click(function(){var e=!0;_.each(t.model.highlights,function(i){e&=c.hasDownloadAccess(t.model.getDatasetId(i))}),e?(h.initialize(),h.setProducts(t.model.highlights),n.open(h)):s.inform("Cannot download the product : missing permissions.")}),this.downloadOptionsButton=$('<button data-role="button" data-inline="true" data-mini="true" title="Define download options">Download Options</button>'),this.downloadOptionsButton.button(),this.downloadOptionsButton.button("disable").hide(),this.downloadOptionsButton.click(function(){var e=t.model.getDatasetIdsFromHighlights()[0],i=new l({datasetId:e,featureCollection:t.model,callback:function(e){t.shopcart.updateHighlights(e.getAttributes()).then(function(i){console.log(i),t.model.updateDownloadOptions(e)})}});i.open()}),this.deleteButton=$('<button data-role="button" data-inline="true" data-mini="true" title="Delete highlighted products from this shopcart">Delete</button>').appendTo(e),this.deleteButton.button(),this.deleteButton.button("disable"),this.deleteButton.click(function(){t.shopcart.deleteHighlights()}),this.exportButton=$('<button data-role="button" data-inline="true" data-mini="true" title="Export highlighted products (KML, GeoJson)">Export</button>').appendTo(e),this.exportButton.button(),this.exportButton.button("disable"),this.exportButton.click(function(){var e=new d(t.model);e.open()})}});i.exports=u}),require.register("shopcart/view/shopcartView",function(e,t,i){var a=t("searchResults/map"),s=t("map/map"),r=t("shopcart/template/shopcartViewContent"),n=t("userPrefs"),o=Backbone.View.extend({id:"shopcartBar",initialize:function(){var e=s.addLayer({name:"Shopcart Footprints",type:"Feature",visible:!0,style:"shopcart-footprint"}),t=this,i=function(){var e=t.collection.getCurrent(),i=e.featureCollection.features.length;t.$el.find("#shopcartMessage").html(e.get("name")+" : "+i+" items")};this.collection.on("change:current",function(t,s){s&&(s.featureCollection.off("add:features",i),s.featureCollection.off("remove:features",i),s.off("change:name",i),a.removeFeatureCollection(s.featureCollection,{keepLayer:!0})),i(),e.clear(),a.addFeatureCollection(t.featureCollection,{layer:e,hasBrowse:!1}),t.on("change:name",i),t.featureCollection.on("add:features",i),t.featureCollection.on("remove:features",i),t.loadContent(),n.save("Current shopcart",t.id)})},render:function(){this.$el.html(r()).trigger("create")}});i.exports=o}),require.register("shopcart/widget/shopcartExportWidget",function(e,t,i){var a=(t("configuration"),t("shopcart/view/shopcartExportView")),s=(t("ui/widget"),function(e){var t=$('<div id="exportShopcartPopup">'),i=$('<div id="exportShopcartPopupContent"></div>');i.css("min-width","200px"),i.appendTo(t),t.appendTo(".ui-page-active"),t.ngeowidget({title:"Export",hide:function(){t.remove()}});var s=new a({model:e,el:i});this.open=function(){s.render(),t.ngeowidget("show")},this.close=function(){t.ngeowidget("hide")}});i.exports=s}),require.register("shopcart/widget/shopcartWidget",function(e,t,i){var a=t("shopcart/model/shopcartCollection"),s=t("shopcart/view/shopcartItemView"),r=t("ui/panelManager");t("ui/widget");i.exports={create:function(){var e=new s;return r.addPanelContent({element:e.$el,position:"bottom",activator:"#shopcart",show:$.proxy(e.onShow,e),hide:$.proxy(e.onHide,e)}),e.$el.on("panel:show",$.proxy(e.onShow,shopcartItemView)),e.$el.on("panel:hide",$.proxy(e.onHide,shopcartItemView)),shopcartItemView.on("sizeChanged",function(){r.updatePanelSize("bottom")}),e.listenTo(a,"change:current",shopcartItemView.setShopcart),e.render(),$("#shopcart").addClass("ui-disabled"),a.on("error",function(){$("#shopcart").addClass("ui-disabled")}),a.on("sync",function(){$("#shopcart").removeClass("ui-disabled")}),a.fetch(),e.$el},updateView:function(){shopcartTableView.onShow()}}}),require.register("ui/context-help",function(e,t,i){var a,s="Mouse over interface elements for context help.",r=!1,n=function(e){if(a.show(),e){var t=$(e);a.find("p").html(t.data("help"));var i={top:t.offset().top+t.outerHeight(),left:t.offset().left+t.outerWidth()/2-a.outerWidth()/2};a.offset(i)}else{a.find("p").html(s);var i={top:$(window).height()/2-a.outerHeight()/2,left:$(window).width()/2-a.outerWidth()/2};a.offset(i)}},o=_.debounce(function(e){e?a.hide():o(e)},500),l=function(e){if(r&&!$(e.target).closest("#help").length){var t=$(e.target).is("[data-help]")?$(e.target):$(e.target).closest("[data-help]");return t.length&&n(t),e.stopPropagation(),e.preventDefault(),!1}return!0},d=function(e){var t=$(e.target).is("[data-help]")?$(e.target):$(e.target).closest("[data-help]");return t?(n(t),o(!1),e.stopPropagation(),e.preventDefault(),!1):!0};i.exports=function(e){a=$('<div class="helpTooltip ui-popup-container ui-popup-active">					<div class="ui-popup ui-overlay-shadow ui-corner-all ui-body-e"><p></p>					</div></div>').appendTo(e),a.css("z-index",1102),a.hide();var t=function(e){o($(e.target).closest(".helpTooltip").length||$(e.target).is("[data-help]")||$(e.target).closest("[data-help]").length?!1:!0)};$("#help").click(function(){var e=$(this);e.hasClass("toggle")?(a.hide(),e.removeClass("toggle"),$("[data-help]").removeClass("helpActivated"),$("[data-help]").off("mouseover",d),$("body").off("mousemove",t),$("body").get(0).removeEventListener("click",l,!0)):(a.show(),n(),$("[data-help]").addClass("helpActivated"),$("[data-help]").on("mouseover",d),$("body").on("mousemove",t),$("body").get(0).addEventListener("click",l,!0),e.addClass("toggle")),r=!r})}}),require.register("ui/dateRangeSlider",function(e,t,i){function a(e,t){return Math.floor((e-t)/864e5)}function s(e,t){for(var i=e+"";i.length<t;)i="0"+i;return i}var r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];$.widget("ui.dateRangeSlider",{options:{scaleBounds:null,bounds:null,boundsMaxLength:180,boundsMinLength:10,wheelFactor:7,wheelTimeout:1e3,change:$.noop},_create:function(){var e=this;this.scalePosition=0,this.rightArrow=$('<div style="display: none;" class="dateSlider-rightArrow"></div>').appendTo(this.element).mousedown(function(t){e.autoScaleDirection=e.options.wheelFactor,setTimeout($.proxy(e._autoScaleScroll,e),50)}).mouseup($.proxy(this._onArrowMouseUp,this)),this.leftArrow=$('<div style="display: none;" class="dateSlider-leftArrow"></div>').appendTo(this.element).mousedown(function(t){e.autoScaleDirection=-e.options.wheelFactor,setTimeout($.proxy(e._autoScaleScroll,e),50)}).mouseup($.proxy(this._onArrowMouseUp,this)),this.dragBar=$('<div style="display: none;" class="dateSlider-bar"></div>').appendTo(this.element).mousedown(function(t){$(document).on("mousemove",{lastX:t.pageX},$.proxy(e._onDragBar,e)),$(document).on("mouseup",$.proxy(e._onDragBarStop,e)),t.preventDefault()}),this.startLabel=$('<div style="display: none;" class="dateSlider-label"></div>').appendTo(this.element).mousedown(function(t){$(document).on("mousemove",{lastX:t.pageX},$.proxy(e._moveLeftDrag,e)),$(document).one("mouseup",function(){$(document).off("mousemove",$.proxy(e._moveLeftDrag,e)),e.options.change(e._computeCurrentDate())})}),this.endLabel=$('<div style="display: none;" class="dateSlider-label"></div>').appendTo(this.element).mousedown(function(t){$(document).on("mousemove",{lastX:t.pageX},$.proxy(e._moveRightDrag,e)),$(document).one("mouseup",function(){$(document).off("mousemove",$.proxy(e._moveRightDrag,e)),e.options.change(e._computeCurrentDate())})}),this.container=$('<div class="dateSlider-container"></div>').appendTo(this.element),this.marginLeft=parseInt(this.container.css("marginLeft")),this._createScaleBar(),this.scalePosition=this.container.scrollLeft(),this.wheelTimeoutVar=null,this.element.on("mousewheel",$.proxy(this._onMouseWheel,this)),this.containerWidth=this.container.width(),this._updateDragBar(),_.extend(this,Backbone.Events)},refresh:function(e){var t=this.container.width();(t!=this.containerWidth||e)&&(this.containerWidth=t,this.scalePosition=this.container.scrollLeft(),this.scalePosition+t>this.maxDays&&(this.scalePosition=this.maxDays-t,this.container.scrollLeft(this.scalePosition)),this._moveDrag(0))},_onArrowMouseUp:function(){this.autoScaleDirection=0,this.options.change(this._computeCurrentDate())},_onMouseWheel:function(e,t){if(this._moveDrag(t*this.options.wheelFactor),this.options.change){this.wheelTimeoutVar&&clearTimeout(this.wheelTimeoutVar);var i=this;this.wheelTimeoutVar=setTimeout(function(){i.options.change(i._computeCurrentDate()),i.wheelTimeoutVar=null},this.options.wheelTimeout)}},_updateDragBar:function(){this.dragLeftDays=a(this.options.bounds.min,this.minDate),this.dragRightDays=a(this.options.bounds.max,this.minDate);var e=this.dragRightDays-this.dragLeftDays;e>this.options.boundsMaxLength?this.dragLeftDays=this.dragRightDays-this.options.boundsMaxLength:e<this.options.boundsMinLength&&(this.dragLeftDays=this.dragRightDays-this.options.boundsMinLength),this.dragBar.width(this.dragRightDays-this.dragLeftDays),this._moveDrag(0)},_createScaleBar:function(){this.container.empty();var e=$('<div class="dateSlider-scale"></div>'),t=this.options.scaleBounds&&this.options.scaleBounds.min?this.options.scaleBounds.min:this.options.bounds.min,i=this.options.scaleBounds&&this.options.scaleBounds.max?this.options.scaleBounds.max:this.options.bounds.max,s=parseInt(t.getUTCFullYear()),n=parseInt(i.getUTCFullYear());
s=1978,this.minDate=new Date(Date.UTC(s,0,1,0,0,0));var o=new Date(Date.UTC(n,12,31));this.maxDays=a(i,this.minDate),this.minDays=a(t,this.minDate);for(var l=["31","28","31","30","31","30","31","31","30","31","30","31"],d=s;n>=d;d++){var c=d%4==0&&d%400!=0;e.append('<span class="dateSlider-year dateSlider-y'+(c?"bi":"n")+'">'+d+"</span>");for(var h=2;12>h;h++)e.append('<span class="dateSlider-month dateSlider-m'+l[h]+'">'+r[h]+"</span>")}e.css("width",a(o,this.minDate)),e.on("selectstart",function(){return!1}),this.scaleBar=e.appendTo(this.container)},_moveLeftDrag:function(e){var t=e.pageX-e.data.lastX;this.dragLeftDays+=t,this.dragLeftDays<this.scalePosition?this.dragLeftDays=this.scalePosition:this.dragLeftDays<this.minDays&&(this.dragLeftDays=this.minDays),this.dragRightDays>this.dragLeftDays+this.options.boundsMaxLength?this.dragLeftDays=this.dragRightDays-this.options.boundsMaxLength:this.dragLeftDays>this.dragRightDays-this.options.boundsMinLength&&(this.dragLeftDays=this.dragRightDays-this.options.boundsMinLength),this.dragBar.width(this.dragRightDays-this.dragLeftDays);var i=this.dragLeftDays+this.marginLeft-this.scalePosition;this.dragBar.css("left",i),this._updateLabels(),e.data.lastX=e.pageX,e.preventDefault()},_moveRightDrag:function(e){var t=e.pageX-e.data.lastX;this.dragRightDays+=t,this.dragRightDays>this.scalePosition+this.containerWidth?this.dragRightDays=this.scalePosition+this.containerWidth:this.dragRightDays>this.dragLeftDays+this.options.boundsMaxLength?this.dragRightDays=this.dragLeftDays+this.options.boundsMaxLength:this.dragRightDays<this.dragLeftDays+this.options.boundsMinLength&&(this.dragRightDays=this.dragLeftDays+this.options.boundsMinLength),this.dragBar.width(this.dragRightDays-this.dragLeftDays),this._updateLabels(),e.data.lastX=e.pageX,e.preventDefault()},_computeCurrentDate:function(){return{min:new Date(this.minDate.getTime()+864e5*this.dragLeftDays),max:new Date(this.minDate.getTime()+864e5*this.dragRightDays)}},_formatDate:function(e){return s(e.getUTCDate(),2)+"-"+s(r[e.getUTCMonth()],2)+"-"+e.getUTCFullYear()},_updateLabels:function(){var e=this._computeCurrentDate();this.startLabel.html(this._formatDate(e.min)),this.endLabel.html(this._formatDate(e.max));var t=this.dragLeftDays+this.marginLeft-this.scalePosition,i=this.dragRightDays+this.marginLeft-this.scalePosition,a=t-this.startLabel.outerWidth()/2,s=i-this.endLabel.outerWidth()/2;a+this.startLabel.outerWidth()>s&&(s=t+this.dragBar.width()/2+1,a=s-2-this.startLabel.outerWidth()),this.startLabel.css({left:a,top:-this.startLabel.outerHeight()}),this.endLabel.css({left:s,top:-this.startLabel.outerHeight()})},_moveDrag:function(e){this.dragLeftDays+e<=this.minDays?(this.dragRightDays+=this.minDays-this.dragLeftDays,this.dragLeftDays=this.minDays,$(".dateSlider-leftArrow").addClass("ui-disabled")):this.dragRightDays+e>=this.maxDays?(this.dragLeftDays+=this.maxDays-this.dragRightDays,this.dragRightDays=this.maxDays,$(".dateSlider-rightArrow").addClass("ui-disabled")):($(".dateSlider-leftArrow").removeClass("ui-disabled"),$(".dateSlider-rightArrow").removeClass("ui-disabled"),this.dragLeftDays+=e,this.dragRightDays+=e);var t=0;this.dragRightDays>this.scalePosition+this.containerWidth?t=this.dragRightDays-(this.scalePosition+this.containerWidth):this.dragLeftDays<this.scalePosition&&(t=this.dragLeftDays-this.scalePosition),0!=t&&(this.scalePosition+=t,this.container.scrollLeft(this.scalePosition));var i=this.dragLeftDays+this.marginLeft-this.scalePosition;this.dragBar.css("left",i),this._updateLabels()},_autoScaleScroll:function(){0!=this.autoScaleDirection&&(this._moveDrag(this.autoScaleDirection),setTimeout($.proxy(this._autoScaleScroll,this),50))},_onDragBar:function(e){var t=this.dragRightDays==this.scalePosition+this.containerWidth&&e.pageX>e.data.lastX,i=this.dragLeftDays==this.scalePosition&&e.pageX<e.data.lastX;t||i?(this.autoScaleDirection=t?this.options.wheelFactor:-this.options.wheelFactor,setTimeout($.proxy(this._autoScaleScroll,this),50)):(this._moveDrag(e.pageX-e.data.lastX),e.data.lastX=e.pageX,this.autoScaleDirection=0)},_onDragBarStop:function(e){this.autoScaleDirection=0,$(document).off("mousemove",$.proxy(this._onDragBar,this)),$(document).off("mouseup",$.proxy(this._onDragBarStop,this)),this.options.change(this._computeCurrentDate())},_destroy:function(){this.element.empty(),this.element.off("mousewheel",$.proxy(this._onMouseWheel,this))},_setOptions:function(){$.Widget.prototype._setOptions.apply(this,arguments)},show:function(e){var t=this;t.element.height()||($(t.element).trigger("drs:show",[]),setTimeout(function(){t.element.animate({height:24},400,function(){$(t.element).find("> div").show(),t.refresh(!0),t.trigger("drs:show")})},0))},hide:function(e){var t=this;t.element.height()&&($(t.element).trigger("drs:hide",[]),this.element.stop(!0,!0).animate({height:0},400,function(){e&&e(),$(t.element).find("> div").not(".dateSlider-container").hide()}))},_setOptions:function(){this._superApply(arguments),this.refresh()},_setOption:function(e,t){switch(e){case"bounds":(t.min!=this.options.bounds.min||t.max!=this.options.bounds.max)&&(this.options.bounds=t,this.scalePosition=this.scalePosition=this.container.scrollLeft(),this._updateDragBar());break;case"scaleBounds":this.options.scaleBounds=t,this._createScaleBar()}$.Widget.prototype._setOption.call(this,e,t)}})}),require.register("ui/ganttView",function(e,t,i){var a=t("configuration"),s=t("map/map"),r=["31","28","31","30","31","30","31","31","30","31","30","31"],n=Backbone.View.extend({initialize:function(e){this.scale="quarter-day"},id:"ganttView",events:{"change input[name=radio-time-scale]":function(e){this.scale=e.currentTarget.value,this.model.features.length>0&&(this.clear(),this.addData(this.model.features))}},setModel:function(e){this.model&&this.stopListening(this.model),this.model=e,this.model&&(this.listenTo(this.model,"reset:features",this.clear),this.listenTo(this.model,"add:features",this.addData))},clear:function(){this.$el.find(".gantt-data-panel").detach(),this.$el.append('<div class="gantt-data-panel"><div class="gantt-nodata">No data to display</div></div>')},addData:function(e){if(0!=e.length){this.$el.find(".gantt-data-panel").empty();for(var t=a.getMappedProperty(e[0],"start"),i=a.getMappedProperty(e[0],"stop"),s=1;s<e.length;s++)a.getMappedProperty(e[s],"start")<t&&(t=a.getMappedProperty(e[s],"start")),a.getMappedProperty(e[s],"stop")>i&&(i=a.getMappedProperty(e[s],"stop"));this.buildTable(Date.fromISOString(t),Date.fromISOString(i),e.length);for(var s=0;s<e.length;s++)this.addBar(e[s]);this.$el.find(".gantt-body-scroll").scrollLeft(this.$el.find("table").width())}},show:function(){this.$el.show()},hide:function(){this.$el.hide()},buildDayScale:function(e,t){var i=new Date(e.getFullYear(),e.getMonth(),1,0,0,0,0);this.startDate=new Date(e.getFullYear(),e.getMonth(),1,0,0,0,0);for(var a=$("<tr>"),s=$('<tr class="gantt-head-20">');t>i;){a.append('<th colspan="'+r[i.getMonth()]+'">'+(i.getMonth()+1)+"/"+i.getFullYear()+"</th>");for(var n=0;n<r[i.getMonth()];n++)s.append("<th>"+(n+1)+"</th>");i=new Date(i.getTime()+24*r[i.getMonth()]*3600*1e3)}return $("<thead>").append(a).append(s)},buildQuarterDayScale:function(e,t){var i=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0);this.startDate=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0);for(var a=$("<tr>"),s=$('<tr class="gantt-head-60">');t>i;){a.append('<th colspan="4">'+i.toDateString()+"</th>");for(var r=0;4>r;r++)s.append("<th>"+6*r+"-"+6*(r+1)+"</th>");i=new Date(i.getTime()+864e5)}return $("<thead>").append(a).append(s)},buildHourScale:function(e,t){var i=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0);this.startDate=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0);for(var a=$("<tr>"),s=$('<tr class="gantt-head-20">');t>i;){a.append('<th colspan="24">'+i.toDateString()+"</th>");for(var r=0;24>r;r++)s.append("<th>"+r+"</th>");i=new Date(i.getTime()+864e5)}return $("<thead>").append(a).append(s)},buildMinuteScale:function(e,t,i){var a=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()+e.getTimezoneOffset()/60,0,0,0),s=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()+e.getTimezoneOffset()/60,t.getMinutes(),t.getSeconds(),t.getMilliseconds());this.startDate=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()+e.getTimezoneOffset()/60,0,0,0);for(var r=$("<tr>"),n=$('<tr class="gantt-head-20">');s>a;){r.append('<th colspan="'+60/i+'">'+a.toISODateString()+" "+a.getHours()+"h</th>");for(var o=0;60>o;o+=i)n.append("<th>"+o+"</th>");a=new Date(a.getTime()+36e5)}return $("<thead>").append(r).append(n)},getPosition:function(e){var t=e-this.startDate+60*e.getTimezoneOffset()*1e3;return"day"==this.scale?21*t/864e5:"quarter-day"==this.scale?61*t/216e5:"hour"==this.scale?21*t/36e5:"10-minute"==this.scale?21*t/6e5:"minute"==this.scale?21*t/6e4:void 0},addBar:function(e){var t=Date.fromISOString(a.getMappedProperty(e,"start")),i=Date.fromISOString(a.getMappedProperty(e,"stop")),r="Id : "+e.id+"&#13;";r+="Start : "+t.toISOString()+"&#13;",r+="End  : "+i.toISOString();var n=$('<div title="'+r+'" class="gantt-bar">'),o=this.getPosition(t),l=this.getPosition(i),d=this.$el.find(".gantt-body-scroll").children(".gantt-bar").length;n.css({top:1+21*d,left:o,width:l-o});var c=this;n.appendTo(this.$el.find(".gantt-body-scroll")).click(function(){c.model.setHighlight&&(s.zoomToFeature(e),c.model.setHighlight([e]))})},buildTable:function(e,t,i){var a=$('<table cellspacing="0" cellpadding="0">');"day"==this.scale&&a.append(this.buildDayScale(e,t)),"quarter-day"==this.scale?a.append(this.buildQuarterDayScale(e,t)):"hour"==this.scale?a.append(this.buildHourScale(e,t)):"10-minute"==this.scale?a.append(this.buildMinuteScale(e,t,10)):"minute"==this.scale&&a.append(this.buildMinuteScale(e,t,1));var s=a.find("thead tr:last-child").children().length;if(s>1e3)return void this.$el.append('<div class="gantt-data-panel"><div class="gantt-nodata">Cannot display data for the selected time scale : '+s+" steps needed.</div></div>");var r=($('<table cellspacing="0" cellpadding="0">'),"<tr");"quarter-day"==this.scale&&(r+=' class="gantt-body-60"'),r+=">";for(var n=0;s>n;n++)r+="<td></td>";r+="</tr>";for(var o='<table cellspacing="0" cellpadding="0"><tbody>',l=0;i>l;l++)o+=r;o+="</tbody></table>";var a=$('<div class="gantt-head-scroll">').append(a);this.$el.find(".gantt-data-panel").append(a).append('<div class="gantt-body-scroll">'+o+"</div>");var d=this.$el.find(".gantt-head-scroll");this.$el.find(".gantt-body-scroll").scroll(function(e){d.scrollLeft($(this).scrollLeft())})},render:function(){this.$el.addClass("gantt-view"),this.$el.append('<div class="gantt-left-panel">		<fieldset data-role="controlgroup" data-mini="true">				<legend>Time scale:</legend>					<label>Minute<input type="radio" name="radio-time-scale" value="minute" /></label>					<label>10 minute<input type="radio" name="radio-time-scale" value="10-minute" /></label>					<label>Hour<input type="radio" name="radio-time-scale" value="hour" /></label>					<label>Quarter day<input type="radio" name="radio-time-scale" value="quarter-day" checked="checked" /></label>					<label>Day<input type="radio" name="radio-time-scale" value="day" /></label>		</fieldset></div>'),this.clear(),this.$el.trigger("create")}});i.exports=n}),require.register("ui/menubar",function(e,t,i){var a=(t("logger"),null),s=null,r={},n=new Backbone.Router,o=function(e,t){e.data("nowrap")||(t.children().wrapAll('<div class="menuBarPageContent"></div>'),t.addClass("menuBarPage")),r[e.attr("href")]=t,t.hide(),$("#mapContainer").prepend(t)},l=function(e){e.attr("href");if(e.data("module")){var i=t(e.data("module")),a=i.buildElement();o(e,a),a.data("module",i),i.initialize(a)}},d=function(e){e.slideDown(200),s=e;var t=s.data("module");t&&t.show&&t.show()},c=function(e){var t=e.attr("href"),i=r[t];if(i)if(s){var n=s.data("module");n&&n.hide&&n.hide(),s.slideUp(200,function(){d(i)})}else d(i);e.addClass("active"),a&&a.removeClass("active"),a=e},h=function(){$.mobile.loading("hide");var e=Backbone.history.start();if(!e){var t=$("header nav").data("default");Backbone.history.navigate(t,{trigger:!0})}};i.exports={initialize:function(e){$(e).find("a");$(e).find("a").each(function(){var e=$(this),t=e.attr("href");if("#"==t.charAt(0)){var i=$(e.attr("href"));i.length>0?o(e,i):l(e),"data-services-area"!=t.substr(1)&&n.route(t.substr(1),t.substr(1),function(){c(e)})}}),h()},showPage:function(e){c($("a[href=#"+e+"]"))}}}),require.register("ui/pagination",function(e,t,i){var a=Backbone.View.extend({initialize:function(e){this.model&&(this.setupListeners(),this.updatePagination()),this.pagesRange=5},events:{"click .first":function(){this.model.changePage(1)},"click .last":function(){this.model.changePage(this.model.lastPage)},"click .next":function(){this.model.changePage(this.model.currentPage+1)},"click .prev":function(){this.model.changePage(this.model.currentPage-1)},"click .pageNum":function(e){this.model.changePage(parseInt($(e.currentTarget).attr("value")))}},updatePagination:function(){this.$el.find(".pageNum").remove(),parseInt(this.model.totalResults)>0?(this.$el.find("#globalPaging a").removeClass("ui-disabled"),1==this.model.currentPage&&(this.$el.find(".prev").addClass("ui-disabled"),this.$el.find(".first").addClass("ui-disabled")),this.model.currentPage==this.model.lastPage&&(this.$el.find(".next").addClass("ui-disabled"),this.$el.find(".last").addClass("ui-disabled")),this.generatePages()):0==this.model.totalResults&&this.$el.find("#globalPaging a").addClass("ui-disabled"),this.trigger("pagination:updated")},setupListeners:function(){this.listenTo(this.model,"reset:features",this.updatePagination),this.listenTo(this.model,"add:features",this.updatePagination),this.listenTo(this.model,"error:features",function(e){console.error("Error while retrieving features : "+e)})},setModel:function(e){this.model&&this.stopListening(this.model),this.model=e,this.setupListeners(),this.updatePagination()},generatePages:function(){if(this.model){var e,t=Math.floor(this.pagesRange/2)+1;this.model.lastPage<=this.pagesRange?(e=1,endIndex=this.model.lastPage):(e=this.model.currentPage<=t?1:this.model.currentPage-(t-1),this.model.currentPage+t>this.model.lastPage?endIndex=this.model.lastPage:endIndex=this.model.currentPage+(t-1));for(var i=e;i<=endIndex;i++)this.$el.find(".next").before('<a class="pageNum" data-role="button" value="'+i+'" title="Go to page '+i+'">'+i+"</a>");this.$el.find('.pageNum[value="'+this.model.currentPage+'"]').addClass("ui-btn-active"),this.$el.trigger("create")}},render:function(){var e='<div id="globalPaging" style="text-align: center; margin: 4px 15px;" data-role="controlgroup" data-type="horizontal" data-mini="true">			<a class="first" data-role="button" title="Go to first page"><<</a>			<a class="prev" data-role="button" title="Go to previous page"><</a>			<a class="next" data-role="button" title="Go to next page">></a>			<a class="last" data-role="button" title="Go to last page">>></a>		</div>';this.$el.html(e).trigger("create"),this.$el.find("a").addClass("ui-disabled"),this.model&&this.updatePagination()}});i.exports=a}),require.register("ui/panelManager",function(e,t,i){var a=Backbone.View.extend({initialize:function(e){jQuery.fn.redraw=function(){return this.hide(0,function(){$(this).show()})},this.$center=$(e.center);var t=this;this.centerResizedCallback=function(){var e=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);e&&$("#map").redraw(),t.trigger("centerResized")},this.leftResizedCallback=function(){t.trigger("leftResized")};var i=_.debounce(function(){t.trigger("centerResized"),t.trigger("leftResized")},300);$(window).resize(i),$("#dateRangeSlider").on("drs:hide",function(){var e=parseFloat(t.left.$el.css("bottom"));t.left.$el.animate({bottom:e-24},400,t.leftResizedCallback)}),$("#dateRangeSlider").on("drs:show",function(){setTimeout(function(){var e=parseFloat(t.left.$el.css("bottom"));t.left.$el.animate({bottom:e+24},400,t.leftResizedCallback)},0)}),this._centerState=null},add:function(e,t){this[e]=t,t.regionManager=this,t.region=e},save:function(){this.bottom.$el.hide(),this.left.$el.hide(),this._centerState={bottom:this.$center.css("bottom"),left:this.$center.css("left")},this.$center.css({bottom:0,left:0}),this.trigger("centerResized")},restore:function(){this._centerState&&(this.bottom.$el.show(),this.bottom.activeView&&this.bottom.activeView.refresh&&this.bottom.activeView.refresh(),this.left.$el.show(),this.$center.css(this._centerState),this.trigger("centerResized"))},updatePanelSize:function(e){var t=this.getSize(e),i=parseFloat(this.$center.css(e));if(t!=i){var a={};a[e]=t,"bottom"==e&&(this.left.$el.css(a),this.trigger("leftResized"))}},getSize:function(e){switch(e){case"left":return this.left.$el.outerWidth();case"bottom":return this.bottom.$el.outerHeight()}return 0},show:function(e,t){var i={};i[e]=this.getSize(e);var a=0;"bottom"==e&&(a=$("#bottomToolbar").height()+$("#dateRangeSlider").height()+2,this.$center.animate({bottom:i.bottom-a},t,this.centerResizedCallback),this.left.$el.animate({bottom:i.bottom},t,this.leftResizedCallback)),i[e]=0,this[e].$el.animate(i,t),"left"==e&&$("#searchToolbar").animate({left:402}),this.listenTo(this[e],"sizeChanged",_.bind(this.updatePanelSize,this,e))},hide:function(e,t,i){var a={};a[e]=0;var s=0;"bottom"==e&&(this.$center.animate(a,t,this.centerResizedCallback),s=$("#bottomToolbar").height()+$("#dateRangeSlider").height()+2,this.left.$el.animate({bottom:a.bottom+s},t,this.leftResizedCallback)),a[e]=-this.getSize(e)+s,this[e].$el.animate(a,t,i),"left"==e&&$("#searchToolbar").animate({left:0}),this.stopListening(this[e],"sizeChanged")}});i.exports=a}),require.register("ui/productService",function(e,t,i){var a=(t("logger"),[]),s=[],r=[];i.exports={addHighlightedProducts:function(e){a=_.uniq(_.union(a,e),"id")},getHighlightedProducts:function(){return a},removeHighlightedProducts:function(e){a=_.difference(a,e)},resetHighlightedProducts:function(e){a=[]},addBrowsedProducts:function(e){r=_.uniq(_.union(r,e),"id")},getBrowsedProducts:function(){return r},removeBrowsedProducts:function(e){r=_.difference(r,e)},resetBrowsedProducts:function(e){r=[]},addCheckedProducts:function(e){s=_.uniq(_.union(s,e),"id")},getCheckedProducts:function(){return s},removeCheckedProducts:function(e){s=_.difference(s,e)},resetCheckedProducts:function(e){s=[]}}}),require.register("ui/sharePopup",function(e,t,i){var a,s=t("ui/template/sharePopup");i.exports={open:function(e){a||(a=$(s()),a.find("#sharedUrlLinks a").addClass("tb-elt").wrapInner('<div class="tb-text"></div>').prepend('<div class="tb-icon"></div>').click(function(){a.popup("close")}),a.appendTo(".ui-page-active"),a.popup(),a.trigger("create"),a.find("#sharedUrlLinks a").removeClass("ui-link"));var t=e.url,i=encodeURIComponent(window.location.origin+window.location.pathname+t.substr(t.indexOf("/sec/")+"/sec/".length));t=window.location.origin+window.location.pathname+"?sharedUrl="+i,$("#facebook").attr("href","https://www.facebook.com/sharer.php?u="+encodeURIComponent(t)),$("#twitter").attr("href","http://twitter.com/intent/tweet?status="+encodeURIComponent(t)),$("#email").attr("href","mailto:?body="+encodeURIComponent(t)),$("#raw").attr("href",t),a.popup("open",e)}}}),require.register("ui/stackPanel",function(e,t,i){var a=null,s=null,r=Backbone.View.extend({initialize:function(e){this.regionManager=null,this.classes=e.classes,this.activeView=null},add:function(e,t){this.$el.append(e.$el),e.on("sizeChanged",function(){this.trigger("sizeChanged")},this),e.$el.hide().addClass(this.classes),e.$activator=$(t);var i=this;e.$activator.click(function(){i._toggle(e)}),"datasetSearchCriteria"==e.id&&(a=e),e.hasOwnProperty("areaCriteriaView")&&(s=e)},_toggle:function(e){if(e==this.activeView){var t=this;this.regionManager.hide(this.region,400,function(){t.activeView.$el.hide(),t.activeView.onHide&&t.activeView.onHide(),t.activeView=null;var i=e.areaCriteriaView?e:a;i.onShow()}),e.$activator.removeClass("toggle")}else this.activeView&&(this.activeView.$el.hide(),this.activeView.$activator.removeClass("toggle"),this.activeView.onHide&&this.activeView.onHide()),s.onHide(),s=e.areaCriteriaView?e:a,s.onShow(),e.$el.show(),e.onShow&&e.onShow(),e.$activator.addClass("toggle"),this.activeView||this.regionManager.show(this.region,400),this.activeView=e}});i.exports=r}),require.register("ui/statusPanel",function(e,t,i){var a=t("configuration"),s=t("map/map"),r=t("searchResults/browsesManager"),n=t("search/model/datasetSearch"),o=t("ui/pagination"),l=t("searchResults/model/searchResults"),d=t("ui/sharePopup"),c=Backbone.View.extend({events:{"click #statusBtnSearch":function(){l.launch(n)},"click #statusBtnShare":function(e){var t=$(e.currentTarget);d.open({openSearchUrl:n.getOpenSearchURL({format:"atom"}),url:a.serverHostName+window.location.pathname+n.getSharedSearchURL(),positionTo:t[0]})}},initialize:function(e){var t=this;this.dateRangeSlider=$("#dateRangeSlider").dateRangeSlider({bounds:{min:n.get("start"),max:n.get("stop")}}),this.regionManager=null,this.classes=e.classes,this.bottomActivator=null,this.activeStatus=null,this.activeView=null,s.on("pickedFeatures",function(e){for(var t=null,i=new Date("1980-01-01"),s=0;s<e.length;s++){var r=e[s],n=new Date(a.getMappedProperty(r,"start"));n>i&&(i=n,t=r._featureCollection)}t&&(t.dataset?t.id&&$("#result"+t.id).click():$("#shopcart").click())}),s.on("visibility:changed",function(e){if("Browses"!=e.params.type){var t=e.params.name.substr(0,e.params.name.indexOf(" Result")),i="#result"+t;t||(t=e.params.name.substr(0,e.params.name.indexOf(" Footprint")),i="#shopcart"),e.params.visible?$(i).find(".layerVisibility").removeClass("ui-icon-checkbox-off").addClass("ui-icon-checkbox-on"):$(i).find(".layerVisibility").removeClass("ui-icon-checkbox-on").addClass("ui-icon-checkbox-off")}}),this.pagination=new o({model:null,el:this.$el.find("#statusPagination")}),this.pagination.render();var i=function(){var e=$("#bottomToolbar").outerWidth(),i=40,a=t.$el.find("#statusPagination").width(),s=70,r=40;$("#bottomDatasets").width(e-a-s-r-i)};$(window).resize(i),this.listenTo(this.pagination,"pagination:updated",i)},showTable:function(){$("#table").click(),this.toggleView(this.activeStatus.views[0])},addView:function(e){e.on("sizeChanged",function(){this.trigger("sizeChanged")},this),this.$el.append(e.$el),e.$el.hide().addClass(this.classes)},toggleView:function(e){e==this.activeView?(this.regionManager.hide(this.region,400),this.activeView=null):(this.activeView&&this.activeView.hide(),e.show(),this.activeView||this.regionManager.show(this.region,400),this.activeView=e)},showStatus:function(e){if(this.activeStatus){this.activeStatus.$el.hide(),$(this.activeStatus.activator).removeClass("toggle");for(var t=0;t<this.activeStatus.views.length;t++)this.activeStatus.views[t].setModel(null)}if($(e.activator).addClass("toggle"),this.activeView){var i=e.views.indexOf(this.activeView);0>i&&(this.toggleView(e.views[0]),this.activeView=e.views[0])}else this.toggleView(e.views[0]),this.activeView=e.views[0];for(var t=0;t<e.views.length;t++)e.views[t].setModel(e.model);this.pagination.setModel(e.model),this.activeStatus=e},buildResultMessage:function(e,t){var i="";if(t.totalResults>0){var a=1+(t.currentPage-1)*t.countPerPage,s=Math.min(a+t.features.length-1,t.totalResults);i=a+" to "+s+" of "+t.totalResults}else i=0==t.totalResults?"No product found.":"No search done.";return i},addStatus:function(e){var t=this;e.model&&(this.listenTo(e.model,"startLoading",function(){$(e.activator).find(".nbFeatures").html("Searching...").addClass("pulsating")}),this.listenTo(e.model,"add:features",function(t,i){$(e.activator).find(".nbFeatures").removeClass("pulsating").html(this.buildResultMessage(t,i))}),this.listenTo(e.model,"remove:features",function(t,i){$(e.activator).find(".nbFeatures").html(this.buildResultMessage(t,i))}),this.listenTo(e.model,"error:features",function(t){$(e.activator).find(".nbFeatures").removeClass("pulsating").html("Error on search")}),this.listenTo(e.model,"reset:features",function(t){0==t.currentPage&&$(e.activator).find(".nbFeatures").html("No search done")}),this.listenTo(e.model,"endLoading",function(t){void 0!==typeof t&&0===t&&$(e.activator).find(".nbFeatures").removeClass("pulsating").html("No data to display")})),$(e.activator).unbind("click").click(function(){$(this).hasClass("toggle")||(t.showStatus(e),t.activeView=e.views[0])}),$(e.activator).find(".layerVisibility").click(function(t){t.stopPropagation();var i=e.model._footprintLayer,a=!i.params.visible;i.setVisible(a);for(var s=r.getSelectedBrowseLayers(e.model),n=0;n<s.length;n++)s[n].setVisible(a)}),this.activeStatus?e.$el.hide():this.showStatus(e)},removeStatus:function(e){$(e).remove()},setActiveView:function(e){this.activeView=e}});i.exports=c}),require.register("ui/tableView",function(e,t,i){var a=t("configuration"),s=t("search/model/datasetSearch"),r=t("map/map"),n=t("ui/pagination"),o=t("ui/template/tableColumnsPopup"),l=(t("searchResults/model/featureCollection"),t("searchResults/map"),t("searchResults/widget/multipleBrowseWidget")),d=t("ui/productService"),c=!1,h=!1,u=!1,p=null,g=!1,f=!1,m=function(e,t){for(var i=0;i<e.length;i++){var a=e[i],s=_.indexOf(t,a);-1!==s?t.splice(s,1):t.push(a)}},v=Backbone.View.extend({initialize:function(e){this.setModel(this.model),e&&(this.columnDefs=e.columnDefs),this.hasExpandableRows=!1,this.rowsData=[],this.visibleRowsData=[],this.feature2row={},this.maxVisibleColumns=10;var t=this,i=function(e){e.ctrlKey&&(c=!0),e.metaKey&&(h=!0),e.shiftKey&&(u=!0),(h||c)&&"65"==e.keyCode&&(e.preventDefault(),t.model&&(t.model.highlights.length===t.model.features.length?t.model.checkAllHighlight():t.model.setHighlight(t.model.features)))},a=function(e){c=e.ctrlKey,h=e.metaKey,u=e.shiftKey};document.addEventListener("keydown",i),document.addEventListener("keyup",a),this.triggerHighlightFeature=_.debounce(function(){t.updateHighlights()},10)},events:{"keyup input":function(e){this.filterData($(e.currentTarget).val())},"dblclick tr":function(e){var t=$(e.currentTarget).data("internal");t&&(r.zoomToFeature(t.feature),f=!0)},"click .multipleBrowse":function(e){var t=$(e.currentTarget).closest("tr").data("internal");l.open({feature:t.feature,featureCollection:this.model})},"click tr":function(e){var t=$(e.currentTarget),i=t.data("internal");if(i){var a,s=this.model;if(c||h)s.isHighlighted(i.feature)?s.unsetHighlight([i.feature]):s.setHighlight([i.feature]);else if(u&&p){document.getSelection().removeAllRanges();var r=[p,t].sort(function(e,t){return e.index()-t.index()}),n=r[0].nextUntil(r[1]);n.push(e.currentTarget);var o=_.map(n,function(e){return $(e).data("internal").feature});a=s.highlights.slice(0),m(o,a),s.setHighlight(a)}else s.isHighlighted(i.feature)&&f?f=!1:(s.checkAllHighlight(),s.setHighlight([i.feature]));g=!0,p=t}},"click th":function(e){var t=$(e.currentTarget);if(t.siblings("th").removeClass("sorting_asc").removeClass("sorting_desc"),!(t.find("#table-columns-button").length>0)){var i=this.columnDefs.indexOf(_.find(this.columnDefs,function(e){return e.sTitle==t.html()}));t.hasClass("sorting_asc")?(t.removeClass("sorting_asc"),this.sortData(-1,"original")):t.hasClass("sorting_desc")?(t.removeClass("sorting_desc"),t.addClass("sorting_asc"),this.sortData(i,"asc")):(t.addClass("sorting_desc"),this.sortData(i,"desc"))}},"click .table-view-expand":function(e){var t=$(e.currentTarget).toggleClass("ui-icon-minus").toggleClass("ui-icon-plus").closest("tr"),i=t.data("internal");i.isExpanded=!i.isExpanded,i.isExpanded?this.expandRow(t):this.closeRow(t)},"click .row-pin":function(e){e.stopPropagation();var t=$(e.currentTarget),i=t.closest("tr"),a=i.data("internal");if(t.hasClass("ui-icon-pin-off")){if(this.model.select(this.model.highlights),a){var s=a.parent?a.parent.childFc:this.model;s.select([a.feature]),s.setHighlight([a.feature])}}else if(this.model.unselect(this.model.highlights),a){var s=a.parent?a.parent.childFc:this.model;s.unselect([a.feature])}},"click #table-columns-button":function(e){var t=this;$(o(this)).appendTo(".ui-page-active").trigger("create").popup({theme:"c"}).on("change","input",function(e){var i=$(this).data("index");t.columnDefs[i].visible=$(this).is(":checked"),t.buildTable(),t.buildTableContent()}).on("popupafterclose",function(e,t){$(this).remove()}).popup("open",{positionTo:this.$el.find("#table-columns-button")})},"click #unpin-button":function(e){this.model.unselect(this.model.selections)},"click .loadMore":function(e){var t=$(e.currentTarget).closest(".paging").data("internal");t.childFc.isLoading||t.childFc.appendPage(t.childFc.currentPage+1)}},setModel:function(e){this.model&&(this.clear(),this.stopListening(this.model)),this.model=e;this.model&&(this.listenTo(this.model,"reset:features",this.clear),this.listenTo(this.model,"add:features",this.addData),this.listenTo(this.model,"remove:features",this.removeData),this.listenTo(this.model,"selectFeatures",this.updateSelection),this.listenTo(this.model,"unselectFeatures",this.updateSelection),this.listenTo(this.model,"highlightFeatures",this.triggerHighlightFeature),this.listenTo(this.model,"unhighlightFeatures",this.unhighlightFeatures),this.listenTo(this.model,"update:downloadOptions",this.updateRows),this.model.features.length>0&&this.addData(this.model.features),$("#filterTableInput").val()&&this.filterData($("#filterTableInput").val()))},updateRows:function(e){for(var t=0;t<e.length;t++){var i=e[t],s=this._getRowFromFeature(i),r=s.data("internal"),n=1;r.isExpandable&&n++,r.cellData.length=0;for(var o=0;o<this.columnDefs.length;o++){var l=a.getPropertyFromPaths(i,this.columnDefs[o].mData);r.cellData.push(l),$(s.find("td").get(o+n)).html(l)}this._updateRow(r,s)}this.updateFixedHeader()},updateHighlights:function(){if(this.$table){var e=this,t=d.getHighlightedProducts();if(t.length>0){for(var i=(this.$table.find("tbody tr"),0);i<t.length;i++){var s=this._getRowFromFeature(t[i]);s&&s.addClass("row_highlighted")}var r=_.max(_.filter(t,function(t){return t._featureCollection.id===e.model.id}),function(e){return new Date(a.getMappedProperty(e,"stop"))}),n=this._getRowFromFeature(r);n&&!g?this._scrollTo(n):g=!1}}},unhighlightFeatures:function(e){if(this.$table){if(e.length>0)for(var t=(this.$table.find("tbody tr"),0);t<e.length;t++){var i=this._getRowFromFeature(e[t]);i&&i.removeClass("row_highlighted")}this.updateHighlights()}},_scrollTo:function(e){var t=e.position().top,i=e.height()/2,a=t>i&&t<this.$el.find(".table-content").height()-i;a||this.$el.find(".table-content").animate({scrollTop:t-this.$el.find(".table-content tbody").position().top-90},{duration:500,easing:"easeOutQuad"})},_getRowFromFeature:function(e){if(this.feature2row.hasOwnProperty(e.id)){var t=this.feature2row[e.id];return t}return null},updateSelection:function(e){if(this.$table)for(var t=0;t<e.length;t++){var i=this._getRowFromFeature(e[t]);i&&this.model.selections.indexOf(e[t])>=0?(i.addClass("row_selected"),i.find(".row-pin").addClass("ui-icon-pin-on").removeClass("ui-icon-pin-off")):i&&(i.removeClass("row_selected"),i.find(".row-pin").removeClass("ui-icon-pin-on").addClass("ui-icon-pin-off"))}},clear:function(){if(this.$table){this.$table.html('<div class="table-nodata">No data found</div>'),this.rowsData=[],this.hasExpandableRows=!1;for(var e=0;e<this.columnDefs.length;e++)this.columnDefs[e].numValidCell=0}},createRowData:function(e,t){var i=!1,s=!1,r=a.getMappedProperty(e,"links",null);r&&(i=Boolean(_.find(r,function(e){return"related"==e["@rel"]&&"interferometry"==e["@title"]})),s|=Boolean(a.getMappedProperty(e,"virtualProductUrl",null)),i|=s);for(var n=String(e.id).replace(/\W/g,"_"),o={feature:e,cellData:[],isExpandable:i?!t:!1,isExpanded:this.model.children[n]?!0:!1,hasGraticules:s,isCheckable:t&&t.hasGraticules?!1:!0,childFc:this.model.children[n],children:[],isLoading:!1},l=this.columnDefs,d=0;d<l.length;d++){
var c=a.getPropertyFromPaths(e,l[d].mData);o.cellData.push(c),c&&l[d].numValidCell++}return o},addData:function(e,t,i){if(e.length>0){for(var a=!1,r=0;r<e.length;r++){var n=e[r],o=this.createRowData(n,i);if(a|=o.hasGraticules,o.childFc)for(var l=0;l<o.childFc.features.length;l++){var d=o.childFc.features[l],c=this.createRowData(d,o);c.parent=o,o.children.push(c)}i?(i.children.push(o),o.parent=i):this.rowsData.push(o)}if(("Simple"!=s.get("mode")||a)&&(this.hasExpandableRows=!0),this.visibleRowsData=this.rowsData.slice(0),i){var h=this._getRowFromFeature(i.feature);this.updateChildren(i,h)}else this.buildTable(),this.buildTableContent()}else if(i){var h=this._getRowFromFeature(i.feature);$('<tr><td></td><td></td><td colspan="'+this.columnDefs.length+'">No data found</td></tr>').insertAfter(h)}else this.$table&&this.$table.html('<div class="table-nodata">No data found</div>')},removeData:function(e){for(var t=(this.$table.find("tbody tr"),0);t<e.length;t++){var i=this._getRowFromFeature(e[t]);if(i){i.remove();for(var a=0;a<this.visibleRowsData.length;a++)if(this.visibleRowsData[a].feature==e[t]){this.visibleRowsData.splice(a,1);break}}for(var a=0;a<this.rowsData.length;a++)if(this.rowsData[a].feature==e[t]){this.rowsData.splice(a,1);break}}},filterData:function(e){var t=this.visibleRowsData.splice(0);this.visibleRowsData=[];for(var i=0;i<this.rowsData.length;i++){for(var a=!1,s=0;!a&&s<this.rowsData[i].cellData.length;s++)a=String(this.rowsData[i].cellData[s]).search(e)>=0;a&&this.visibleRowsData.push(this.rowsData[i])}var r=_.difference(this.visibleRowsData,t),n=_.difference(t,this.visibleRowsData);this.model.showFeatures(_.map(r,"feature")),this.model.hideFeatures(_.map(n,"feature")),this.buildTableContent()},sortData:function(e,t){"original"==t?this.visibleRowsData=this.rowsData.slice(0):this.visibleRowsData.sort(function(i,a){return i.cellData[e]==a.cellData[e]?0:i.cellData[e]<a.cellData[e]?"asc"==t?-1:1:"asc"==t?1:-1}),this.buildTableContent()},expandRow:function(e){var t=e.data("internal");if(!t.isLoading){var i=null;"Simple"!=s.get("mode")?i=a.getMappedProperty(t.feature,"interferometryUrl",null):(i=a.getMappedProperty(t.feature,"virtualProductUrl",null),i=i.replace("format=atom","format=json")),i&&(this._createChildrenFeatureCollection(t),t.childFc.search(i))}},closeRow:function(e){var t=e.data("internal");t.isLoading?e.next().remove():(t.childFc&&this.model.removeChild(t.feature.id),t.children.length=0,e.nextAll(".child_of_"+t.childFc.id).remove(),e.next(".paging_child_of_"+t.childFc.id).remove())},_createChildrenFeatureCollection:function(e){var t,i=this.model.createChild(e.feature.id);this.listenTo(i,"startLoading",function(a){this.$el.find(".child_of_"+i.id).remove(),t=this._getRowFromFeature(e.feature);$('<tr class="loadingChildren">				<td></td>				<td></td>				<td colspan="'+this.columnDefs.length+'"><span class=""><img style="max-width: 20px; margin: 5px 0px;" src="../css/images/ajax-loader.gif"/></span></td>			</tr>').insertAfter(t);e.isLoading=!0}),this.listenTo(i,"add:features",function(i){t.next(".loadingChildren").remove(),e.isLoading=!1,e.isExpanded&&i&&this.addData(i,this.model,e)}),this.listenTo(i,"error:features",function(i){e.isLoading=!1,e.isExpanded&&(t.next(".loadingChildren").remove(),$('<tr>				<td></td>				<td></td>				<td colspan="'+this.columnDefs.length+'">Error while loading</td>			</tr>').insertAfter(t))}),this.listenTo(i,"reset:features",function(t){e.children.length=0}),this.listenTo(i,"highlightFeatures",this.triggerHighlightFeature),this.listenTo(i,"selectFeatures",this.updateSelection),this.listenTo(i,"unselectFeatures",this.updateSelection),e.childFc=i},updateChildren:function(e,t){if(t.siblings(".child_of_"+e.childFc.id).remove(),t.siblings(".paging_child_of_"+e.childFc.id).remove(),e.children.length>0){for(var i=0;i<e.children.length;i++)this._createRow(e.children[i],t,{className:"child_of_"+e.childFc.id,isChild:!0});this._createPagination(e,t)}else $('<tr><td></td><td></td><td colspan="'+this.columnDefs.length+'">No data found</td></tr>').insertAfter(t)},_updateRow:function(e,t){var i="";this.hasExpandableRows&&(i+=e.isExpandable?e.isExpanded?'<td><span class="table-view-expand ui-icon ui-icon-minus "></span></td>':'<td><span class="table-view-expand ui-icon ui-icon-plus "></span></td>':"<td></td>"),i+="<td>";var s="ui-icon-pin-off";t.find(".row-pin").length>0&&t.find(".row-pin").hasClass("ui-icon-pin-on")&&(s="ui-icon-pin-on");var r=e.isCheckable?"inline-block":"none";i+='<span style="display:'+r+'" class="row-pin ui-icon '+s+'"></span>',i+=' <span title="Direct download for this product" class="ui-icon directDownload"></span>',i+="</td>";for(var n=0;n<e.cellData.length;n++)if(this.columnDefs[n].visible&&this.columnDefs[n].numValidCell>0){var o=null;this.columnDefs[n].getClasses&&(o=this.columnDefs[n].getClasses(e.feature));var l=e.cellData[n];if(o&&l){if("downloadOptions"==o){var d=l.indexOf("ngEO_DO");l=d>=0?l.substr(d+8).replace(/,(\w)/g,", $1"):"No download options"}i+='<td title="'+l+'" class="'+o+'">'+l+"</td>"}else i+='<td title="'+l+'">'+l+"</td>"}t.html(i);var c=a.getMappedProperty(e.feature,"browses");c&&c.length>1&&t.find(".browse-visibility-checkbox").after('<span title="Multiple browse management" class="multipleBrowse"></span>')},_createRow:function(e,t,i){var a=null,s=!1;i&&(a=i.className,s=i.isChild);var r=$("<tr "+(a?'class="'+a+'"':"")+"></tr>");this._updateRow(e,r),r=s?r.insertAfter(t):r.appendTo(t),r.data("internal",e),this.feature2row[e.feature.id]=r},_createPagination:function(e,t){var i=t.nextAll(".child_of_"+e.childFc.id+":last");if(e.childFc.totalResults>e.childFc.countPerPage){var a=$('<tr class="paging_child_of_'+e.childFc.id+'"><td></td><td></td>				<td colspan="'+this.columnDefs.length+'">				</td>			   </tr>').insertAfter(i),s=new n({model:e.childFc,el:a.find("td:last")});s.render(),a.trigger("create")}},buildTableContent:function(){var e=this.$table.find("tbody");e.empty(),this.feature2row={};for(var t=0;t<this.visibleRowsData.length;t++){var i=this.visibleRowsData[t];if(this._createRow(i,e),i.isExpanded){var a=this.feature2row[i.feature.id];this.updateChildren(i,a)}}this.updateFixedHeader(),this.updateSelection(this.model.selections),this.updateHighlights()},updateFixedHeader:function(){if(this.$table){var e=this.$el.find(".table-header");e.css("margin-right",0).end().find("th").css("min-width",""),this.$table.find("colgroup").remove().end().find("thead").show().end().find("td").css("min-width",""),this.$headerTable.find("colgroup").remove();for(var t=this,i=this.$table.find("tr:first").children().map(function(e){var i=t.$table.find("th:nth-child("+(e+1)+")").outerWidth();return $(this).outerWidth()>i?$(this).outerWidth:i}),a=$("<colgroup></colgroup>"),s=_.reduce(i,function(e,t){return e+t},0),r=s>$(window).width()-1,n=0;n<i.length;n++)r?(e.find("th:nth-child("+(n+1)+")").css("min-width",i[n]),this.$table.find("td:nth-child("+(n+1)+")").css("min-width",i[n])):a.append("<col width="+i[n]+">");r?this.$el.find(".table-view").removeClass("fullscreenWidth"):(this.$el.find(".table-view").addClass("fullscreenWidth"),a.insertBefore(this.$table.find("thead")).clone().insertBefore(this.$headerTable.find("thead"))),this.$table.find("thead").hide();var o=this.$headerTable.width()-this.$table.width();e.css("margin-right",o)}},buildTable:function(){if(this.$el.find(".inner-container").remove(),this.$el.find(".table-nodata").remove(),0==this.rowsData.length)return void this.$el.prepend('<div class="table-nodata">No data to display</div>');var e=$('<table cellpadding="0" cellspacing="0" border="0" class="table-view"><thead></thead><tbody></tbody></table>'),t=e.find("thead"),i=$("<tr></tr>").appendTo(t),a=this.columnDefs;this.hasExpandableRows&&i.append("<th></th>"),i.append('<th>			<span class="ui-icon ui-shadow" id="table-columns-button" title="Select columns to display in table" ></span>		</th>');for(var s=0;s<a.length;s++)a[s].visible&&a[s].numValidCell>0&&i.append("<th>"+a[s].sTitle+"</th>");var r=$('<div class="inner-container"></div>').prependTo(this.$el);$('<div style="position: absolute;background: #292929;bottom: 0px;right: 0px;width: 15px; height: 16px;z-index: 1;"></div>').appendTo(r),this.$table=e.prependTo(r),this.$table.wrap('<div class="table-content"></div>'),this.$headerTable=this.$table.clone().prependTo(r).wrap('<div class="table-header"></div>'),this.$table.find("thead").hide(),this.$el.find(".table-content").scroll(function(){$(".table-header").offset({left:-1*this.scrollLeft})})},render:function(){for(var e=0;e<this.columnDefs.length;e++)this.columnDefs[e].visible=e<this.maxVisibleColumns,this.columnDefs[e].numValidCell=0;this.visible=!1,this.featuresToAdd=[],$(window).resize($.proxy(this.updateFixedHeader,this)),this.buildTable(),this._renderFooter(),this.$el.trigger("create")},show:function(){this.$el.show(),this.rowsData.length>0&&this.updateFixedHeader();var e=this.$el.find(".row_highlighted");if(e.length){var t=_.max(e,function(e){var t=$(e).data("internal").feature;return new Date(a.getMappedProperty(t,"stop"))});this._scrollTo($(t))}this.visible=!0},hide:function(){this.$el.hide(),this.visible=!1},_renderFooter:function(){var e=$('<div id="tableFooter" class="ui-grid-a"></div>').append('<div class="table-filter ui-block-a">						<div data-role="fieldcontain" style="width: 300px; display: inline-block; top: 5px; vertical-align: super;" >							<input id="filterTableInput" data-inline="true" data-mini="true" type="text" placeholder="Filter products..." />						</div>						<button data-mini="true" data-inline="true" id="unpin-button" title="Unpin all products" >Unpin all products</button>					</div>					<div class="ui-block-b table-rightButtons"><div data-role="fieldcontain"></div></div>'),t=$(e).find(".table-rightButtons [data-role='fieldcontain']");this.renderButtons&&this.renderButtons(t),this.$el.append(e).trigger("create"),this.$el.find(".table-filter .ui-input-text").css("vertical-align","middle")},refresh:function(){this.updateFixedHeader()}});i.exports=v}),require.register("ui/tabs",function(e,t,i){var a=t("configuration");$.widget("ngeo.tabs",{options:{theme:"a",activate:null},_create:function(){this.element.find("ul").addClass("ui-tabs").addClass("ui-tabs-"+this.options.theme);var e=this;this.element.find("a").each(function(t){var i=e.element.find($(this).attr("href"));i.addClass("ui-body-"+a.localConfig.theme+" ui-tabs-content"),0==t?(e.activeLink=$(this),e.activeLink.parent().addClass("ui-tabs-active"),e.activeDiv=i.show()):i.hide()}),this.element.find("a").click(function(t){var i=$(this).attr("href");e.activeLink.parent().removeClass("ui-tabs-active"),e.activeDiv.hide(),$(this).parent().addClass("ui-tabs-active"),$(i).show(),e.activeDiv=$(i),e.activeLink=$(this),e.options.activate&&e.options.activate(e.activeLink,e.activeDiv),t.preventDefault()})},_destroy:function(){},_setOptions:function(){$.Widget.prototype._setOptions.apply(this,arguments)},_setOption:function(e,t){$.Widget.prototype._setOption.call(this,e,t)}})}),require.register("ui/toolbar",function(e,t,i){t("ui/widget"),$.widget("ngeo.toolbar",{options:{onlyIcon:!1,withNumber:!1,large:!1},_create:function(){this._build(this.element.find("command")),this.options.onlyIcon&&this.element.find(".tb-separator").css({height:"24px"})},_build:function(e){if(this.options.large)e.addClass("tb-elt"),$(this).data("notext")||$("<div>				   </div>").appendTo(e),e.each(function(){$(this).data("notext")?($(this).append('<div class="tb-button"><div class="tb-icon"></div></div>'),$(this).attr("title",$(this).attr("label"))):($(this).append('<div class="tb-large-button">							   			<div class="btnHeader"><span class="datasetName">'+$(this).attr("label")+'</span></div>					   					<div class="btnFooter"><span class="layerVisibility ui-icon ui-icon-checkbox-on"></span><span class="nbFeatures">No search done</span></div>				   					</div>'),$(this).data("icon")&&$(this).find(".btnHeader").prepend('<img class="datasetTypeIcon" src="../images/'+$(this).data("icon")+'.png" />'))});else{e.addClass("tb-elt");var t=$('<div class="tb-button"><div class="tb-icon"></div></div>').appendTo(e);if(this.options.withNumber&&t.find(".tb-icon").append('<span class="nbFeatures"></span>'),e.each(function(){var e=$(this),t=e.data("help");t&&e.attr("data-help",t)}),this.options.onlyIcon)e.attr("title",function(){return $(this).attr("label")});else{e.append(function(){var e;return $(this).data("notext")?$(this).attr("title",$(this).attr("label")):e=$('<div class="tb-text"> '+$(this).attr("label")+"</div>"),e})}}},refresh:function(){this._build(this.element.find("command:not(.tb-elt)"))},_destroy:function(){},_setOptions:function(){$.Widget.prototype._setOptions.apply(this,arguments)},_setOption:function(e,t){$.Widget.prototype._setOption.call(this,e,t)}})}),require.register("ui/widget",function(e,t,i){var a=t("configuration"),s=$('<div class="ui-popup-screen ui-overlay-a ui-screen-hidden"></div>').appendTo(".ui-page-active");$._ngeoOpenedWidgets=[],$.widget("ngeo.ngeowidget",{options:{title:"",activator:null,effectDuration:1e3,modal:!0,closable:!0,show:null,hide:null},_create:function(){var e=this;this.element.addClass("widget-content"),this.element.addClass("ui-body-"+a.localConfig.theme),this.element.wrap("<div class='widget'/>"),this.parentElement=this.element.parent(),this.options.title&&this.parentElement.prepend("<h2>"+this.options.title+"</h2>"),this.options.activator?(this.activator=$(this.options.activator),this.activator.click(function(){e.activator.hasClass("toggle")?e.hide():e.show()})):this.options.closable&&$('<a class="ui-btn-right" data-iconpos="notext" data-icon="delete" data-theme="a"				data-role="button" data-corners="true" data-shadow="true"				data-iconshadow="true" data-wrapperels="span" title="Close">').prependTo(this.parentElement).click($.proxy(this.hide,this)),this.parentElement.trigger("create").hide(),this.activator&&(this.arrow=$("<div class='widget-arrow-up' />").insertBefore(this.parentElement),this.arrow.hide()),$._ngeoOpenedWidgets.push(this)},update:function(){var e=$("#mapToolbar"),t=e.position().top+e.outerHeight();if(this.activator){var i=this.activator.offset(),a=Math.max(10,i.left-this.parentElement.outerWidth()/2+this.activator.outerWidth()/2);this.parentElement.css("left",a),this.arrow.css("left",i.left),this.parentElement.css("top",t+this.arrow.outerHeight()),this.arrow.css("top",t)}else{var a=this.options.left||$(window).width()/2-this.parentElement.outerWidth()/2,s=this.options.top||($(window).height()-t)/2-this.parentElement.outerHeight()/2;this.parentElement.css({top:s,left:a})}},show:function(){for(var e=0;e<$._ngeoOpenedWidgets.length;e++)$._ngeoOpenedWidgets[e]!=this&&$._ngeoOpenedWidgets[e].hide();this.update(),this.parentElement.fadeIn(this.options.durationEffect),this.arrow&&this.arrow.fadeIn(this.options.durationEffect),this.activator?this.activator.addClass("toggle"):this.options.modal&&(s.removeClass("ui-screen-hidden"),s.addClass("in")),this.options.show&&this.options.show()},hide:function(){this.parentElement.fadeOut(this.options.durationEffect,this.options.hide),this.arrow&&this.arrow.fadeOut(this.options.durationEffect),this.activator?this.activator.removeClass("toggle"):this.options.modal&&(s.addClass("ui-screen-hidden"),s.removeClass("in"))},_destroy:function(){var e=$._ngeoOpenedWidgets.indexOf(this);e>=0&&$._ngeoOpenedWidgets.splice($._ngeoOpenedWidgets.indexOf(this),1),this.parentElement.children().not(this.element).remove(),this.element.unwrap(),this.arrow&&this.arrow.remove()},_setOptions:function(){$.Widget.prototype._setOptions.apply(this,arguments)},_setOption:function(e,t){$.Widget.prototype._setOption.call(this,e,t)}})}),require.register("userPrefs",function(e,t,i){var a=t("logger"),s=t("configuration"),r={preffix:"ngeo_",keys:s.localConfig.userPrefs.keys,get:function(e){return localStorage?localStorage.getItem(this.preffix+e):void a.warning("Your browser does not support HTML5 local storage.The preferences cannot be stored.")},save:function(e,t){if(!localStorage||!_.isString(t)&&!_.isBoolean(t)||_.isArray(t)||_.isFunction(t))this.trigger("UnAllowedStorageException",e);else{var i=localStorage.setItem(this.preffix+e,t);localStorage.setItem(this.preffix+e,t),-1==this.keys.indexOf(e)&&(this.keys.push(e),this.trigger("addedPreference")),i!=t&&this.trigger("addedPreference")}},saveObject:function(e,t){if(_.isObject(localStorage)&&_.isObject(t)&&!_.isArray(t)&&!_.isFunction(t)){var i=localStorage.setItem(this.preffix+e);localStorage.setItem(this.preffix+e,JSON.stringify(t)),-1==this.keys.indexOf(e)&&(this.keys.push(e),this.trigger("addedPreference")),i!=JSON.stringify(t)&&this.trigger("addedPreference")}else this.trigger("UnAllowedStorageException",t)},reset:function(){var e=this;_.each(this.keys,function(t){var i=e.preffix+t;localStorage.removeItem(i),e.trigger("removedPreference",t)}),this.keys=s.localConfig.userPrefs.keys}};_.extend(r,Backbone.Events),i.exports=r});
//# sourceMappingURL=main-ngeo.js.map